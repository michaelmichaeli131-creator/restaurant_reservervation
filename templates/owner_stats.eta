<% layout("_layout", it) %>

<%
  // ×ª×¨×’×•× ×‘×¡×™×¡×™ ×¢× fallback
  function tt(k, fb){
    try{
      if (it && typeof it.t === "function"){
        const s = it.t(k);
        if (!s || s === k || s === `(${k})`) return fb;
        return s;
      }
    } catch(e){}
    return fb;
  }

  const restaurant = it.restaurant || {};
  const stats = it.stats || {};
  const totals = stats.totals || {};

  const revenuePerDay   = Array.isArray(stats.revenuePerDay) ? stats.revenuePerDay : [];
  const revenuePerHour  = Array.isArray(stats.revenuePerHour) ? stats.revenuePerHour : [];
  const weekday         = Array.isArray(stats.weekday) ? stats.weekday : [];
  const strongDays      = Array.isArray(stats.strongDays) ? stats.strongDays : [];
  const menuTopItems    = stats.menuTop && Array.isArray(stats.menuTop.items)
                          ? stats.menuTop.items
                          : [];

  const totalRevenue    = Number(totals.revenue ?? 0) || 0;
  const billsCount      = Number(totals.billsCount ?? 0) || 0;
  const avgBill         = Number(totals.avgBill ?? 0) || 0;

  const fromTs = totals.from && Number.isFinite(totals.from) ? new Date(totals.from) : null;
  const toTs   = totals.to   && Number.isFinite(totals.to)   ? new Date(totals.to)   : null;

  const rangeStr = (fromTs && toTs)
    ? `${fromTs.toLocaleDateString("he-IL")} â€“ ${toTs.toLocaleDateString("he-IL")}`
    : "";

  // ×—×™×©×•×‘ ××§×¡×™××•× ×œ×”×›× ×¡×•×ª ×œ×™×•× â€“ ×œ×’×¨×¤×™×
  let maxDayRevenue = 0;
  revenuePerDay.forEach(r => {
    const v = Number(r.revenue ?? 0) || 0;
    if (v > maxDayRevenue) maxDayRevenue = v;
  });

  // ××§×¡×™××•× ×œ×©×¢×”
  let maxHourRevenue = 0;
  revenuePerHour.forEach(r => {
    const v = Number(r.revenue ?? 0) || 0;
    if (v > maxHourRevenue) maxHourRevenue = v;
  });

  // ××§×¡×™××•× ×œ×™×•× ×‘×©×‘×•×¢
  let maxWeekdayRevenue = 0;
  weekday.forEach(r => {
    const v = Number(r.revenue ?? 0) || 0;
    if (v > maxWeekdayRevenue) maxWeekdayRevenue = v;
  });

  // ×¤×•×¤×•×œ×¨×™×•×ª ×× ×•×ª â€“ × ×™×§×— ×¨×§ TOP 7 ×œ×’×¨×£
  const topMenu = menuTopItems
    .slice()
    .sort((a,b) => (b.qty ?? 0) - (a.qty ?? 0))
    .slice(0, 7);

  const totalQty = stats.menuTop && typeof stats.menuTop.totalQty === "number"
    ? stats.menuTop.totalQty
    : topMenu.reduce((s,it)=>s + (Number(it.qty ?? 0) || 0), 0);
%>

<section class="sb-owner-stats container" aria-label="×¡×˜×˜×™×¡×˜×™×§×•×ª ×œ××¡×¢×“×”">
  <div class="card page-card">
    <header class="page-header">
      <div>
        <h1 class="page-title">
          ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª Â· <%= restaurant.name || "××¡×¢×“×”" %>
        </h1>
        <p class="muted">
          ×˜×•×•×— × ×ª×•× ×™×:
          <%= rangeStr || "×œ×œ× ×˜×•×•×— ××•×’×“×¨ (×—×©×‘×•×Ÿ ×¨××©×•×Ÿ â†’ ××—×¨×•×Ÿ)" %>
        </p>
      </div>
      <div class="page-actions">
        <a class="btn ghost" href="/owner">
          â† ×—×–×¨×” ×œ×“×©×‘×•×¨×“ ×‘×¢×œ×™×
        </a>
      </div>
    </header>

    <!-- ğŸ”¹ KPI ×¨××©×™: ×¡×™×›×•× ×¢×œ -->
    <section class="kpi-grid" aria-label="××“×“×™ ×¢×œ">
      <div class="kpi-card">
        <div class="kpi-label">×¡×”×´×› ×”×›× ×¡×•×ª</div>
        <div class="kpi-value main">â‚ª <%= totalRevenue.toFixed(2) %></div>
        <div class="kpi-sub muted">
          <%= billsCount %> ×—×©×‘×•× ×•×ª × ×¡×’×¨×•
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-label">×××•×¦×¢ ×—×©×‘×•×Ÿ ×œ×œ×§×•×—</div>
        <div class="kpi-value main">â‚ª <%= avgBill.toFixed(2) %></div>
        <div class="kpi-sub muted">
          ××—×•×©×‘ ×œ×¤×™ ×›×œ ×”×—×©×‘×•× ×•×ª ×‘×˜×•×•×—
        </div>
        <div class="kpi-bar-wrap">
          <div class="kpi-bar-track">
            <%
              // × × ×¨××œ ××ª avgBill ×œ×¢×¨×š "×¨×¦×•×™" ×œ×¦×•×¨×š ×’×¨×¤×™×§×” ×‘×œ×‘×“
              const target = 200;
              const pct = Math.max(5, Math.min(100, (avgBill / target) * 100 || 0));
            %>
            <div class="kpi-bar-fill" style="width:<%= pct %>%"></div>
          </div>
          <div class="kpi-bar-legend">
            <span class="muted">0</span>
            <span class="muted">×™×¢×“ ×—×–×•×™: â‚ª <%= target.toFixed(0) %></span>
          </div>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-label">×™××™× ×—×–×§×™×</div>
        <% if (strongDays && strongDays.length) { %>
          <ul class="mini-list">
            <% strongDays.slice(0,3).forEach(function(d){ %>
              <li>
                <span class="dot"></span>
                <span><%= d.dayName %></span>
                <span class="mono mini-amount">
                  â‚ª <%= Number(d.revenue ?? 0).toFixed(0) %>
                </span>
              </li>
            <% }) %>
          </ul>
        <% } else { %>
          <p class="muted">×¢×“×™×™×Ÿ ××™×Ÿ ××¡×¤×™×§ × ×ª×•× ×™× ×œ× ×™×ª×•×— ×™××™× ×—×–×§×™×.</p>
        <% } %>
      </div>
    </section>

    <!-- ROW 1: 1) ×”×›× ×¡×•×ª ×™×•××™×•×ª, 2) ×××•×¦×¢ ×—×©×‘×•×Ÿ ×‘×–××Ÿ -->
    <section class="row row-charts">
      <!-- 1. ×”×›× ×¡×•×ª ×™×•××™×•×ª -->
      <div class="chart-card">
        <h2 class="chart-title">1. ×”×›× ×¡×•×ª ×™×•××™×•×ª (Total Revenue)</h2>
        <% if (revenuePerDay.length && maxDayRevenue > 0) { %>
          <div class="chart-bars" aria-label="×”×›× ×¡×•×ª ×œ×¤×™ ×™×•×">
            <% revenuePerDay.forEach(function(d){ 
                 const rev = Number(d.revenue ?? 0) || 0;
                 const pct = maxDayRevenue ? (rev / maxDayRevenue) * 100 : 0;
            %>
              <div class="bar-row">
                <span class="bar-label-date"><%= d.date %></span>
                <div class="bar-track">
                  <div class="bar-fill" style="width:<%= pct %>%"></div>
                </div>
                <span class="bar-value mono">â‚ª <%= rev.toFixed(0) %></span>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <p class="muted">×¢×“×™×™×Ÿ ××™×Ÿ ×—×©×‘×•× ×™×•×ª ××¡×¤×™×§×•×ª ×œ×”×¦×’×ª ×”×›× ×¡×•×ª ×™×•××™×•×ª.</p>
        <% } %>
      </div>

      <!-- 2. ×××•×¦×¢ ×—×©×‘×•×Ÿ â€“ ×—×œ×•×§×” ×œ×¤×™ ×™×•× -->
      <div class="chart-card">
        <h2 class="chart-title">2. ×××•×¦×¢ ×—×©×‘×•×Ÿ ×œ×œ×§×•×— (Average Check)</h2>
        <% if (revenuePerDay.length && billsCount > 0) { %>
          <p class="muted small">
            ×”×¢×¨×”: ×××•×¦×¢ ×”×—×©×‘×•×Ÿ ×”×›×œ×œ×™ ×›×‘×¨ ××•×¦×’ ×œ××¢×œ×”; ×›××Ÿ ××•×¦×’ ×¤×¨ ×™×•× (×‘×§×™×¨×•×‘ â€“ ×œ×¤×™ ××¡×¤×¨ ×—×©×‘×•× ×•×ª ×”×›×•×œ×œ).
          </p>
          <div class="chart-bars mini" aria-label="×××•×¦×¢ ×—×©×‘×•×Ÿ ×œ×™×•×">
            <%
              // × × ×™×— ×©×”×—×©×‘×•× ×™×•×ª ××¤×•×–×¨×•×ª ×“×™ ×©×•×•×” â€“ ×–×” ×§×™×¨×•×‘.
              const avgBillsPerDay = billsCount / (revenuePerDay.length || 1);
            %>
            <% revenuePerDay.forEach(function(d){ 
                 const rev = Number(d.revenue ?? 0) || 0;
                 const localAvg = avgBillsPerDay ? (rev / avgBillsPerDay) : 0;
                 const pct = target ? Math.min(100, (localAvg / target) * 100) : 0;
            %>
              <div class="bar-row">
                <span class="bar-label-date"><%= d.date %></span>
                <div class="bar-track">
                  <div class="bar-fill alt" style="width:<%= pct %>%"></div>
                </div>
                <span class="bar-value mono">â‚ª <%= localAvg.toFixed(0) %></span>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <p class="muted">×œ× × ×™×ª×Ÿ ×œ×—×©×‘ ×××•×¦×¢ ×—×©×‘×•×Ÿ ×œ×¤×™ ×™×•× ×‘×œ×™ ×—×©×‘×•× ×™×•×ª.</p>
        <% } %>
      </div>
    </section>

    <!-- ROW 2: 3) ×× ×•×ª ×¤×•×¤×•×œ×¨×™×•×ª, 4) ×”×›× ×¡×•×ª ×œ×¤×™ ×©×¢×” -->
    <section class="row row-charts">
      <!-- 3. ×× ×•×ª ×¤×•×¤×•×œ×¨×™×•×ª -->
      <div class="chart-card">
        <h2 class="chart-title">3. ×× ×•×ª ×¤×•×¤×•×œ×¨×™×•×ª (Top Dishes)</h2>
        <% if (topMenu.length && totalQty > 0) { %>
          <div class="chart-bars" aria-label="×× ×•×ª ×¤×•×¤×•×œ×¨×™×•×ª">
            <% topMenu.forEach(function(item){
                 const qty = Number(item.qty ?? 0) || 0;
                 const pctQty = totalQty ? (qty / totalQty) * 100 : 0;
            %>
              <div class="bar-row">
                <span class="bar-label-name"><%= item.name || "×¤×¨×™×˜ ×œ×œ× ×©×" %></span>
                <div class="bar-track">
                  <div class="bar-fill dish" style="width:<%= pctQty %>%"></div>
                </div>
                <span class="bar-value mono">
                  <%= qty %> Ã— ( <%= pctQty.toFixed(1) %>% )
                </span>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <p class="muted">×¢×“×™×™×Ÿ ××™×Ÿ × ×ª×•× ×™× ××¡×¤×§×™× ×œ×¤×•×¤×•×œ×¨×™×•×ª ×× ×•×ª.</p>
        <% } %>
      </div>

      <!-- 4. ×”×›× ×¡×•×ª ×œ×¤×™ ×©×¢×” -->
      <div class="chart-card">
        <h2 class="chart-title">4. ×”×›× ×¡×•×ª ×œ×¤×™ ×©×¢×” (Revenue by Hour)</h2>
        <% if (revenuePerHour.length && maxHourRevenue > 0) { %>
          <div class="chart-heat" aria-label="×”×›× ×¡×•×ª ×œ×¤×™ ×©×¢×”">
            <% revenuePerHour.forEach(function(h){ 
                 const hour = h.hour;
                 const rev = Number(h.revenue ?? 0) || 0;
                 const count = Number(h.count ?? 0) || 0;
                 const intensity = maxHourRevenue ? (rev / maxHourRevenue) : 0;
                 const pct = Math.max(0.12, intensity); // ×œ× ×¤×—×•×ª ××“×™ ×›×“×™ ×©×™×¨××•
            %>
              <div class="heat-cell" style="--i:<%= pct %>">
                <div class="heat-hour"><%= hour %>:00</div>
                <div class="heat-rev mono">â‚ª <%= rev.toFixed(0) %></div>
                <div class="heat-count muted small"><%= count %> ×—×©×‘×•× ×•×ª</div>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <p class="muted">×˜×¨× × ×¨×©××• ××¡×¤×™×§ ×—×©×‘×•× ×•×ª ×›×“×™ ×œ× ×ª×— ×©×¢×•×ª ×—×–×§×•×ª.</p>
        <% } %>
      </div>
    </section>

    <!-- ROW 3: 5) ×”×›× ×¡×•×ª ×œ×¤×™ ×™×•× ×‘×©×‘×•×¢, 6) ×˜×‘×œ×ª ×™××™× ×—×–×§×™× -->
    <section class="row row-charts">
      <!-- 5. ×”×›× ×¡×•×ª ×œ×¤×™ ×™×•× ×‘×©×‘×•×¢ -->
      <div class="chart-card">
        <h2 class="chart-title">5. ×”×›× ×¡×•×ª ×œ×¤×™ ×™×•× ×‘×©×‘×•×¢</h2>
        <% if (weekday.length && maxWeekdayRevenue > 0) { %>
          <div class="chart-bars weekday" aria-label="×”×›× ×¡×•×ª ×‘×—×ª×š ×™××™ ×”×©×‘×•×¢">
            <% weekday.forEach(function(d){ 
                 const rev = Number(d.revenue ?? 0) || 0;
                 const cnt = Number(d.count ?? 0) || 0;
                 const pct = maxWeekdayRevenue ? (rev / maxWeekdayRevenue) * 100 : 0;
            %>
              <div class="bar-row">
                <span class="bar-label-name"><%= d.dayName %></span>
                <div class="bar-track">
                  <div class="bar-fill weekday" style="width:<%= pct %>%"></div>
                </div>
                <span class="bar-value mono">
                  â‚ª <%= rev.toFixed(0) %> Â· <%= cnt %> ×—×©×‘×•× ×•×ª
                </span>
              </div>
            <% }) %>
          </div>
        <% } else { %>
          <p class="muted">××™×Ÿ ××¡×¤×™×§ × ×ª×•× ×™× ×œ×¤×™ ×™××™ ×”×©×‘×•×¢.</p>
        <% } %>
      </div>

      <!-- 6. ×ª×—×œ×•×¤×ª ×©×•×œ×—× ×•×ª (×§×™×¨×•×‘) -->
      <div class="chart-card">
        <h2 class="chart-title">6. ×ª×—×œ×•×¤×ª ×©×•×œ×—× ×•×ª (Table Turnover â€“ ×§×™×¨×•×‘)</h2>
        <p class="muted small">
          ×œ×¤×™ ×›××•×ª ×—×©×‘×•× ×•×ª × ×¡×’×¨×• / ×›××•×ª ×™××™ ×¤×¢×™×œ×•×ª. ×‘×”××©×š ××¤×©×¨ ×œ×“×™×™×§ ×¢× × ×ª×•× ×™ ×”×•×©×‘×” ××œ××™×.
        </p>
        <% if (billsCount > 0 && revenuePerDay.length) { %>
          <%
            const days = revenuePerDay.length || 1;
            const approxCoversPerDay = billsCount / days;
          %>
          <div class="turnover-card">
            <div class="turnover-main">
              <div class="turnover-value mono"><%= approxCoversPerDay.toFixed(1) %></div>
              <div class="turnover-label">×—×©×‘×•× ×•×ª ×‘×™×•× ×‘×××•×¦×¢</div>
            </div>
            <div class="turnover-bar-wrap">
              <div class="turnover-bar-track">
                <%
                  const tTarget = 40;
                  const tPct = Math.max(8, Math.min(100, (approxCoversPerDay / tTarget) * 100));
                %>
                <div class="turnover-bar-fill" style="width:<%= tPct %>%"></div>
              </div>
              <div class="turnover-legend">
                <span class="muted">×™×¢×“ ×“××™×•× ×™: ~<%= tTarget %> ×—×©×‘×•× ×•×ª/×™×•×</span>
              </div>
            </div>
          </div>
        <% } else { %>
          <p class="muted">××™×Ÿ ××¡×¤×™×§ × ×ª×•× ×™× ×œ×—×™×©×•×‘ ×ª×—×œ×•×¤×”.</p>
        <% } %>
      </div>
    </section>

    <!-- ROW 4: 7+8 â€“ placeholders ×—×›××™× ×œ××“×“×™× ×©×“×•×¨×©×™× ×¢×•×“ data -->
    <section class="row row-charts">
      <!-- 7. ×¨×•×•×—×™×•×ª ×¤×¨ ×× ×” -->
      <div class="chart-card">
        <h2 class="chart-title">7. ×¨×•×•×—×™×•×ª ×œ×¤×™ ×× ×” (Profit per Dish)</h2>
        <p class="muted small">
          ×›×“×™ ×œ×—×©×‘ ×¨×•×•×—×™×•×ª ×××™×ª×™×ª ×œ×¤×™ ×× ×” ×¦×¨×™×š ×œ×”×–×™×Ÿ ×¢×œ×•×ª ××¨×›×™×‘×™× (Food Cost) ×œ×›×œ ×¤×¨×™×˜ ×‘×ª×¤×¨×™×˜.
        </p>
        <div class="placeholder-chart">
          <div class="placeholder-bar"></div>
          <div class="placeholder-bar short"></div>
          <div class="placeholder-bar mid"></div>
        </div>
        <p class="muted small">
          ×›×¨×’×¢ ×× ×• ××¦×™×’×™× ×¨×§ ×¤×•×¤×•×œ×¨×™×•×ª ×× ×•×ª (×¡×˜×˜×™×¡×˜×™×§×” ××¡×³ 3). ×›××©×¨ ×ª×•×¡×™×£ ×¢×œ×•×ª ×œ×ª×¤×¨×™×˜, × ×•×›×œ
          ×œ×”×¦×™×’ ××™×–×• ×× ×” ×œ× ×¨×§ × ××›×¨×ª ×”×¨×‘×” â€“ ××œ× ×’× ××›× ×™×¡×” ×”×›×™ ×”×¨×‘×”.
        </p>
      </div>

      <!-- 8. ×¢×œ×•×ª ×¢×‘×•×“×” ××ª×•×š ×”×”×›× ×¡×•×ª -->
      <div class="chart-card">
        <h2 class="chart-title">8. ×¢×œ×•×ª ×¢×‘×•×“×” ××ª×•×š ×”×”×›× ×¡×•×ª (Labor Cost %)</h2>
        <p class="muted small">
          ××“×“ ×–×” ×“×•×¨×© × ×ª×•× ×™× ××”×©×›×¨ / ××¢×¨×›×ª × ×•×›×—×•×ª ×¢×•×‘×“×™× (×¢×œ×•×ª ×©×¢×ª×™×ª, ××©××¨×•×ª, ×©×¢×•×ª ×¢×‘×•×“×” ×‘×¤×•×¢×œ).
        </p>
        <div class="placeholder-gauge">
          <div class="gauge-arc">
            <div class="gauge-fill"></div>
          </div>
          <div class="gauge-center">
            <div class="gauge-value">â€”%</div>
            <div class="gauge-label muted small">×˜×¨× ×”×•×’×“×¨</div>
          </div>
        </div>
        <p class="muted small">
          ×›××©×¨ ×ª×—×‘×¨ × ×ª×•× ×™ ×›×•×— ××“× (×œ××©×œ ×‘×§×•×‘×¥ ×—×™×¦×•× ×™ ××• ××•×“×•×œ × ×•×¡×£ ×‘Ö¾SpotBook), × ×•×›×œ ×œ×—×©×‘:
          ×¢×œ×•×ª ×¢×‘×•×“×” / ×”×›× ×¡×•×ª, ×•×›×š ×œ×¨××•×ª ×× ×¦×¨×™×š ×œ×™×™×¢×œ ××©××¨×•×ª.
        </p>
      </div>
    </section>
  </div>
</section>

<style>
  .sb-owner-stats.container{
    max-width:1100px;
    margin:20px auto;
    padding:0 16px;
  }

  .card.page-card{
    background: var(--panel,#050816);
    border-radius:18px;
    border:1px solid var(--bd,#1f2937);
    padding:18px;
    color:var(--ink,#e5e7eb);
    box-shadow:0 18px 45px rgba(0,0,0,.7);
  }

  .page-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:16px;
    margin-bottom:16px;
  }
  .page-title{
    margin:0 0 4px;
    font-size:22px;
  }
  .muted{
    color:var(--ink-muted,#9ca3af);
  }
  .muted.small{
    font-size:11px;
  }
  .page-actions{
    display:flex;
    gap:8px;
  }

  .kpi-grid{
    display:grid;
    grid-template-columns:2fr 2fr 2fr;
    gap:12px;
    margin-bottom:18px;
  }
  .kpi-card{
    background: radial-gradient(circle at top left,rgba(59,130,246,.35),transparent 60%);
    border-radius:14px;
    padding:10px 12px;
    border:1px solid rgba(148,163,184,.3);
  }
  .kpi-label{
    font-size:12px;
    color:var(--ink-muted,#9ca3af);
  }
  .kpi-value.main{
    font-size:20px;
    font-weight:700;
    margin-top:4px;
  }
  .kpi-sub{
    font-size:12px;
    margin-top:2px;
  }
  .kpi-bar-wrap{
    margin-top:8px;
  }
  .kpi-bar-track{
    position:relative;
    height:8px;
    border-radius:999px;
    background:rgba(15,23,42,.9);
    overflow:hidden;
  }
  .kpi-bar-fill{
    height:100%;
    border-radius:999px;
    background:linear-gradient(90deg,#22c55e,#a3e635);
  }
  .kpi-bar-legend{
    display:flex;
    justify-content:space-between;
    font-size:11px;
    margin-top:2px;
  }

  .mini-list{
    list-style:none;
    padding:0;
    margin:6px 0 0;
    font-size:12px;
  }
  .mini-list li{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    margin:2px 0;
  }
  .mini-list .dot{
    width:6px;
    height:6px;
    border-radius:999px;
    background:#22c55e;
    margin-inline-end:4px;
  }
  .mini-amount{
    font-size:11px;
  }

  .row{
    margin-bottom:16px;
  }
  .row-charts{
    display:grid;
    grid-template-columns:1.4fr 1.4fr;
    gap:12px;
  }

  .chart-card{
    background: radial-gradient(circle at top right,rgba(124,58,237,.35),transparent 60%);
    border-radius:14px;
    padding:10px 12px;
    border:1px solid rgba(148,163,184,.3);
  }
  .chart-title{
    font-size:14px;
    margin:0 0 6px;
  }

  .chart-bars{
    display:flex;
    flex-direction:column;
    gap:4px;
    max-height:260px;
    overflow:auto;
    padding-right:4px;
  }
  .chart-bars.mini{
    max-height:220px;
  }
  .chart-bars.weekday{
    max-height:230px;
  }
  .bar-row{
    display:grid;
    grid-template-columns: minmax(80px, 1fr) minmax(0, 3fr) auto;
    gap:6px;
    align-items:center;
    font-size:12px;
  }
  .bar-label-date,
  .bar-label-name{
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .bar-track{
    position:relative;
    height:8px;
    border-radius:999px;
    background:rgba(15,23,42,.85);
    overflow:hidden;
  }
  .bar-fill{
    position:absolute;
    inset:0;
    width:40%;
    border-radius:999px;
    background:linear-gradient(90deg,#3b82f6,#ec4899);
  }
  .bar-fill.alt{
    background:linear-gradient(90deg,#22c55e,#a3e635);
  }
  .bar-fill.dish{
    background:linear-gradient(90deg,#f97316,#fde047);
  }
  .bar-fill.weekday{
    background:linear-gradient(90deg,#06b6d4,#22d3ee);
  }
  .bar-value{
    font-size:11px;
  }
  .mono{
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New",monospace;
  }

  .chart-heat{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(80px,1fr));
    gap:6px;
    max-height:260px;
    overflow:auto;
    padding-right:4px;
  }
  .heat-cell{
    padding:6px;
    border-radius:10px;
    background:linear-gradient(
      135deg,
      color-mix(in srgb,#22c55e calc(var(--i,0)*100%), #020617),
      #020617
    );
    border:1px solid rgba(15,23,42,.9);
    box-shadow:0 10px 25px rgba(0,0,0,.45);
  }
  .heat-hour{
    font-size:12px;
    font-weight:600;
  }
  .heat-rev{
    font-size:12px;
  }

  .turnover-card{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-top:4px;
  }
  .turnover-main{
    text-align:center;
  }
  .turnover-value{
    font-size:26px;
    font-weight:700;
  }
  .turnover-label{
    font-size:12px;
  }
  .turnover-bar-wrap{
    margin-top:4px;
  }
  .turnover-bar-track{
    height:8px;
    border-radius:999px;
    background:rgba(15,23,42,.85);
    overflow:hidden;
  }
  .turnover-bar-fill{
    height:100%;
    border-radius:999px;
    background:linear-gradient(90deg,#3b82f6,#22c55e);
  }
  .turnover-legend{
    margin-top:4px;
    font-size:11px;
  }

  .placeholder-chart{
    display:flex;
    flex-direction:column;
    gap:4px;
    margin:8px 0;
  }
  .placeholder-bar{
    height:8px;
    border-radius:999px;
    background:linear-gradient(90deg,#4b5563,#111827);
  }
  .placeholder-bar.short{
    width:40%;
  }
  .placeholder-bar.mid{
    width:70%;
  }

  .placeholder-gauge{
    position:relative;
    width:140px;
    height:80px;
    margin:8px auto 4px;
  }
  .gauge-arc{
    position:absolute;
    inset:0;
    border-radius:999px 999px 0 0;
    border:8px solid #111827;
    border-bottom:none;
    overflow:hidden;
  }
  .gauge-fill{
    position:absolute;
    inset:0;
    border-radius:999px 999px 0 0;
    border:8px solid #374151;
    border-bottom:none;
  }
  .gauge-center{
    position:absolute;
    inset:18px 0 0;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    text-align:center;
    gap:2px;
  }
  .gauge-value{
    font-size:18px;
    font-weight:700;
  }

  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    padding:8px 12px;
    border-radius:10px;
    border:1px solid rgba(148,163,184,.3);
    background:rgba(15,23,42,.9);
    color:#e5e7eb;
    font-size:13px;
    text-decoration:none;
    cursor:pointer;
    transition:transform .08s ease, box-shadow .12s ease, background .12s ease;
  }
  .btn:hover{
    transform:translateY(-1px);
    box-shadow:0 12px 30px rgba(15,23,42,.7);
  }
  .btn.ghost{
    background:rgba(15,23,42,.7);
  }

  @media (max-width:900px){
    .page-header{
      flex-direction:column;
      align-items:flex-start;
    }
    .kpi-grid{
      grid-template-columns:1fr;
    }
    .row-charts{
      grid-template-columns:1fr;
    }
  }
</style>

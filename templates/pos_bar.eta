<% layout("_layout_ops", it) %>

<%
  function tt(k, fb){
    try{
      if (it && typeof it.t==='function'){
        const s = it.t(k);
        if(!s || s===k || s===`(${k})`) return fb;
        return s;
      }
    }catch(e){}
    return fb;
  }

  const r   = it.restaurant;
  const rid = it.rid;
%>

<main class="kds-shell" data-kds-shell data-mode="bar" dir="<%= it.dir || 'rtl' %>">
  <header class="kds-topbar">
    <div class="kds-brand">
      <h1 class="kds-title">ğŸ¸ <%= tt('pos.bar.title', 'Bar') %> â€” <%= r.name %></h1>
      <p class="kds-sub"><%= r.city %> â€¢ <%= r.address %></p>
    </div>

    <div class="kds-controls" aria-label="Bar controls">
      <div id="kds-live" class="kds-pill" data-live="0"><span class="dot" aria-hidden="true"></span><%= tt('pos.kds.offline', 'Offline') %></div>

      <button id="kds-compact" class="kds-btn" type="button" aria-pressed="false"><%= tt('pos.kds.compact', 'Compact') %></button>
      <button id="kds-group" class="kds-btn" type="button" aria-pressed="true"><%= tt('pos.kds.ungroup', 'Ungroup') %></button>

      <div class="kds-search">
        <input id="kds-search" type="search" inputmode="search" autocomplete="off" />
      </div>

      <a class="kds-btn ghost" href="/owner"><%= tt('pos.btn_back_dashboard', 'Back to Dashboard') %></a>
    </div>
  </header>

  <nav class="kds-tabs" aria-label="<%= tt('pos.kds.tabs', 'Status tabs') %>">
    <button id="kds-tab-received" class="kds-tab" type="button" aria-selected="true"><%= tt('pos.status.received', 'Received') %></button>
    <button id="kds-tab-in-progress" class="kds-tab" type="button" aria-selected="false"><%= tt('pos.status.in_progress', 'In Progress') %></button>
    <button id="kds-tab-ready" class="kds-tab" type="button" aria-selected="false"><%= tt('pos.status.ready', 'Ready') %></button>
  </nav>

  <section
    class="kds-board"
    data-kds-root
    data-rid="<%= rid %>"
    data-destination="bar"
    data-locale="<%= it.lang === 'he' ? 'he-IL' : 'en-US' %>"

    data-str-live="<%= tt('pos.kds.live', 'Live') %>"
    data-str-offline="<%= tt('pos.kds.offline', 'Offline') %>"
    data-str-search="<%= tt('pos.kds.search', 'Search table / item') %>"
    data-str-received="<%= tt('pos.status.received', 'Received') %>"
    data-str-in-progress="<%= tt('pos.status.in_progress', 'In Progress') %>"
    data-str-ready="<%= tt('pos.status.ready', 'Ready') %>"
    data-str-table="<%= tt('host.table_label', 'Table') %>"
    data-str-qty="<%= tt('pos.bar.quantity', 'Qty') %>"
    data-str-created="<%= tt('pos.waiter.created_at', 'Created at') %>"
    data-str-none="<%= tt('pos.bar.no_items', 'No items.') %>"
    data-str-back="<%= tt('common.btn_back', 'Back') %>"
    data-str-compact="<%= tt('pos.kds.compact', 'Compact') %>"
    data-str-comfy="<%= tt('pos.kds.comfort', 'Comfort') %>"
    data-str-group="<%= tt('pos.kds.group', 'Group') %>"
    data-str-ungroup="<%= tt('pos.kds.ungroup', 'Ungroup') %>"
    data-str-act-prev="<%= tt('pos.kds.act_prev', 'Back') %>"
    data-str-act-next="<%= tt('pos.kds.act_next', 'Next') %>"
    data-str-act-start="<%= tt('pos.kds.act_start', 'Start') %>"
    data-str-act-ready="<%= tt('pos.kds.act_ready', 'Ready') %>"
  >
    <div class="kds-columns" id="kds-columns">
      <div class="kds-col" data-status="received" id="kds-col-received">
        <div class="kds-colhead">
          <div class="kds-status"><span class="bar" aria-hidden="true"></span><span><%= tt('pos.status.received', 'Received') %></span></div>
          <div class="kds-count" id="kds-count-received">0</div>
        </div>
        <div class="kds-colbody" id="kds-items-received"></div>
      </div>

      <div class="kds-col" data-status="in_progress" id="kds-col-in-progress">
        <div class="kds-colhead">
          <div class="kds-status"><span class="bar" aria-hidden="true"></span><span><%= tt('pos.status.in_progress', 'In Progress') %></span></div>
          <div class="kds-count" id="kds-count-in-progress">0</div>
        </div>
        <div class="kds-colbody" id="kds-items-in-progress"></div>
      </div>

      <div class="kds-col" data-status="ready" id="kds-col-ready">
        <div class="kds-colhead">
          <div class="kds-status"><span class="bar" aria-hidden="true"></span><span><%= tt('pos.status.ready', 'Ready') %></span></div>
          <div class="kds-count" id="kds-count-ready">0</div>
        </div>
        <div class="kds-colbody" id="kds-items-ready"></div>
      </div>
    </div>
  </section>

  <!-- Mobile Bottom Action Bar (visible on phones) -->
  <footer class="kds-bottombar" aria-label="Quick actions">
    <a id="kds-bb-back" class="kds-bb-btn kds-bb-back" href="/owner" aria-label="<%= tt('pos.btn_back_dashboard', 'Back to Dashboard') %>">
      <span class="kds-bb-ic" aria-hidden="true">âŸµ</span>
      <span class="kds-bb-txt"><%= tt('common.btn_back', 'Back') %></span>
    </a>

    <button id="kds-bb-compact" class="kds-bb-btn" type="button" aria-pressed="false">
      <span class="kds-bb-ic" aria-hidden="true">â–¦</span>
      <span class="kds-bb-txt"><%= tt('pos.kds.compact', 'Compact') %></span>
    </button>

    <button id="kds-bb-group" class="kds-bb-btn" type="button" aria-pressed="true">
      <span class="kds-bb-ic" aria-hidden="true">â‰¡</span>
      <span class="kds-bb-txt"><%= tt('pos.kds.ungroup', 'Ungroup') %></span>
    </button>
  </footer>

</main>

<script src="/public/js/pos_kds.js?v=<%= it.BUILD_TAG || Date.now() %>"></script>

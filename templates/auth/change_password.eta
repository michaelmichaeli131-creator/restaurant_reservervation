<% layout("_layout", it) %>

<% /* tt: ×ª×¨×’×•× ×¢× fallback ×’× ×›×©-it.t ××—×–×™×¨ "(key)" */ %>
<% function tt(k, fb){ try{ if (it && typeof it.t==='function'){ const s = it.t(k); if(!s || s===k || s===`(${k})`) return fb; return s; } }catch(e){} return fb; } %>

<main class="sb-auth container" aria-labelledby="cp-title">
  <section class="card auth-card">
    <header class="head">
      <h1 id="cp-title"><%= tt('auth.changePassword.title','×©×™× ×•×™ ×¡×™×¡××”') %></h1>
      <% if (it.info)  { %><p class="badge ok" role="status">âœ“ <%= it.info %></p><% } %>
      <% if (it.error) { %><p class="badge warn" role="alert">âœ— <%= it.error %></p><% } %>
    </header>

    <form class="form" action="/auth/change-password" method="post" novalidate>
      <input type="hidden" name="_csrf" value="<%= it.csrf || '' %>" />

      <div class="form-row">
        <label for="currentPassword"><%= tt('auth.changePassword.form.current','×¡×™×¡××” × ×•×›×—×™×ª') %></label>
        <div class="pw-wrap">
          <input id="currentPassword" name="currentPassword" type="password" autocomplete="current-password" required />
          <button class="pw-toggle" type="button" aria-label="<%= tt('auth.changePassword.form.pwToggleAria','×”×¦×’/×”×¡×ª×¨ ×¡×™×¡××”') %>">ğŸ‘</button>
        </div>
      </div>

      <div class="form-row">
        <label for="newPassword"><%= tt('auth.changePassword.form.new','×¡×™×¡××” ×—×“×©×”') %></label>
        <div class="pw-wrap">
          <input id="newPassword" name="newPassword" type="password" autocomplete="new-password" minlength="8" required />
          <button class="pw-toggle" type="button" aria-label="<%= tt('auth.changePassword.form.pwToggleAria','×”×¦×’/×”×¡×ª×¨ ×¡×™×¡××”') %>">ğŸ‘</button>
        </div>
        <p class="hint"><%= tt('auth.changePassword.form.minHint','×œ×¤×—×•×ª 8 ×ª×•×•×™×') %></p>
      </div>

      <div class="form-row">
        <label for="confirm"><%= tt('auth.changePassword.form.confirm','××™××•×ª ×¡×™×¡××” ×—×“×©×”') %></label>
        <div class="pw-wrap">
          <input id="confirm" name="confirm" type="password" autocomplete="new-password" minlength="8" required />
          <button class="pw-toggle" type="button" aria-label="<%= tt('auth.changePassword.form.pwToggleAria','×”×¦×’/×”×¡×ª×¨ ×¡×™×¡××”') %>">ğŸ‘</button>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn primary" type="submit"><%= tt('auth.changePassword.actions.submit','×¢×“×›×Ÿ ×¡×™×¡××”') %></button>
      </div>
    </form>

    <footer class="ft">
      <p class="links">
        <a href="/auth/forgot"><%= tt('auth.changePassword.links.forgot','×©×›×—×ª ×¡×™×¡××”? ××™×¤×•×¡ ×“×¨×š ××™××™×™×œ') %></a>
      </p>
    </footer>
  </section>
</main>

<script>
  (function(){
    // ×”×¦×’/×”×¡×ª×¨ ×¡×™×¡××” ×œ×›×œ ×©×“×”
    document.addEventListener('click', (ev)=>{
      const t = ev.target.closest('.pw-toggle'); if(!t) return;
      const inp = t.previousElementSibling; if(!inp) return;
      inp.type = inp.type === 'password' ? 'text' : 'password';
      t.classList.toggle('on', inp.type === 'text');
    }, {passive:true});

    // ×‘×“×™×§×ª ×”×ª×××” ×‘×¡×™×¡×™×ª ×‘×¦×“ ×œ×§×•×—
    const np = document.getElementById('newPassword');
    const cf = document.getElementById('confirm');
    function markMismatch(){
      if(!np || !cf) return;
      const mismatch = (cf.value || '') && (np.value !== cf.value);
      cf.setCustomValidity(mismatch ? 'mismatch' : '');
    }
    if(np && cf){
      np.addEventListener('input', markMismatch);
      cf.addEventListener('input', markMismatch);
    }
  })();
</script>

<style>
  :root{
    --bg:#0b1120; --card:#111827; --ink:#e5e7eb; --muted:#9aa3b2; --bd:#1f2937;
    --brand:#3b82f6; --warn:#f59e0b; --ok:#10b981;
    --radius:16px; --shadow-md:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
  }
  .sb-auth.container{ max-width:520px; margin:28px auto; padding:0 16px; }
  .auth-card.card{ background:var(--card); border:1px solid var(--bd); border-radius:var(--radius); color:var(--ink); box-shadow:var(--shadow-md); padding:18px; }
  .head{ display:flex; align-items:center; gap:10px; justify-content:space-between; margin-bottom:10px }
  #cp-title{ margin:0; font-size:22px; letter-spacing:.2px }
  .hint{ color:var(--muted); font-size:.9rem; margin:6px 0 0 }
  .badge{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-weight:800; font-size:.9rem; border:1px solid transparent; }
  .badge.warn{ background:color-mix(in srgb, var(--warn) 18%, #0d1526); color:#ffedd5; border-color:color-mix(in srgb, var(--warn) 55%, var(--bd)); }
  .badge.ok{ background:color-mix(in srgb, var(--ok) 16%, #0d1526); color:#d1fae5; border-color:color-mix(in srgb, var(--ok) 55%, var(--bd)); }
  .form{ margin-top:6px }
  .form-row{ display:flex; flex-direction:column; gap:6px; margin-bottom:10px }
  .form-row label{ font-weight:600 }
  .form-row input{ background:#0b1327; color:var(--ink); border:1px solid var(--bd); border-radius:12px; padding:10px 12px; font-size:15px; outline:0; transition:border-color .15s ease, box-shadow .15s ease, background .15s ease; }
  .form-row input:focus{ border-color: color-mix(in srgb, var(--brand) 60%, var(--bd)); box-shadow: 0 0 0 3px color-mix(in srgb, var(--brand) 22%, transparent); }
  .pw-wrap{ position:relative }
  .pw-toggle{ position:absolute; inset-inline-end:8px; inset-block:0; margin:auto 0; height:32px; min-width:36px; display:inline-flex; align-items:center; justify-content:center; border:1px solid var(--bd); background:#0f172a; color:var(--ink); border-radius:10px; cursor:pointer; transition:filter .12s ease, transform .08s ease; }
  .pw-toggle.on{ filter:brightness(1.12) }
  .pw-toggle:active{ transform:scale(.98) }
  .form-actions{ margin-top:12px }
  .ft{ margin-top:12px; border-top:1px solid var(--bd); padding-top:12px }
  .links a{ color:#c7d2fe; text-decoration:none }
  .links a:hover{ text-decoration:underline }
</style>

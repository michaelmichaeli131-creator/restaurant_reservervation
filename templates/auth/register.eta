<% layout("_layout", it) %>

<main class="sb-auth container">
  <section class="card auth-card">
    <header class="head">
      <div>
        <h1>×”×¨×©××”</h1>
        <p class="muted">×¤×ª×—/×™ ×—×©×‘×•×Ÿ ×—×“×© ×œÖ¾GeoTable</p>
      </div>
      <% if (it.error) { %>
        <p class="badge warn" role="alert">âœ— <%= it.error %></p>
      <% } %>
    </header>

    <!-- ×©×œ×™×—×” ×›-x-www-form-urlencoded (×›××• ×‘××§×•×¨) -->
    <form id="register-form"
          class="form-grid"
          action="/auth/register"
          method="post"
          enctype="application/x-www-form-urlencoded"
          novalidate>

      <div class="form-row">
        <label for="firstName">×©× ×¤×¨×˜×™</label>
        <input id="firstName" name="firstName" type="text" required autocomplete="given-name"
               placeholder="×œ×“×•×’××”: ×“× ×™××œ" value="<%= it.prefill?.firstName || '' %>"/>
      </div>

      <div class="form-row">
        <label for="lastName">×©× ××©×¤×—×”</label>
        <input id="lastName" name="lastName" type="text" required autocomplete="family-name"
               placeholder="×œ×“×•×’××”: ×›×”×Ÿ" value="<%= it.prefill?.lastName || '' %>"/>
      </div>

      <div class="form-row" style="grid-column:1/-1">
        <label for="email">××™××™×™×œ</label>
        <input id="email" name="email" type="email" dir="ltr" inputmode="email" required
               autocomplete="email" autocapitalize="off" spellcheck="false"
               placeholder="you@example.com" value="<%= it.prefill?.email || '' %>"/>
        <small class="muted">× ×©×ª××© ×‘××™××™×™×œ ×œ×¦×•×¨×š ×”×ª×—×‘×¨×•×ª ×•×”×ª×¨××•×ª.</small>
      </div>

      <div class="form-row">
        <label for="password">×¡×™×¡××”</label>
        <div class="pw-wrap">
          <input id="password" name="password" type="password" required autocomplete="new-password"
                 minlength="6" placeholder="×œ×¤×—×•×ª 6 ×ª×•×•×™×"/>
          <button class="pw-toggle" type="button" aria-label="×”×¦×’/×”×¡×ª×¨ ×¡×™×¡××”">ğŸ‘</button>
        </div>
      </div>

      <!-- ×©× ×”×©×“×” ×—×™×™×‘ ×œ×”×™×•×ª confirm ×œ×¤×™ ×”-BE -->
      <div class="form-row">
        <label for="confirm">××™××•×ª ×¡×™×¡××”</label>
        <div class="pw-wrap">
          <input id="confirm" name="confirm" type="password" required autocomplete="new-password"
                 minlength="6" placeholder="×”×§×œ×“/×™ ×©×•×‘ ××ª ×”×¡×™×¡××”"/>
          <button class="pw-toggle" type="button" aria-label="×”×¦×’/×”×¡×ª×¨ ×¡×™×¡××”">ğŸ‘</button>
        </div>
      </div>

      <div class="form-row">
        <label for="businessType">×¡×•×’ ×”×¢×¡×§</label>
        <select id="businessType" name="businessType" required>
          <option value="" disabled <%= (it.prefill?.businessType ? '' : 'selected') %> hidden>×‘×—×¨/×™ ×¡×•×’ ×¢×¡×§</option>
          <option value="restaurant" <%= it.prefill?.businessType==='restaurant'?'selected':'' %>>××¡×¢×“×”</option>
          <option value="cafe"       <%= it.prefill?.businessType==='cafe'?'selected':'' %>>×‘×™×ª ×§×¤×”</option>
          <option value="bar"        <%= it.prefill?.businessType==='bar'?'selected':'' %>>×‘×¨</option>
          <option value="hotel"      <%= it.prefill?.businessType==='hotel'?'selected':'' %>>××œ×•×Ÿ / ××™×¨×•×—</option>
          <option value="other"      <%= it.prefill?.businessType==='other'?'selected':'' %>>××—×¨</option>
        </select>
      </div>

      <div class="form-row">
        <label for="phone">× ×™×™×“ (×œ× ×—×•×‘×”)</label>
        <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="050-1234567"
               value="<%= it.prefill?.phone || '' %>"/>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn primary">×”×™×¨×©×/×™</button>
        <a class="btn ghost" href="/auth/login">×™×© ×›×‘×¨ ×—×©×‘×•×Ÿ? ×”×ª×—×‘×¨×•×ª</a>
      </div>
    </form>
  </section>
</main>

<script>
  (function(){
    const form = document.getElementById('register-form');

    // × ×™×¨××•×œ ××™××™×™×œ (××¡×™×¨ bidi, ×¨×•×•×—×™× ××•×–×¨×™×, ××•×¨×™×“ ×œ××•×ª×™×•×ª ×§×˜× ×•×ª)
    const BIDI=/[\u200E\u200F\u202A-\u202E\u2066-\u2069]/g, ZSP=/[\s\u00A0\u1680\u180E\u2000-\u200A\u202F\u205F\u3000]+/g;
    function normalizeEmail(s){
      s=(s||'')+''; s=s.replace(BIDI,'').replace(/ï¼ /g,'@').replace(/ï¼/g,'.');
      s=s.replace(ZSP,' ').trim().replace(/^[<"'\s]+/,'').replace(/[>"'\s]+$/,'');
      return s.toLowerCase();
    }
    const emailEl=document.getElementById('email');
    if(emailEl){ emailEl.addEventListener('blur',()=>{ emailEl.value=normalizeEmail(emailEl.value); }); }

    // ×”×¦×’×ª/×”×¡×ª×¨×ª ×¡×™×¡××”
    document.addEventListener('click', function(ev){
      const t=ev.target.closest('.pw-toggle'); if(!t) return;
      const inp=t.parentElement.querySelector('input');
      if(!inp) return;
      inp.type = (inp.type === 'password') ? 'text' : 'password';
      t.classList.toggle('on', inp.type==='text');
    }, {passive:true});

    // ×•×œ×™×“×¦×™×” ×œ×§×•×—: ×”×ª×××ª ×¡×™×¡×××•×ª
    form.addEventListener('submit', (ev)=>{
      const p=form.password?.value||'', c=form.confirm?.value||'';
      if(p && c && p!==c){ ev.preventDefault(); alert('×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª'); }
    }, {passive:false});
  })();
</script>

<style>
  :root{
    --bg:#0b1120; --card:#111827; --ink:#e5e7eb; --muted:#9aa3b2; --bd:#1f2937;
    --brand:#3b82f6; --warn:#f59e0b;
    --radius:16px; --radius-sm:12px;
    --shadow-md:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
  }

  .sb-auth.container{ max-width:720px; margin:24px auto; padding:0 16px; }
  .auth-card.card{
    background:var(--card); border:1px solid var(--bd); border-radius:var(--radius);
    color:var(--ink); box-shadow:var(--shadow-md); padding:18px;
  }
  .head{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; margin-bottom:6px }
  h1{ margin:0 0 6px; font-size:22px; letter-spacing:.2px }
  .muted{ color:var(--muted) }

  .badge{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; font-weight:800; font-size:.9rem; }
  .badge.warn{ background:color-mix(in srgb, var(--warn) 18%, #0d1526); color:#ffedd5; border:1px solid color-mix(in srgb, var(--warn) 55%, var(--bd)); }

  .form-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-top:12px }
  .form-row{ display:flex; flex-direction:column; gap:6px }
  .form-row label{ font-weight:600 }
  .form-row input, .form-row select{
    background:#0b1327; color:var(--ink);
    border:1px solid var(--bd); border-radius:12px; padding:10px 12px; font-size:15px; outline:0;
    transition:border-color .15s ease, box-shadow .15s ease, background .15s ease;
  }
  .form-row input:focus, .form-row select:focus{
    border-color: color-mix(in srgb, var(--brand) 60%, var(--bd));
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--brand) 22%, transparent);
  }
  .pw-wrap{ position:relative }
  .pw-toggle{
    position:absolute; inset-inline-end:8px; inset-block:0; margin:auto 0;
    height:32px; min-width:36px; display:inline-flex; align-items:center; justify-content:center;
    border:1px solid var(--bd); background:#0f172a; color:var(--ink);
    border-radius:10px; cursor:pointer;
  }
  .pw-toggle.on{ filter:brightness(1.1) }

  .form-actions{ grid-column:1/-1; display:flex; gap:10px; flex-wrap:wrap; margin-top:6px }

  .btn{
    display:inline-flex; align-items:center; justify-content:center;
    padding:10px 14px; border-radius:12px; border:1px solid var(--bd);
    cursor:pointer; text-decoration:none; font-weight:800; color:var(--ink);
    background:#0f172a; transition:transform .08s ease, filter .12s ease;
  }
  .btn:hover{ transform:translateY(-1px) }
  .btn.primary{
    background:var(--brand); border-color:var(--brand); color:#fff;
    box-shadow:0 10px 24px rgba(59,130,246,.28);
  }
  .btn.ghost{ background:color-mix(in srgb,#0f172a 80%,transparent); border-color:var(--bd) }
  .btn.secondary{ composes: btn ghost; } /* ×× ××™×Ÿ ×ª××™×›×” ×‘-composes, ××¤×©×¨ ×œ×”×©××™×¨ class="btn ghost" ×‘×ª×‘× ×™×ª */

  @media (max-width:760px){
    .form-grid{ grid-template-columns:1fr }
    .sb-auth.container{ margin:20px auto }
  }
</style>

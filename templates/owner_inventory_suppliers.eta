<% layout("_layout", it) %>

<%
  const restaurant = it.restaurant || {};
  const suppliers  = Array.isArray(it.suppliers) ? it.suppliers : [];

  function esc(s){ return String(s ?? ""); }

  // i18n helper with fallback
  function tt(k, fb){
    try{
      if (it && typeof it.t === "function"){
        const s = it.t(k);
        if (!s || s === k || s === `(${k})`) return fb;
        return s;
      }
    } catch(e){}
    return fb;
  }
%>

<main class="sb-owner container sb-owner-page" aria-label="<%= tt('suppliers.aria', 'Suppliers') %>">
  <div class="card">
    <header class="owner-hd">
      <div>
        <h1><%= tt('suppliers.title', 'Suppliers') %> Â· <%= restaurant.name || tt('suppliers.restaurant_fallback', 'Restaurant') %></h1>
        <p class="muted">
          <%= tt('suppliers.subtitle', 'Basic supplier management: contact info, payment terms, and typical lead time (days). Lead time is used to estimate arrival on new purchase orders.') %>
        </p>
      </div>
      <div class="actions">
        <a class="btn ghost sm" href="/owner/<%= restaurant.id %>/inventory/stock">ðŸ¥¬ <%= tt('suppliers.btn_stock', 'Inventory') %></a>
        <a class="btn ghost sm" href="/owner/<%= restaurant.id %>/inventory/purchase_orders">ðŸ§¾ <%= tt('suppliers.btn_po', 'Purchase Orders') %></a>
        <a class="btn ghost sm" href="/owner/<%= restaurant.id %>/inventory/costs">ðŸ“ˆ <%= tt('suppliers.btn_costs', 'Costs') %></a>
      </div>
    </header>

    <%~ include("components/_owner_tabs", { restaurant, active: "inventory", t: it.t }) %>


    <div class="panel card" style="margin-top:14px">
      <h2 class="card-title"><%= tt('suppliers.add_new', 'Add New Supplier') %></h2>

      <form class="form row" method="post" action="/owner/<%= restaurant.id %>/inventory/suppliers/save">
        <input type="hidden" name="id" value="">
        <label class="lbl">
          <%= tt('suppliers.lbl_name', 'Supplier Name') %> *
          <input name="name" required placeholder="<%= tt('suppliers.ph_name', 'e.g. Ocean Fish Ltd.') %>">
        </label>
        <label class="lbl">
          <%= tt('suppliers.lbl_phone', 'Phone') %>
          <input name="phone" placeholder="050-1234567">
        </label>
        <label class="lbl">
          <%= tt('suppliers.lbl_email', 'Email') %>
          <input name="email" type="email" placeholder="sales@supplier.com">
        </label>
        <label class="lbl">
          <%= tt('suppliers.lbl_payment_terms', 'Payment Terms') %>
          <input name="paymentTerms" placeholder="<%= tt('suppliers.ph_payment_terms', 'Net +30') %>">
        </label>
        <label class="lbl">
          <%= tt('suppliers.lbl_lead_time', 'Lead Time (days)') %>
          <input name="leadTimeDays" type="number" min="0" step="1" placeholder="<%= tt('suppliers.ph_lead_time', 'e.g. 2') %>">
        </label>
        <label class="lbl" style="min-width:220px;flex:1">
          <%= tt('suppliers.lbl_notes', 'Notes') %>
          <input name="notes" placeholder="<%= tt('suppliers.ph_notes', 'Delivery days, minimum order, response hours, etc.') %>">
        </label>

        <label class="chk">
          <input type="checkbox" name="isActive" checked>
          <%= tt('suppliers.lbl_active', 'Active') %>
        </label>

        <button class="btn primary sm" type="submit">âž• <%= tt('suppliers.btn_add', 'Add Supplier') %></button>
      </form>
    </div>

    <div class="panel card" style="margin-top:16px">
      <h2 class="card-title"><%= tt('suppliers.all_suppliers', 'All Suppliers') %></h2>

      <% if (!suppliers.length) { %>
        <p class="muted"><%= tt('suppliers.no_suppliers', 'No suppliers yet. Add your first supplier above.') %></p>
      <% } else { %>

        <div class="table">
          <div class="tr th">
            <div><%= tt('suppliers.th_name', 'Name') %></div>
            <div><%= tt('suppliers.th_phone', 'Phone') %></div>
            <div><%= tt('suppliers.th_email', 'Email') %></div>
            <div><%= tt('suppliers.th_payment_terms', 'Payment Terms') %></div>
            <div><%= tt('suppliers.th_lead_time', 'Lead Time (days)') %></div>
            <div><%= tt('suppliers.th_active', 'Active') %></div>
            <div></div>
          </div>

          <% suppliers.forEach(function(s){ %>
            <form class="tr" method="post" action="/owner/<%= restaurant.id %>/inventory/suppliers/save">
              <input type="hidden" name="id" value="<%= esc(s.id) %>">

              <div class="td">
                <input class="in" name="name" required value="<%= esc(s.name) %>">
                <% if (s.notes) { %>
                  <div class="muted small" style="margin-top:6px">
                    <%= tt('suppliers.lbl_notes', 'Notes') %>: <%= esc(s.notes) %>
                  </div>
                <% } %>
              </div>

              <div class="td">
                <input class="in" name="phone" value="<%= esc(s.phone || '') %>" placeholder="â€”">
              </div>

              <div class="td">
                <input class="in" name="email" type="email" value="<%= esc(s.email || '') %>" placeholder="â€”">
              </div>

              <div class="td">
                <input class="in" name="paymentTerms" value="<%= esc(s.paymentTerms || '') %>" placeholder="â€”">
              </div>

              <div class="td">
                <input
                  class="in"
                  name="leadTimeDays"
                  type="number"
                  min="0" step="1"
                  value="<%= (typeof s.leadTimeDays === 'number' ? s.leadTimeDays : '') %>"
                  placeholder="â€”"
                >
                <div class="muted small" style="margin-top:4px">
                  <%= tt('suppliers.lead_time_hint', 'Used as default expected arrival for new orders.') %>
                </div>
              </div>

              <div class="td">
                <label class="chk tiny" title="<%= tt('suppliers.lbl_active', 'Active') %>">
                  <input type="checkbox" name="isActive" <%= (s.isActive === false ? '' : 'checked') %> >
                  <span class="muted small"><%= tt('suppliers.lbl_active', 'Active') %></span>
                </label>
              </div>

              <div class="td right">
                <button class="btn primary sm" type="submit"><%= tt('suppliers.btn_save', 'Save') %></button>

                <button
                  class="btn ghost sm danger"
                  type="submit"
                  formaction="/owner/<%= restaurant.id %>/inventory/suppliers/<%= esc(s.id) %>/delete"
                  formmethod="post"
                  onclick="return confirm('<%= tt('suppliers.confirm_delete', 'Delete this supplier?') %>')"
                  style="margin-right:8px"
                >
                  <%= tt('suppliers.btn_delete', 'Delete') %>
                </button>
              </div>
            </form>
          <% }) %>
        </div>

      <% } %>
    </div>
  </div>
</main>


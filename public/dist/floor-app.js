var gt=Object.defineProperty;var vt=(h,w,j)=>w in h?gt(h,w,{enumerable:!0,configurable:!0,writable:!0,value:j}):h[w]=j;var Ue=(h,w,j)=>vt(h,typeof w!="symbol"?w+"":w,j);import{r as m,t as c,j as e,g as bt,i as xt,c as jt,R as yt}from"./floor-index.js";function wt({restaurantId:h}){const[w,j]=m.useState([]),[s,k]=m.useState(null),[W,I]=m.useState([]),[Y,O]=m.useState(null),[_,D]=m.useState(null),[U,z]=m.useState(null),A=m.useMemo(()=>!s||!_?null:s.tables.find(t=>t.id===_)??null,[s,_]),E=m.useMemo(()=>!s||!U?null:(s.objects??[]).find(t=>t.id===U)??null,[s,U]),[g,Q]=m.useState(null),[V,ee]=m.useState(1),[de,J]=m.useState(!1),[fe,he]=m.useState(""),[ge,xe]=m.useState(!1),[ne,re]=m.useState(null),[v,ie]=m.useState(null),[le,ae]=m.useState(null),[q,x]=m.useState(60),M=bt(),X=m.useMemo(()=>({parquet_blue:{label:c("floor.themes.parquet_blue","Blue parquet"),bg:"url(/floor_assets/floor_parquet_blue.svg)",size:"240px 240px",repeat:"repeat",pos:"center"},parquet_brown:{label:c("floor.themes.parquet_brown","Brown parquet"),bg:"url(/floor_assets/floor_parquet_brown.svg)",size:"240px 240px",repeat:"repeat",pos:"center"},slate_dark:{label:c("floor.themes.slate_dark","Dark slate"),bg:"url(/floor_assets/floor_slate_dark.svg)",size:"240px 240px",repeat:"repeat",pos:"center"},navy_carpet:{label:c("floor.themes.navy_carpet","Deep navy"),bg:"url(/floor_assets/floor_navy_carpet.svg)",size:"240px 240px",repeat:"repeat",pos:"center"},teal_terrazzo:{label:c("floor.themes.teal_terrazzo","Muted teal"),bg:"url(/floor_assets/floor_teal_terrazzo.svg)",size:"240px 240px",repeat:"repeat",pos:"center"}}),[M]),$=t=>!t||t.startsWith("#")?"parquet_blue":t in X?t:"parquet_blue",[L,oe]=m.useState("parquet_blue");m.useEffect(()=>{const t=pe.current;!t||!s||requestAnimationFrame(()=>{const a=s.gridCols*q+48,r=s.gridRows*q+48,o=Math.max(0,(a-t.clientWidth)/2),i=Math.max(0,(r-t.clientHeight)/2);t.scrollLeft=o,t.scrollTop=i})},[s==null?void 0:s.id,s==null?void 0:s.gridCols,s==null?void 0:s.gridRows,q]);const[n,d]=m.useState(!1);m.useEffect(()=>{s&&oe($(s.floorColor))},[s==null?void 0:s.id]);const[u,R]=m.useState(!1),[P,te]=m.useState(1),[se,G]=m.useState({x:0,y:0}),[ke,Ne]=m.useState(!1),[Ae,Pe]=m.useState(!1),pe=m.useRef(null),Oe=m.useRef(null),Ie=m.useRef(null),K="/floor_assets/",_e=t=>Math.max(1,Number(t)||1)*q,ze=(t,a)=>{const r=String(t||"square").toLowerCase(),o=Number(a||0);return r==="booth"?o>=6?{spanX:6,spanY:2}:{spanX:2,spanY:2}:r==="round"?o>=9?{spanX:3,spanY:3}:{spanX:2,spanY:2}:o<=2?{spanX:2,spanY:1}:o<=4?{spanX:2,spanY:2}:{spanX:2,spanY:2}},et=(t,a,r)=>{const o=String(r||"").toLowerCase();return o==="large_booth.svg"||o==="round_table_10.svg"?.88:o==="round_table4.svg"||o==="square_table2.svg"?1.06:1},Be=(t,a=1)=>{const r=Number(t);return Number.isFinite(r)?Math.max(.5,Math.min(1.6,r)):a},ve=t=>{const a=Number(t);return Number.isFinite(a)?(Math.round(a/45)*45%360+360)%360:0},tt=t=>String(t||"").toLowerCase()==="bar"?1.8:1,ce=(t,a)=>{const r=String(t||"rect").toLowerCase(),o=Number(a||0);if(r==="round")return o>=9?`${K}round_table_10.svg`:`${K}round_table4.svg`;if(r==="booth")return o>=6?`${K}large_booth.svg`:`${K}booth4.svg`;const l=[2,4,6,8,10].reduce((b,p)=>Math.abs(p-o)<Math.abs(b-o)?p:b,4);return`${K}square_table${l}.svg`},me=(t,a,r,o)=>{const i=String(o||"").toLowerCase(),l={bar:"bar.svg",chair:"chair.svg",plant:"plant.svg",door:"door.svg",floor_brown:"floor_brown.svg",corner_partitaion:"corner_partitaion.svg",cyclic:"cyclic_partition.svg",cyclic_partition:"cyclic_partition.svg",horizintal_partitaion:"horizintal_partitaion.svg",vertical_partition:"vertical_partition.svg"};return l[i]?`${K}${l[i]}`:t==="door"?`${K}door.svg`:t==="bar"?`${K}bar.svg`:t==="plant"?`${K}plant.svg`:(a||1)===1&&(r||1)===1?`${K}corner_partitaion.svg`:(a||1)>(r||1)?`${K}horizintal_partitaion.svg`:`${K}vertical_partition.svg`},Te=t=>{const a=Number(t.gridRows||0),r=Number(t.gridCols||0),o=Math.max(0,a*r),i=Array.isArray(t.gridMask)?t.gridMask.slice(0,o):[];for(;i.length<o;)i.push(1);return{...t,gridMask:i,floorColor:t.floorColor||"parquet_blue"}},Ce=(t,a,r,o)=>{if(!(s!=null&&s.gridMask))return!0;const i=s.gridCols;for(let l=a;l<a+o;l++)for(let b=t;b<t+r;b++){if(b<0||l<0||b>=i||l>=s.gridRows)return!1;const p=l*i+b;if(s.gridMask[p]!==1)return!1}return!0};m.useEffect(()=>{h&&(fetch(`/api/floor-layouts/${h}`).then(t=>t.ok?t.json():[]).then(t=>{j(t);const a=t.find(i=>i.isActive);k(a?Te(a):t[0]?Te(t[0]):null);const r=t.flatMap(i=>i.tables),o=Math.max(...r.map(i=>i.tableNumber),0);ee(o+1)}).catch(t=>console.error("Failed to load layouts:",t)),fetch(`/api/floor-sections/${h}`).then(t=>t.ok?t.json():[]).then(t=>{I(t),t.length>0&&O(t[0])}).catch(t=>console.error("Failed to load sections:",t)))},[h]),m.useEffect(()=>{const t=r=>{r.code==="Space"&&Pe(!0)},a=r=>{r.code==="Space"&&(Pe(!1),Ne(!1))};return window.addEventListener("keydown",t),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",a)}},[]);const De=async()=>{if(!fe.trim()){alert(c("floor.error.enter_name","Please enter a layout name"));return}try{const t=await fetch(`/api/floor-layouts/${h}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:fe,gridRows:8,gridCols:12,gridMask:Array.from({length:96},()=>1),tables:[],objects:[],isActive:w.length===0})});if(t.ok){const a=await t.json();j([...w,a]),k(a),he(""),J(!1);try{const r=await fetch(`/api/floor-layouts/${h}/${a.id}/activate`,{method:"POST",credentials:"include"});if(r.ok)j(o=>o.map(i=>({...i,isActive:i.id===a.id})));else{const o=await r.text().catch(()=>"");console.error("[FloorEditor] auto-activate after create failed",{status:r.status,statusText:r.statusText,body:o})}}catch(r){console.error("[FloorEditor] auto-activate after create threw",r)}}else{const a=await t.json().catch(()=>null),r=(a==null?void 0:a.error)||c("floor.error.server","Server error: {status} {statusText}").replace("{status}",String(t.status)).replace("{statusText}",t.statusText);alert(c("floor.error.create","Error creating layout: {error}").replace("{error}",r))}}catch(t){console.error("Create layout failed:",t),alert(c("floor.error.create","Error creating layout: {error}").replace("{error}",t instanceof Error?t.message:String(t)))}},st=async t=>{if(confirm(c("floor.confirm.delete_layout","Are you sure you want to delete this layout?")))try{const a=await fetch(`/api/floor-layouts/${h}/${t}`,{method:"DELETE",credentials:"include"});if(a.ok){const r=w.filter(o=>o.id!==t);j(r),(s==null?void 0:s.id)===t&&k(r[0]||null)}else{const r=await a.json();alert(r.error||c("floor.error.delete","Delete failed"))}}catch(a){console.error("Delete failed:",a),alert(c("floor.error.delete_general","Error deleting layout"))}},at=async t=>{const a=prompt(c("floor.prompt.duplicate_name","Enter name for duplicated layout:"));if(a)try{const r=await fetch(`/api/floor-layouts/${h}/${t}/duplicate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:a})});if(r.ok){const o=await r.json();j([...w,o]),k(o)}else alert(c("floor.error.duplicate","Error duplicating layout"))}catch(r){console.error("Duplicate failed:",r),alert(c("floor.error.duplicate","Error duplicating layout"))}},nt=async t=>{try{(await fetch(`/api/floor-layouts/${h}/${t}/activate`,{method:"POST",credentials:"include"})).ok&&j(w.map(r=>({...r,isActive:r.id===t})))}catch(a){console.error("Set active failed:",a)}},qe=(t,a,r)=>Math.max(a,Math.min(r,t)),Fe=(t,a,r,o)=>s?{x:qe(t,0,Math.max(0,s.gridCols-r)),y:qe(a,0,Math.max(0,s.gridRows-o))}:{x:t,y:a},rt=(t,a,r,o)=>{if(!s)return{x:t,y:a};const l=(s.objects??[]).filter(N=>N.type==="wall"||N.type==="divider");if(!l.length)return{x:t,y:a};const b={x:t,y:a},p=[],y=(N,C)=>{const f=Fe(N,C,r,o),T=Math.abs(f.x-b.x)+Math.abs(f.y-b.y);p.push({...f,score:T})};return l.forEach(N=>{const C=N.gridX,f=N.gridY,T=N.gridX+(N.spanX||1),B=N.gridY+(N.spanY||1);t+r>C&&t<T&&(y(t,f-o),y(t,B)),a+o>f&&a<B&&(y(C-r,a),y(T,a))}),p.length?(p.sort((N,C)=>N.score-C.score),p[0].score<=1?{x:p[0].x,y:p[0].y}:{x:t,y:a}):{x:t,y:a}},Me=t=>Math.max(.35,Math.min(2.5,t)),ot=()=>{if(!pe.current||!s)return;const t=pe.current.getBoundingClientRect(),a=q,r=s.gridCols*a+20,o=s.gridRows*a+20,i=Me(Math.min((t.width-40)/r,(t.height-40)/o,1.2));te(i);const l=Math.round((t.width-r*i)/2),b=Math.round(20);G({x:l,y:b})},Ye=(t,a,r)=>{if(!pe.current)return;const o=pe.current.getBoundingClientRect(),i=a-o.left,l=r-o.top;G(b=>{const y=t/P,N=Math.round(i-(i-b.x)*y),C=Math.round(l-(l-b.y)*y);return{x:N,y:C}}),te(t)},it=t=>{if(!(t.ctrlKey||t.metaKey))return;t.preventDefault();const a=t.deltaY,r=Me(P*(a>0?.9:1.1));Ye(r,t.clientX,t.clientY)},lt=t=>{const a=t.button===1,r=Ae&&t.button===0;if(!a&&!r)return;t.preventDefault(),Ne(!0);const o={x:t.clientX,y:t.clientY},i={...se},l=p=>{const y=p.clientX-o.x,N=p.clientY-o.y;G({x:i.x+y,y:i.y+N})},b=()=>{Ne(!1),window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",b)};window.addEventListener("mousemove",l),window.addEventListener("mouseup",b)},ct=(t,a,r,o,i)=>{if(!s)return{x:t,y:a,guides:{v:[],h:[]}};const l=[];for(const S of s.tables)(i==null?void 0:i.kind)==="table"&&(i!=null&&i.id)&&S.id===i.id||l.push({left:S.gridX,top:S.gridY,right:S.gridX+(S.spanX||1),bottom:S.gridY+(S.spanY||1),cx2:S.gridX*2+(S.spanX||1),cy2:S.gridY*2+(S.spanY||1)});for(const S of s.objects??[])(i==null?void 0:i.kind)==="object"&&(i!=null&&i.id)&&S.id===i.id||l.push({left:S.gridX,top:S.gridY,right:S.gridX+(S.spanX||1),bottom:S.gridY+(S.spanY||1),cx2:S.gridX*2+(S.spanX||1),cy2:S.gridY*2+(S.spanY||1)});const b=t,p=a,y=t+r,N=a+o,C=t*2+r,f=a*2+o,T=1;let B=null,F=null;const H={v:[],h:[]},Xe=(S,we)=>{Math.abs(S)>T||(B===null||Math.abs(S)<Math.abs(B))&&(B=S,H.v=[we])},Le=(S,we)=>{Math.abs(S)>T||(F===null||Math.abs(S)<Math.abs(F))&&(F=S,H.h=[we])};for(const S of l){Xe(S.left-b,S.left),Xe(S.right-y,S.right);const we=S.cx2-C;we%2===0&&Xe(we/2,S.cx2/2),Le(S.top-p,S.top),Le(S.bottom-N,S.bottom);const We=S.cy2-f;We%2===0&&Le(We/2,S.cy2/2)}return{x:B!==null?t+B:t,y:F!==null?a+F:a,guides:H}},dt=(t,a,r,o,i,l,b,p)=>{const y=Fe(t,a,r,o);if(b)return{x:y.x,y:y.y,guides:{v:[],h:[]}};const C=i==="table"&&String(l).toLowerCase()==="booth"||i==="object"&&(l==="bar"||l==="door")?rt(y.x,y.y,r,o):y,f=ct(C.x,C.y,r,o,p),T=Fe(f.x,f.y,r,o);return{x:T.x,y:T.y,guides:f.guides}},je=(t,a,r,o,i,l,b,p)=>dt(t,a,r,o,i,l,b,p),Ee=(t,a)=>{if(!s)return null;const r=Oe.current;if(!r)return null;const o=r.getBoundingClientRect(),i=s.gridCols*q,l=s.gridRows*q,b=o.width/Math.max(1,i),p=o.height/Math.max(1,l),N=getComputedStyle(r).direction==="rtl"?(o.right-t)/b:(t-o.left)/b,C=(a-o.top)/p,f=Math.floor(N/q),T=Math.floor(C/q);return Number.isNaN(f)||Number.isNaN(T)||f<0||T<0||f>=s.gridCols||T>=s.gridRows?null:{x:f,y:T}},Z=(t,a,r,o,i)=>{s&&(t.preventDefault(),t.stopPropagation(),D(null),z(null),D(null),z(null),D(null),ie({kind:a,mode:"new",spanX:r,spanY:o,payload:i}),ae(null))},Ke=(t,a,r,o,i)=>{s&&(t.preventDefault(),t.stopPropagation(),ie({kind:a,mode:"existing",spanX:o,spanY:i,tableId:a==="table"?r:void 0,objectId:a==="object"?r:void 0}),ae(null))};m.useEffect(()=>{if(!v||!s)return;const t=o=>{var C,f;const i=Ee(o.clientX,o.clientY);if(!i){ae(null);return}const l=i.x-Math.floor(v.spanX/2),b=i.y-Math.floor(v.spanY/2),p=o.shiftKey,y=v.mode==="existing"?{kind:v.kind,id:v.kind==="table"?v.tableId:v.objectId}:void 0,N=je(l,b,v.spanX,v.spanY,v.kind,((C=v.payload)==null?void 0:C.shape)??((f=v.payload)==null?void 0:f.objectType),p,y);if(!Ce(N.x,N.y,v.spanX,v.spanY)){ae(null);return}ae({x:N.x,y:N.y}),re({x:N.x,y:N.y})},a=()=>{var l,b,p,y,N,C,f;if(!le){ie(null),ae(null),re(null);return}const o=le.x,i=le.y;if(v.mode==="existing")v.kind==="table"&&v.tableId?ye(v.tableId,{gridX:o,gridY:i}):v.kind==="object"&&v.objectId&&be(v.objectId,{gridX:o,gridY:i});else if(v.kind==="table"){const T=Number(((l=v.payload)==null?void 0:l.seats)??2),B=((b=v.payload)==null?void 0:b.shape)??"square",F={id:`T${Date.now()}`,name:`T${V}`,tableNumber:V,gridX:o,gridY:i,spanX:v.spanX,spanY:v.spanY,seats:T,shape:B,scale:1,rotationDeg:0,assetFile:(p=v.payload)==null?void 0:p.assetFile,kind:"table",sectionId:Y==null?void 0:Y.id};ee(H=>H+1),k({...s,tables:[...s.tables,F]})}else{const T={id:`O${Date.now()}`,type:((y=v.payload)==null?void 0:y.objectType)??"visual",gridX:o,gridY:i,spanX:v.spanX,spanY:v.spanY,label:(N=v.payload)==null?void 0:N.objectLabel,assetFile:(C=v.payload)==null?void 0:C.assetFile,kind:((f=v.payload)==null?void 0:f.objectKind)??"object",scale:1,rotationDeg:0};k({...s,objects:[...s.objects??[],T]})}ie(null),ae(null),re(null)},r=o=>{o.key==="Escape"&&(ie(null),ae(null),re(null))};return window.addEventListener("mousemove",t),window.addEventListener("mouseup",a,{once:!0}),window.addEventListener("keydown",r),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("keydown",r)}},[v,s,q,le,V,Y==null?void 0:Y.id]);const ut=t=>{if(t.preventDefault(),!g||!s)return;const a=Ee(t.clientX,t.clientY);if(!a)return;const r=a.x,o=a.y,i=!!t.shiftKey;if(g.kind==="table"&&g.mode==="new"&&g.shape){const l=Number(g.seats??(g.shape==="booth"?4:2)),b=g.spanX&&g.spanY?{spanX:g.spanX,spanY:g.spanY}:ze(g.shape,l),p=je(r,o,b.spanX,b.spanY,"table",g.shape,i);if(!Ce(p.x,p.y,b.spanX,b.spanY)){alert(c("floor.error.placement_outside","Cannot place item outside the restaurant shape"));return}const y={id:`T${Date.now()}`,name:`Table ${V}`,tableNumber:V,gridX:p.x,gridY:p.y,spanX:b.spanX,spanY:b.spanY,seats:l,shape:g.shape,assetFile:g.assetFile,kind:"table",sectionId:Y==null?void 0:Y.id,scale:1,rotationDeg:0};k({...s,tables:[...s.tables,y]}),ee(V+1),z(null),D(null),D(y.id),z(null),D(null)}else if(g.kind==="table"&&g.mode==="existing"&&g.tableId){const l=s.tables.find(p=>p.id===g.tableId);if(!l)return;const b=je(r,o,l.spanX||1,l.spanY||1,"table",l.shape,i,{kind:"table",id:l.id});if(!Ce(b.x,b.y,l.spanX||1,l.spanY||1)){alert(c("floor.error.move_outside","Cannot move item outside the restaurant shape"));return}k({...s,tables:s.tables.map(p=>p.id===g.tableId?{...p,gridX:b.x,gridY:b.y}:p)})}else if(g.kind==="object"&&g.mode==="new"&&g.objectType){const l=s.objects??[],p={wall:{spanX:4,spanY:1,rotation:0,label:"wall_h"},divider:{spanX:2,spanY:1,rotation:0,label:"partition"},door:{spanX:1,spanY:1,rotation:0,label:"Door"},bar:{spanX:5,spanY:1,rotation:0,label:"Bar"},plant:{spanX:1,spanY:1,rotation:0,label:""}}[String(g.objectType)]??{spanX:1,spanY:1},y={spanX:Math.max(1,Number(g.spanX??p.spanX)||1),spanY:Math.max(1,Number(g.spanY??p.spanY)||1)},N=je(r,o,y.spanX,y.spanY,"object",g.objectType,i);if(!Ce(N.x,N.y,y.spanX,y.spanY)){alert(c("floor.error.placement_outside","Cannot place item outside the restaurant shape"));return}const C={id:`O${Date.now()}`,type:g.objectType,gridX:N.x,gridY:N.y,spanX:y.spanX,spanY:y.spanY,rotation:g.rotation??p.rotation,label:g.objectLabel??p.label,assetFile:g.assetFile,kind:g.objectKind??"object",scale:1,rotationDeg:0};k({...s,objects:[...l,C]}),D(null),z(null),D(null),z(C.id),D(null)}else if(g.kind==="object"&&g.mode==="existing"&&g.objectId){const l=s.objects??[],b=l.find(y=>y.id===g.objectId);if(!b)return;const p=je(r,o,b.spanX||1,b.spanY||1,"object",b.type,i,{kind:"object",id:b.id});if(!Ce(p.x,p.y,b.spanX||1,b.spanY||1)){alert(c("floor.error.move_outside","Cannot move item outside the restaurant shape"));return}k({...s,objects:l.map(y=>y.id===g.objectId?{...y,gridX:p.x,gridY:p.y}:y)})}Q(null),re(null)},pt=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move";const a=Ee(t.clientX,t.clientY);a&&re(a)},ht=t=>{s&&(k({...s,tables:s.tables.filter(a=>a.id!==t)}),D(null),z(null),D(null))},mt=t=>{if(!s)return;const a=s.objects??[];k({...s,objects:a.filter(r=>r.id!==t)}),z(null),D(null)},be=(t,a)=>{if(!s)return;const o=(s.objects??[]).map(i=>i.id===t?{...i,...a}:i);k({...s,objects:o})},ye=(t,a)=>{if(!s)return;const r=s.tables.map(o=>o.id===t?{...o,...a}:o);k({...s,tables:r})},ft=async()=>{if(s)try{const t=await fetch(`/api/floor-layouts/${h}/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(t.ok){let a=!1,r=null;try{const i=await fetch(`/api/floor-layouts/${h}/${s.id}/activate`,{method:"POST",credentials:"include"});if(a=i.ok,!i.ok){const l=await i.text().catch(()=>"");r=l||`${i.status} ${i.statusText}`,console.error("[FloorEditor] activate failed",{status:i.status,statusText:i.statusText,body:l})}}catch(i){r=i instanceof Error?i.message:String(i),console.error("[FloorEditor] activate threw",i)}j(w.map(i=>({...i,isActive:i.id===s.id})));const o=a?c("floor.success.save_and_activate","Layout saved and activated âœ…"):c("floor.success.save_but_activate_failed","Layout saved âœ… but activation failed: {error}").replace("{error}",r||"unknown");alert("âœ… "+o)}else{const a=await t.json();alert("âŒ "+c("floor.error.save","Error saving: {error}").replace("{error}",a.error||"Unknown error"))}}catch(t){console.error("Save failed:",t),alert("âŒ "+c("floor.error.save","Error saving: {error}").replace("{error}",t instanceof Error?t.message:String(t)))}};return s?e.jsxs("div",{className:"floor-editor",children:[e.jsxs("div",{className:"layout-tabs-bar",children:[e.jsx("div",{className:"layout-tabs",children:w.map(t=>e.jsxs("button",{className:`layout-tab ${s.id===t.id?"active":""} ${t.isActive?"is-active":""}`,onClick:()=>k(Te(t)),title:t.isActive?c("floor.toolbar.active_hint","Active layout (shown in live view)"):"",children:[t.name,t.isActive&&e.jsx("span",{className:"active-badge",children:"â˜…"})]},t.id))}),e.jsxs("div",{className:"layout-actions",children:[e.jsx("button",{className:"btn-icon-small",onClick:()=>J(!0),title:c("floor.btn_new_layout","New Layout"),children:"âž•"}),e.jsx("button",{className:"btn-icon-small",onClick:()=>at(s.id),title:c("floor.btn_duplicate","Duplicate"),children:"ðŸ“‹"}),!s.isActive&&e.jsx("button",{className:"btn-icon-small",onClick:()=>nt(s.id),title:c("floor.btn_set_active","Set as Active"),children:"â­"}),w.length>1&&e.jsx("button",{className:"btn-icon-small btn-danger",onClick:()=>st(s.id),title:c("floor.btn_delete","Delete"),children:"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{className:"editor-content",children:[e.jsxs("div",{className:"editor-sidebar",children:[W.length>0&&e.jsxs("div",{className:"sections-tabs",children:[e.jsx("h3",{children:c("floor.sections.title","Sections")}),e.jsx("div",{className:"tabs",children:W.map(t=>e.jsx("button",{className:`tab ${(Y==null?void 0:Y.id)===t.id?"active":""}`,onClick:()=>O(t),children:t.name},t.id))}),e.jsxs("label",{className:"fe-toggle",children:[e.jsx("input",{type:"checkbox",checked:ge,onChange:t=>xe(t.target.checked)}),e.jsx("span",{children:c("floor.sections.show_only_active","Show only active section")})]})]}),e.jsxs("h2",{children:["ðŸ§© ",c("floor.assets.title","Assets")]}),e.jsx("h3",{className:"fe-subtitle",children:c("floor.assets.seating","Seating")}),e.jsxs("div",{className:"palette",children:[e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",5,2,{shape:"rect",seats:5,assetFile:"bar.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:`${K}bar.svg`,alt:""})}),e.jsx("span",{children:"bar.svg â€¢ 5 (5Ã—2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",2,2,{shape:"booth",seats:4,assetFile:"booth4.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("booth",4),alt:""})}),e.jsx("span",{children:"booth4.svg â€¢ 4 (2Ã—2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",6,2,{shape:"booth",seats:6,assetFile:"large_booth.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("booth",6),alt:""})}),e.jsx("span",{children:"large_booth.svg â€¢ 6 (6Ã—2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"object",1,1,{objectType:"chair",objectLabel:"chair",assetFile:"chair.svg",objectKind:"object"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:`${K}chair.svg`,alt:""})}),e.jsx("span",{children:"chair.svg â€¢ 1 (1Ã—1)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"object",1,1,{objectType:"plant",objectLabel:"plant",assetFile:"plant.svg",objectKind:"object"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:`${K}plant.svg`,alt:""})}),e.jsx("span",{children:"plant.svg â€¢ 1 (1Ã—1)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",2,2,{shape:"round",seats:4,assetFile:"round_table4.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("round",4),alt:""})}),e.jsx("span",{children:"round_table4.svg â€¢ 4 (2Ã—2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",3,3,{shape:"round",seats:10,assetFile:"round_table_10.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("round",10),alt:""})}),e.jsx("span",{children:"round_table_10.svg â€¢ 10 (3Ã—3)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",2,1,{shape:"square",seats:2,assetFile:"square_table2.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("square",2),alt:""})}),e.jsx("span",{children:"square_table2.svg â€¢ 2 (2Ã—1)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",2,2,{shape:"square",seats:4,assetFile:"square_table4.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("square",4),alt:""})}),e.jsx("span",{children:"square_table4.svg â€¢ 4 (2Ã—2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",2,2,{shape:"square",seats:6,assetFile:"square_table6.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("square",6),alt:""})}),e.jsx("span",{children:"square_table6.svg â€¢ 6 (2Ã—2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",2,2,{shape:"square",seats:8,assetFile:"square_table8.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("square",8),alt:""})}),e.jsx("span",{children:"square_table8.svg â€¢ 8 (2Ã—2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"table",2,2,{shape:"square",seats:10,assetFile:"square_table10.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:ce("square",10),alt:""})}),e.jsx("span",{children:"square_table10.svg â€¢ 10 (2Ã—2)"})]})]}),e.jsx("h3",{className:"fe-subtitle",style:{marginTop:14},children:c("floor.assets.visual_only","Visual only")}),e.jsxs("div",{className:"palette",children:[e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"object",1,1,{objectType:"visual",objectLabel:"corner_partitaion",assetFile:"corner_partitaion.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",1,1,"corner_partitaion"),alt:""})}),e.jsx("span",{children:"corner_partitaion.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"object",2,2,{objectType:"visual",objectLabel:"cyclic_partition",assetFile:"cyclic_partition.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",2,2,"cyclic_partition"),alt:""})}),e.jsx("span",{children:"cyclic_partition.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"object",1,1,{objectType:"door",objectLabel:"door",assetFile:"door.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("door",1,1,"door"),alt:""})}),e.jsx("span",{children:"door.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"object",1,1,{objectType:"visual",objectLabel:"floor_brown",assetFile:"floor_brown.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",1,1,"floor_brown"),alt:""})}),e.jsx("span",{children:"floor_brown.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"object",4,1,{objectType:"visual",objectLabel:"horizintal_partitaion",assetFile:"horizintal_partitaion.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",4,1,"horizintal_partitaion"),alt:""})}),e.jsx("span",{children:"horizintal_partitaion.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>Z(t,"object",1,4,{objectType:"visual",objectLabel:"vertical_partition",assetFile:"vertical_partition.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",1,4,"vertical_partition"),alt:""})}),e.jsx("span",{children:"vertical_partition.svg"})]})]}),e.jsxs("div",{className:"properties-panel",children:[e.jsx("h3",{children:c("floor.map.title","Map")}),e.jsxs("label",{children:[c("floor.map.cell_size","Cell size: {size}px").replace("{size}",String(q)),e.jsx("input",{type:"range",min:"40",max:"110",value:q,onChange:t=>x(Number(t.target.value))})]}),e.jsxs("label",{children:[c("floor.map.floor_label","Floor:"),e.jsx("select",{value:L,onChange:t=>{const a=$(String(t.target.value||"parquet_blue"));oe(a),s&&k({...s,floorColor:a})},children:Object.keys(X).map(t=>e.jsx("option",{value:t,children:X[t].label},t))})]}),e.jsxs("div",{className:"row",style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn-icon-small",onClick:()=>{d(t=>!t),D(null),z(null),D(null),z(null),D(null)},children:n?`âœ… ${c("floor.shape.done","Done shape")}`:`âœï¸ ${c("floor.shape.edit","Edit shape")}`}),e.jsxs("button",{className:"btn-icon-small",onClick:()=>{if(!s)return;const t=s.gridRows*s.gridCols;k({...s,gridMask:Array.from({length:t},()=>1)})},title:c("floor.shape.reset_title","Reset shape"),children:["â†º ",c("floor.shape.reset","Reset")]}),e.jsxs("button",{className:"btn-icon-small",onClick:()=>{s!=null&&s.gridMask&&k({...s,gridMask:s.gridMask.map(t=>t===1?0:1)})},title:c("floor.shape.invert_title","Invert shape"),children:["â‡„ ",c("floor.shape.invert","Invert")]})]}),n&&e.jsx("div",{className:"fe-hint",style:{marginTop:8},children:c("floor.shape.paint_hint","Paint the restaurant shape: click/drag cells to enable/disable.")})]}),A&&e.jsxs("div",{className:"properties-panel",children:[e.jsx("h3",{children:c("floor.properties.selected_table","Selected: {name}").replace("{name}",A.name)}),e.jsxs("label",{children:[c("floor.properties.name","Name:"),e.jsx("input",{type:"text",value:A.name,onChange:t=>ye(A.id,{name:t.target.value})})]}),e.jsxs("label",{children:[c("floor.properties.seats","Seats:"),e.jsx("input",{type:"number",min:"1",max:"12",value:A.seats,onChange:t=>{const a=Math.max(1,Number(t.target.value)||1);ye(A.id,{seats:a})}})]}),e.jsxs("label",{children:[c("floor.properties.size","Size:"),e.jsx("input",{type:"range",min:"0.6",max:"1.4",step:"0.05",className:"range-ltr",value:A.scale??1,onChange:t=>ye(A.id,{scale:Number(t.target.value)})}),e.jsxs("span",{style:{marginInlineStart:8},children:[Math.round((A.scale??1)*100),"%"]})]}),e.jsxs("div",{className:"row",style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{opacity:.85},children:c("floor.properties.rotate","Rotate:")}),e.jsx("button",{className:"btn-icon-small",onClick:()=>ye(A.id,{rotationDeg:ve((A.rotationDeg??0)-45)}),title:"Rotate -45Â°",children:"â†º"}),e.jsxs("span",{style:{minWidth:54,textAlign:"center",opacity:.9},children:[ve(A.rotationDeg??0),"Â°"]}),e.jsx("button",{className:"btn-icon-small",onClick:()=>ye(A.id,{rotationDeg:ve((A.rotationDeg??0)+45)}),title:"Rotate +45Â°",children:"â†»"})]}),e.jsxs("button",{className:"btn-danger",onClick:()=>ht(A.id),children:["ðŸ—‘ï¸ ",c("common.btn_delete","Delete")]})]}),E&&e.jsxs("div",{className:"properties-panel",children:[e.jsx("h3",{children:c("floor.properties.selected_object","Selected: {type}").replace("{type}",E.type)}),e.jsxs("label",{children:[c("floor.properties.name","Name:"),e.jsx("input",{type:"text",value:E.label??"",onChange:t=>be(E.id,{label:t.target.value})})]}),e.jsxs("div",{className:"row",style:{display:"flex",gap:8},children:[e.jsxs("label",{style:{flex:1},children:["W:",e.jsx("input",{type:"number",min:"1",max:"12",value:E.spanX,onChange:t=>be(E.id,{spanX:Math.max(1,Number(t.target.value)||1)})})]}),e.jsxs("label",{style:{flex:1},children:["H:",e.jsx("input",{type:"number",min:"1",max:"12",value:E.spanY,onChange:t=>be(E.id,{spanY:Math.max(1,Number(t.target.value)||1)})})]})]}),e.jsxs("label",{children:[c("floor.properties.size","Size:"),e.jsx("input",{type:"range",min:"0.6",max:"1.4",step:"0.05",className:"range-ltr",value:E.scale??1,onChange:t=>be(E.id,{scale:Number(t.target.value)})}),e.jsxs("span",{style:{marginInlineStart:8},children:[Math.round((E.scale??1)*100),"%"]})]}),e.jsxs("div",{className:"row",style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{opacity:.85},children:c("floor.properties.rotate","Rotate:")}),e.jsx("button",{className:"btn-icon-small",onClick:()=>be(E.id,{rotationDeg:ve((E.rotationDeg??E.rotation??0)-45)}),title:"Rotate -45Â°",children:"â†º"}),e.jsxs("span",{style:{minWidth:54,textAlign:"center",opacity:.9},children:[ve(E.rotationDeg??E.rotation??0),"Â°"]}),e.jsx("button",{className:"btn-icon-small",onClick:()=>be(E.id,{rotationDeg:ve((E.rotationDeg??E.rotation??0)+45)}),title:"Rotate +45Â°",children:"â†»"})]}),e.jsxs("button",{className:"btn-danger",onClick:()=>mt(E.id),children:["ðŸ—‘ï¸ ",c("common.btn_delete","Delete")]})]}),e.jsxs("button",{className:"btn-save",onClick:ft,children:["ðŸ’¾ ",c("floor.btn_save_layout","Save Layout")]})]}),e.jsxs("div",{className:`editor-canvas ${ke?"is-panning":""}`,ref:pe,onWheel:it,onMouseDown:lt,children:[e.jsxs("div",{className:"fe-canvas-controls",children:[e.jsx("button",{className:"btn-icon-small",onClick:()=>{var t,a;return Ye(Me(P*1.1),(((t=pe.current)==null?void 0:t.getBoundingClientRect().left)||0)+40,(((a=pe.current)==null?void 0:a.getBoundingClientRect().top)||0)+40)},title:c("floor.toolbar.zoom_in","Zoom in"),children:"ï¼‹"}),e.jsx("button",{className:"btn-icon-small",onClick:()=>{var t,a;return Ye(Me(P*.9),(((t=pe.current)==null?void 0:t.getBoundingClientRect().left)||0)+40,(((a=pe.current)==null?void 0:a.getBoundingClientRect().top)||0)+40)},title:c("floor.toolbar.zoom_out","Zoom out"),children:"ï¼"}),e.jsx("button",{className:"btn-icon-small",onClick:ot,title:c("floor.toolbar.fit_screen","Fit to screen"),children:"â¤¢"}),e.jsxs("div",{className:"fe-zoom-readout",children:[Math.round(P*100),"%"]}),e.jsx("div",{className:"fe-hint",children:Ae?c("floor.hints.pan_drag","Pan: drag"):c("floor.hints.controls","Tip: hold Space to pan, Ctrl+wheel to zoom")})]}),(()=>{const t=X[L];return e.jsxs("div",{className:"fe-grid",ref:Oe,style:{direction:"ltr",gridTemplateColumns:`repeat(${s.gridCols}, ${q}px)`,gridTemplateRows:`repeat(${s.gridRows}, ${q}px)`,transform:`translate(${se.x}px, ${se.y}px) scale(${P})`,transformOrigin:"0 0","--cell":`${q}px`,"--floor-bg":t.bg,"--floor-bg-size":t.size,"--floor-bg-repeat":t.repeat,"--floor-bg-position":t.pos},onDragOver:n?void 0:pt,onDrop:n?void 0:ut,onDragLeave:()=>re(null),children:[(()=>{if(!ne||!g||!s)return null;const a=q,r=10,o=()=>{if(g.kind==="table"){if(g.mode==="new"){const f=String(g.shape||"square"),T=Number(g.seats??(f==="booth"?4:2)),B=g.spanX&&g.spanY?{spanX:g.spanX,spanY:g.spanY}:ze(f,T);return{spanX:B.spanX,spanY:B.spanY,subtype:f}}const C=s.tables.find(f=>f.id===g.tableId);if(C)return{spanX:C.spanX||1,spanY:C.spanY||1,subtype:C.shape}}if(g.kind==="object"){if(g.mode==="new"){const f={spanX:Math.max(1,Number(g.spanX??1)||1),spanY:Math.max(1,Number(g.spanY??1)||1)};return{spanX:f.spanX,spanY:f.spanY,subtype:g.objectType}}const C=(s.objects??[]).find(f=>f.id===g.objectId);if(C)return{spanX:C.spanX||1,spanY:C.spanY||1,subtype:C.type}}return{spanX:1,spanY:1,subtype:""}},{spanX:i,spanY:l,subtype:b}=o(),p=je(ne.x,ne.y,i,l,g.kind,String(b),!1,g.mode==="existing"?{kind:g.kind,id:g.kind==="table"?g.tableId:g.objectId}:void 0),y=r+p.x*a,N=r+p.y*a;return e.jsxs(e.Fragment,{children:[p.guides.v.map((C,f)=>e.jsx("div",{className:"fe-guide-line v",style:{left:r+C*a}},`pv-v-${f}`)),p.guides.h.map((C,f)=>e.jsx("div",{className:"fe-guide-line h",style:{top:r+C*a}},`pv-h-${f}`)),e.jsx("div",{className:"fe-drop-preview",style:{left:y,top:N,width:i*a,height:l*a}})]})})(),v&&le&&(()=>{var b,p,y,N,C,f,T,B;const a=q,r=10,o=r+le.x*a,i=r+le.y*a;let l="";if(v.mode==="existing"){if(v.kind==="table"&&v.tableId){const F=s.tables.find(H=>H.id===v.tableId);F&&(l=F.assetFile?`${K}${F.assetFile}`:ce(F.shape,F.seats))}if(v.kind==="object"&&v.objectId){const F=(s.objects??[]).find(H=>H.id===v.objectId);F&&(l=F.assetFile?`${K}${F.assetFile}`:me(F.type,F.spanX,F.spanY,F.label))}}else if(v.kind==="table"){const F=String(((b=v.payload)==null?void 0:b.shape)??"square"),H=Number(((p=v.payload)==null?void 0:p.seats)??2);l=(y=v.payload)!=null&&y.assetFile?`${K}${(N=v.payload)==null?void 0:N.assetFile}`:ce(F,H)}else{const F=((C=v.payload)==null?void 0:C.objectType)??"visual";l=(f=v.payload)!=null&&f.assetFile?`${K}${(T=v.payload)==null?void 0:T.assetFile}`:me(F,v.spanX,v.spanY,(B=v.payload)==null?void 0:B.objectLabel)}return e.jsx("div",{className:"fe-drop-preview",style:{left:o,top:i,width:v.spanX*a,height:v.spanY*a,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:l&&e.jsx("img",{src:l,alt:"",style:{width:"100%",height:"100%",objectFit:"contain",display:"block",opacity:.75}})})})(),Array.from({length:s.gridRows*s.gridCols}).map((a,r)=>{var C;const o=Math.floor(r/s.gridCols),i=r%s.gridCols,l=s.tables.find(f=>ge&&Y&&String(f.sectionId||"")!==String(Y.id)?!1:i>=f.gridX&&i<f.gridX+f.spanX&&o>=f.gridY&&o<f.gridY+f.spanY),p=(s.objects??[]).find(f=>i>=f.gridX&&i<f.gridX+f.spanX&&o>=f.gridY&&o<f.gridY+f.spanY),y=l&&l.gridX===i&&l.gridY===o,N=p&&p.gridX===i&&p.gridY===o;return e.jsxs("div",{className:`fe-grid-cell ${(()=>{var B;const f=o*s.gridCols+i;return(((B=s.gridMask)==null?void 0:B[f])??1)===1?"active":"inactive"})()}`,onMouseDown:f=>{if(!n||!s)return;f.preventDefault(),R(!0);const T=o*s.gridCols+i,B=s.gridRows*s.gridCols,F=(s.gridMask??Array.from({length:B},()=>1)).slice(),H=F[T]===1?0:1;Ie.current=H,F[T]=H,k({...s,gridMask:F})},onMouseEnter:f=>{if(!n||!u||!s)return;f.preventDefault();const T=Ie.current;if(T==null)return;const B=o*s.gridCols+i,F=s.gridRows*s.gridCols,H=(s.gridMask??Array.from({length:F},()=>1)).slice();H[B]!==T&&(H[B]=T,k({...s,gridMask:H}))},children:[N&&p&&e.jsxs("div",{className:`floor-object type-${p.type} ${(E==null?void 0:E.id)===p.id?"selected":""}`,onMouseDown:f=>Ke(f,"object",p.id,p.spanX||1,p.spanY||1),onClick:()=>{D(null),z(null),D(null),z(p.id),D(null)},style:{width:`${_e(p.spanX)}px`,height:`${_e(p.spanY)}px`,transform:`rotate(${ve(p.rotationDeg??p.rotation??0)}deg)`},children:[e.jsx("img",{className:`fe-asset fe-asset--${(p.assetFile||"").replace(/[^a-z0-9]+/gi,"_").toLowerCase()}`,style:{transform:`scale(${Be(p.scale,tt(p.type))})`},src:p.assetFile?`${K}${p.assetFile}`:me(p.type,p.spanX,p.spanY,p.label),alt:""}),p.label&&e.jsx("div",{className:"obj-label",children:p.label})]}),y&&e.jsxs("div",{className:`table ${l.shape} ${(A==null?void 0:A.id)===l.id?"selected":""} ${!ge&&Y&&String(l.sectionId||"")&&String(l.sectionId||"")!==String(Y.id)?"dimmed":""}`,onMouseDown:f=>Ke(f,"table",l.id,l.spanX||1,l.spanY||1),onClick:()=>{z(null),D(null),D(l.id),z(null),D(null)},style:{width:`${_e(l.spanX)}px`,height:`${_e(l.spanY)}px`},children:[e.jsx("div",{className:"fe-table-visual","data-asset":l.assetFile||"",children:e.jsx("img",{className:`fe-asset fe-asset--${(l.assetFile||"").replace(/[^a-z0-9]+/gi,"_").toLowerCase()}`,style:{transform:`rotate(${ve(l.rotationDeg??0)}deg) scale(${Be(l.scale,et(l.shape,l.seats,l.assetFile))})`},src:l.assetFile?`${K}${l.assetFile}`:ce(l.shape,l.seats),alt:""})}),e.jsxs("div",{className:"fe-table-overlay",children:[e.jsx("div",{className:"table-label",children:l.name}),e.jsxs("div",{className:"table-seats",children:[l.seats," ",c("floor.properties.seats_unit","seats")]}),l.sectionId&&W.length>0&&e.jsx("div",{className:"table-section",children:((C=W.find(f=>String(f.id)===String(l.sectionId)))==null?void 0:C.name)||c("floor.properties.section","Section")})]})]})]},r)})]})})()]})]}),de&&e.jsx("div",{className:"modal-overlay",onClick:()=>J(!1),children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{children:c("floor.modal.create_title","Create New Layout")}),e.jsx("input",{type:"text",placeholder:c("floor.modal.placeholder_name","Layout name (e.g., Main Floor, Patio)"),value:fe,onChange:t=>he(t.target.value),onKeyDown:t=>t.key==="Enter"&&De(),autoFocus:!0}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:De,className:"btn-primary",children:c("floor.btn_create","Create")}),e.jsx("button",{onClick:()=>J(!1),className:"btn-secondary",children:c("common.btn_cancel","Cancel")})]})]})})]}):e.jsxs("div",{className:"floor-editor-empty",children:[e.jsx("h2",{children:c("floor.empty_state","No floor layouts found. Please create a floor layout first.")}),e.jsx("p",{children:c("floor.empty_hint","Create your first floor layout to get started.")}),e.jsxs("button",{className:"btn-primary",onClick:()=>J(!0),children:["âž• ",c("floor.btn_create_new","Create New Layout")]}),de&&e.jsx("div",{className:"modal-overlay",onClick:()=>J(!1),children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{children:c("floor.modal.create_title","Create New Layout")}),e.jsx("input",{type:"text",placeholder:c("floor.modal.placeholder_name","Layout name (e.g., Main Floor, Patio)"),value:fe,onChange:t=>he(t.target.value),onKeyDown:t=>t.key==="Enter"&&De(),autoFocus:!0}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:De,className:"btn-primary",children:c("common.btn_add","Create")}),e.jsx("button",{onClick:()=>J(!1),className:"btn-secondary",children:c("common.btn_cancel","Cancel")})]})]})})]})}const Qe=m.createContext(null);function Nt(){const h=m.useContext(Qe);if(!h)throw new Error("useToast must be used within <ToastProvider>");return h}let Ct=0;function St({children:h}){const[w,j]=m.useState([]),[s,k]=m.useState(null),W=m.useCallback((_,D="info")=>{const U=++Ct;j(z=>[...z,{id:U,message:_,type:D}]),setTimeout(()=>j(z=>z.filter(A=>A.id!==U)),4e3)},[]),I=m.useCallback(_=>new Promise(D=>{k({message:_,resolve:D})}),[]),Y=_=>{s==null||s.resolve(_),k(null)};m.useEffect(()=>{if(!s)return;const _=D=>{D.key==="Escape"&&Y(!1)};return document.addEventListener("keydown",_),()=>document.removeEventListener("keydown",_)},[s]);const O={success:"#00b894",error:"#d63031",warning:"#fdcb6e",info:"#6c5ce7"};return e.jsxs(Qe.Provider,{value:{toast:W,confirmDialog:I},children:[h,e.jsx("div",{style:{position:"fixed",top:"1rem",left:"50%",transform:"translateX(-50%)",zIndex:99999,display:"flex",flexDirection:"column",gap:"0.5rem",pointerEvents:"none"},children:w.map(_=>e.jsx("div",{role:"alert","aria-live":"assertive",style:{padding:"0.75rem 1.5rem",background:"#1a1d2e",color:"#e6e8ef",borderRadius:"8px",borderLeft:`4px solid ${O[_.type]}`,boxShadow:"0 4px 12px rgba(0,0,0,0.4)",fontSize:"0.9rem",pointerEvents:"auto",animation:"toast-in 0.3s ease"},children:_.message},_.id))}),s&&e.jsx("div",{role:"dialog","aria-modal":"true","aria-label":"Confirmation",style:{position:"fixed",inset:0,zIndex:99998,background:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{style:{background:"#1a1d2e",color:"#e6e8ef",padding:"1.5rem 2rem",borderRadius:"12px",maxWidth:"400px",width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.5)"},children:[e.jsx("p",{style:{marginBottom:"1.5rem",lineHeight:1.5},children:s.message}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>Y(!1),style:{padding:"0.5rem 1.25rem",background:"#2d3148",color:"#e6e8ef",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Cancel"}),e.jsx("button",{onClick:()=>Y(!0),autoFocus:!0,style:{padding:"0.5rem 1.25rem",background:"#d63031",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Confirm"})]})]})}),e.jsx("style",{children:`
        @keyframes toast-in {
          from { opacity: 0; transform: translateY(-10px); }
          to   { opacity: 1; transform: translateY(0); }
        }
      `})]})}const Se={waiter:"#FF6B6B",chef:"#4ECDC4",manager:"#FFE66D",busser:"#95E1D3",host:"#C7B3E5",bartender:"#F38181"},kt={scheduled:"#E8F5E9",checked_in:"#C8E6C9",checked_out:"#BDBDBD",called_out:"#FFE0B2",cancelled:"#FFCDD2"},_t=h=>{const w=new Date(h),j=w.getDay(),s=w.getDate()-j+(j===0?-6:1);return new Date(w.setDate(s))},Re=h=>{const w=_t(h),j=[];for(let s=0;s<7;s++){const k=new Date(w);k.setDate(k.getDate()+s),j.push(k)}return j},ue=h=>h.toISOString().split("T")[0],Ve=h=>h.toLocaleDateString("en-US",{month:"short",day:"numeric"}),He=h=>h.toLocaleDateString("en-US",{month:"long",year:"numeric"});function Dt({restaurantId:h}){const{toast:w}=Nt(),[j,s]=m.useState([]),[k,W]=m.useState([]),[I,Y]=m.useState(new Date().toISOString().split("T")[0]),[O,_]=m.useState("day"),[D,U]=m.useState(!1),[z,A]=m.useState(!1),[E,g]=m.useState(!1),[Q,V]=m.useState({firstName:"",lastName:"",email:"",role:"waiter",userId:""}),[ee,de]=m.useState({staffId:"",startTime:"09:00",endTime:"17:00"});m.useEffect(()=>{J()},[I,O,h]);const J=async()=>{U(!0);try{const x=await fetch(`/api/restaurants/${h}/staff`);x.ok&&s(await x.json());let M=I,X=I;if(O==="week"){const L=Re(new Date(I));M=ue(L[0]),X=ue(L[6])}else if(O==="month"){const L=new Date(I);M=ue(new Date(L.getFullYear(),L.getMonth(),1)),X=ue(new Date(L.getFullYear(),L.getMonth()+1,0))}const $=await fetch(`/api/restaurants/${h}/shifts?startDate=${M}&endDate=${X}`);$.ok&&W(await $.json())}catch(x){console.error("Failed to load data:",x)}finally{U(!1)}},fe=async()=>{if(!Q.firstName||!Q.lastName||!Q.email){w("Please fill in required fields","warning");return}try{(await fetch(`/api/restaurants/${h}/staff`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)})).ok&&(V({firstName:"",lastName:"",email:"",role:"waiter",userId:""}),A(!1),J())}catch(x){console.error("Failed to add staff:",x)}},he=async()=>{if(!ee.staffId){w("Please select a staff member","warning");return}try{(await fetch(`/api/restaurants/${h}/shifts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staffId:ee.staffId,date:I,startTime:ee.startTime,endTime:ee.endTime})})).ok&&(de({staffId:"",startTime:"09:00",endTime:"17:00"}),g(!1),J())}catch(x){console.error("Failed to add shift:",x)}},ge=async x=>{try{await fetch(`/api/restaurants/${h}/shifts/${x}/check-in`,{method:"POST"}),J()}catch(M){console.error("Failed to check in:",M)}},xe=async x=>{try{await fetch(`/api/restaurants/${h}/shifts/${x}/check-out`,{method:"POST"}),J()}catch(M){console.error("Failed to check out:",M)}},ne=async x=>{try{await fetch(`/api/restaurants/${h}/shifts/${x}`,{method:"DELETE"}),J()}catch(M){console.error("Failed to cancel shift:",M)}},re=x=>{const M=new Date(I);O==="week"?M.setDate(M.getDate()+x*7):O==="month"?M.setMonth(M.getMonth()+x):M.setDate(M.getDate()+x),Y(ue(M))},v=()=>{const x=new Date(I),M=k.filter(d=>d.date===I),X=new Map;M.forEach(d=>{X.has(d.staffId)||X.set(d.staffId,[]),X.get(d.staffId).push(d)});const $=d=>{const[u,R]=d.split(":").map(Number);return u*60+R},L=9*60,n=23*60-L;return e.jsxs("div",{className:"shift-board day-view",children:[e.jsx("div",{className:"day-view-header",children:e.jsx("h2",{children:x.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})})}),e.jsxs("div",{className:"day-timeline",children:[e.jsx("div",{className:"time-slots",children:Array.from({length:15},(d,u)=>e.jsxs("div",{className:"time-slot",children:[9+u,":00"]},u))}),e.jsx("div",{className:"staff-rows",children:j.map(d=>e.jsxs("div",{className:"staff-row",children:[e.jsxs("div",{className:"staff-name",style:{borderLeftColor:Se[d.role]||"#999"},children:[e.jsxs("span",{children:[d.firstName," ",d.lastName]}),e.jsx("small",{children:d.role})]}),e.jsx("div",{className:"timeline-row",children:(X.get(d.id)||[]).map(u=>{const R=$(u.startTime),P=$(u.endTime),te=(R-L)/n*100,se=(P-R)/n*100;return e.jsxs("div",{className:"shift-bar",style:{left:`${te}%`,width:`${se}%`,backgroundColor:Se[u.staffRole]||"#999",opacity:kt[u.status]?1:.6},title:`${u.startTime}-${u.endTime} (${u.status})`,children:[e.jsxs("span",{className:"shift-time",children:[u.startTime,"-",u.endTime]}),e.jsxs("div",{className:"shift-actions",children:[u.status==="scheduled"&&e.jsx("button",{onClick:()=>ge(u.id),className:"btn-checkin",children:"Check In"}),u.status==="checked_in"&&e.jsx("button",{onClick:()=>xe(u.id),className:"btn-checkout",children:"Check Out"}),e.jsx("button",{onClick:()=>ne(u.id),className:"btn-cancel",children:"Cancel"})]})]},u.id)})})]},d.id))})]})]})},ie=()=>{const x=Re(new Date(I)),M=k.filter($=>{const L=new Date($.date);return L>=x[0]&&L<=x[6]}),X=new Map;return j.forEach($=>{X.set($.id,new Map),x.forEach(L=>{const oe=ue(L);X.get($.id).set(oe,[])})}),M.forEach($=>{const L=X.get($.staffId);if(L){const oe=L.get($.date)||[];oe.push($),L.set($.date,oe)}}),e.jsxs("div",{className:"shift-board week-view",children:[e.jsx("div",{className:"week-header",children:e.jsxs("h2",{children:[ue(x[0])," to ",ue(x[6])]})}),e.jsxs("div",{className:"week-table",children:[e.jsxs("div",{className:"week-row header-row",children:[e.jsx("div",{className:"staff-cell",children:"Staff"}),x.map($=>e.jsxs("div",{className:"day-cell",children:[e.jsx("div",{children:$.toLocaleDateString("en-US",{weekday:"short"})}),e.jsx("div",{className:"date-num",children:Ve($)})]},ue($)))]}),j.map($=>e.jsxs("div",{className:"week-row",children:[e.jsx("div",{className:"staff-cell",children:e.jsxs("div",{className:"staff-info",style:{borderLeftColor:Se[$.role]||"#999"},children:[e.jsxs("span",{className:"staff-name",children:[$.firstName," ",$.lastName]}),e.jsx("span",{className:"staff-role",children:$.role})]})}),x.map(L=>{var d;const oe=ue(L),n=((d=X.get($.id))==null?void 0:d.get(oe))||[];return e.jsx("div",{className:"day-cell",children:n.map(u=>e.jsx("div",{className:"week-shift",style:{backgroundColor:Se[u.staffRole]||"#999"},title:`${u.startTime}-${u.endTime}`,children:e.jsxs("small",{children:[u.startTime,"-",u.endTime]})},u.id))},oe)})]},$.id))]})]})},le=()=>{const x=new Date(I),M=x.getFullYear(),X=x.getMonth(),$=new Date(M,X,1),L=new Date(M,X+1,0),oe=new Date(M,X,0).getDate(),n=[];for(let u=$.getDay()-1;u>=0;u--)n.push(new Date(M,X-1,oe-u));for(let u=1;u<=L.getDate();u++)n.push(new Date(M,X,u));const d=42-n.length;for(let u=1;u<=d;u++)n.push(new Date(M,X+1,u));return e.jsxs("div",{className:"shift-board month-view",children:[e.jsx("div",{className:"month-header",children:e.jsx("h2",{children:He(x)})}),e.jsxs("div",{className:"month-calendar",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(u=>e.jsx("div",{className:"day-header",children:u},u)),n.map((u,R)=>{const P=u?ue(u):"",te=u?k.filter(G=>G.date===P):[],se=u&&u.getMonth()===X;return e.jsxs("div",{className:`month-day ${se?"current":"other"}`,children:[e.jsx("div",{className:"day-number",children:u==null?void 0:u.getDate()}),e.jsx("div",{className:"shift-count",children:te.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"count-badge",children:[te.length," shifts"]}),e.jsx("div",{className:"shift-dots",children:j.map(G=>te.some(Ne=>Ne.staffId===G.id)?e.jsx("span",{className:"dot",style:{backgroundColor:Se[G.role]||"#999"},title:G.firstName},G.id):null)})]})})]},R)})]})]})},ae=new Date(I),q=O==="week"?`Week of ${Ve(Re(ae)[0])}`:O==="month"?He(ae):ae.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"shift-board-container",children:[e.jsxs("div",{className:"board-header",children:[e.jsxs("div",{className:"view-controls",children:[e.jsx("button",{className:`view-btn ${O==="day"?"active":""}`,onClick:()=>_("day"),children:"Day"}),e.jsx("button",{className:`view-btn ${O==="week"?"active":""}`,onClick:()=>_("week"),children:"Week"}),e.jsx("button",{className:`view-btn ${O==="month"?"active":""}`,onClick:()=>_("month"),children:"Month"})]}),e.jsxs("div",{className:"date-controls",children:[e.jsx("button",{onClick:()=>re(-1),children:"â† Prev"}),e.jsx("div",{className:"current-date",children:q}),e.jsx("button",{onClick:()=>re(1),children:"Next â†’"}),e.jsx("input",{type:"date",value:I,onChange:x=>Y(x.target.value)})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-primary",onClick:()=>A(!z),children:"+ Add Staff"}),e.jsx("button",{className:"btn-primary",onClick:()=>g(!E),children:"+ Add Shift"})]})]}),z&&e.jsxs("div",{className:"form-panel",children:[e.jsx("h3",{children:"Add Staff Member"}),e.jsx("input",{type:"text",placeholder:"First Name",value:Q.firstName,onChange:x=>V({...Q,firstName:x.target.value})}),e.jsx("input",{type:"text",placeholder:"Last Name",value:Q.lastName,onChange:x=>V({...Q,lastName:x.target.value})}),e.jsx("input",{type:"email",placeholder:"Email",value:Q.email,onChange:x=>V({...Q,email:x.target.value})}),e.jsxs("select",{value:Q.role,onChange:x=>V({...Q,role:x.target.value}),children:[e.jsx("option",{value:"waiter",children:"Waiter"}),e.jsx("option",{value:"chef",children:"Chef"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"busser",children:"Busser"}),e.jsx("option",{value:"host",children:"Host"}),e.jsx("option",{value:"bartender",children:"Bartender"})]}),e.jsx("button",{onClick:fe,className:"btn-primary",children:"Save Staff"}),e.jsx("button",{onClick:()=>A(!1),className:"btn-secondary",children:"Cancel"})]}),E&&e.jsxs("div",{className:"form-panel",children:[e.jsx("h3",{children:"Create Shift"}),e.jsxs("select",{value:ee.staffId,onChange:x=>de({...ee,staffId:x.target.value}),children:[e.jsx("option",{value:"",children:"Select Staff Member"}),j.map(x=>e.jsxs("option",{value:x.id,children:[x.firstName," ",x.lastName]},x.id))]}),e.jsx("input",{type:"time",value:ee.startTime,onChange:x=>de({...ee,startTime:x.target.value})}),e.jsx("input",{type:"time",value:ee.endTime,onChange:x=>de({...ee,endTime:x.target.value})}),e.jsx("button",{onClick:he,className:"btn-primary",children:"Create Shift"}),e.jsx("button",{onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]}),D?e.jsx("p",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[O==="day"&&e.jsx(v,{}),O==="week"&&e.jsx(ie,{}),O==="month"&&e.jsx(le,{})]})]})}const Mt={empty:"Empty",occupied:"Occupied",reserved:"Reserved",dirty:"Dirty"};function $t({table:h,restaurantId:w,isOpen:j,onClose:s,onStatusChange:k}){const[W,I]=m.useState(!1);if(!j)return null;const Y=async O=>{I(!0);try{const _=await fetch(`/api/tables/${w}/${h.tableId}/status`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:O})});if(_.ok)k(h.tableId,O),s();else{const D=await _.text();console.error("Status update failed:",_.status,_.statusText,D);let U=`Status ${_.status}`;try{U=JSON.parse(D).error||U}catch{U=_.statusText||U}alert(`âŒ Failed to update table status: ${U}`)}}catch(_){console.error("Failed to update table status:",_),alert(`âŒ Error updating table status: ${_ instanceof Error?_.message:String(_)}`)}finally{I(!1)}};return e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsxs("div",{className:"modal-content",onClick:O=>O.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Table ",h.tableNumber]}),e.jsx("button",{className:"modal-close",onClick:s,children:"âœ•"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"table-info-section",children:[e.jsx("h3",{children:"Current Status"}),e.jsx("div",{className:"status-badge",style:{color:Tt(h.status)},children:Mt[h.status]})]}),h.status==="occupied"&&e.jsxs("div",{className:"order-info-section",children:[e.jsx("h3",{children:"Order Details"}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Guests:"}),e.jsx("span",{className:"value",children:h.guestCount||"â€”"})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Items Pending:"}),e.jsx("span",{className:"value",children:h.itemsPending||0})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Items Ready:"}),e.jsx("span",{className:"value",children:h.itemsReady||0})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Total:"}),e.jsxs("span",{className:"value",children:["â‚ª",(h.orderTotal||0).toFixed(0)]})]})]}),e.jsxs("div",{className:"actions-section",children:[e.jsx("h3",{children:"Actions"}),e.jsxs("div",{className:"actions",children:[h.status!=="dirty"&&e.jsx("button",{className:"action-btn btn-mark-dirty",onClick:()=>Y("dirty"),disabled:W,children:"ðŸ§¹ Mark Dirty"}),h.status!=="reserved"&&e.jsx("button",{className:"action-btn btn-reserve",onClick:()=>Y("reserved"),disabled:W,children:"ðŸ“… Reserve"}),h.status!=="empty"&&e.jsx("button",{className:"action-btn btn-empty",onClick:()=>Y("empty"),disabled:W,children:"âœ” Clear Table"}),h.status==="occupied"&&e.jsx("button",{className:"action-btn btn-view-order",onClick:()=>{window.location.href=`/waiter/${w}/${h.tableNumber}`},disabled:W,children:"ðŸ“‹ View Order"})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn-close",onClick:s,children:"Close"})})]})})}function Tt(h){switch(h){case"empty":return"#4CAF50";case"occupied":return"#FF6B6B";case"reserved":return"#FFC107";case"dirty":return"#9C27B0";default:return"#333"}}const $e={empty:"#4CAF50",occupied:"#FF6B6B",reserved:"#FFC107",dirty:"#9C27B0"},Ft={empty:c("floor.status.empty","Empty"),occupied:c("floor.status.occupied","Occupied"),reserved:c("floor.status.reserved","Reserved"),dirty:c("floor.status.dirty","Dirty")},Je="/floor_assets/",Ge=(h,w=1)=>{const j=Number(h);return Number.isFinite(j)?Math.max(.5,Math.min(1.6,j)):w},Ze=h=>{const w=Number(h);return Number.isFinite(w)?Math.round(w/45)*45:0};function Yt({restaurantId:h}){const[w,j]=m.useState([]),[s,k]=m.useState(null),[W,I]=m.useState(new Map),[Y,O]=m.useState(!0),[_,D]=m.useState(!0),[U,z]=m.useState(5e3),[A,E]=m.useState(null),[g,Q]=m.useState(!1),[V,ee]=m.useState(1),[de,J]=m.useState({x:0,y:0}),[fe,he]=m.useState(!1),[ge,xe]=m.useState(!1),ne=m.useRef(null),re=72;m.useEffect(()=>{const n=u=>{u.code==="Space"&&xe(!0)},d=u=>{u.code==="Space"&&(xe(!1),he(!1))};return window.addEventListener("keydown",n),window.addEventListener("keyup",d),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",d)}},[]),m.useEffect(()=>{(async()=>{try{const d=await fetch(`/api/floor-layouts/${h}`);if(d.ok){const u=await d.json();j(u);const R=u.find(P=>P.isActive)||u[0];R&&await v(R.id)}}catch(d){console.error("Failed to load layouts:",d)}finally{O(!1)}})()},[h]);const v=async n=>{try{const d=await fetch(`/api/floor-layouts/${h}/${n}`);if(d.ok){const u=await d.json();if(k(u),u.tableStatuses){const R=new Map;u.tableStatuses.forEach(P=>R.set(P.tableId,P)),I(R)}requestAnimationFrame(()=>le(u))}}catch(d){console.error("Failed to load layout:",d)}};m.useEffect(()=>{if(!_||!s)return;const n=setInterval(async()=>{try{const d=await fetch(`/api/floor-layouts/${h}/${s.id}`);if(d.ok){const u=await d.json();if(u.tableStatuses){const R=new Map;u.tableStatuses.forEach(P=>R.set(P.tableId,P)),I(R)}}}catch(d){console.error("Failed to refresh table statuses:",d)}},U);return()=>clearInterval(n)},[h,_,U,s]);const ie=n=>Math.max(.4,Math.min(2.5,n)),le=n=>{const d=n??s;if(!ne.current||!d)return;const u=ne.current.getBoundingClientRect(),R=d.gridCols*re,P=d.gridRows*re,te=24,se=ie(Math.min((u.width-te*2)/R,(u.height-te*2)/P,1.2));ee(se);const G=Math.round((u.width-R*se)/2),ke=Math.round((u.height-P*se)/2);J({x:G,y:ke})},ae=(n,d,u)=>{if(!ne.current)return;const R=ne.current.getBoundingClientRect(),P=d-R.left,te=u-R.top;J(se=>{const G=n/V;return{x:Math.round(P-(P-se.x)*G),y:Math.round(te-(te-se.y)*G)}}),ee(n)},q=n=>{if(!(n.ctrlKey||n.metaKey))return;n.preventDefault();const d=ie(V*(n.deltaY>0?.9:1.1));ae(d,n.clientX,n.clientY)},x=n=>{const d=n.button===1,u=ge&&n.button===0;if(!d&&!u)return;n.preventDefault(),he(!0);const R={x:n.clientX,y:n.clientY},P={...de},te=G=>{J({x:P.x+(G.clientX-R.x),y:P.y+(G.clientY-R.y)})},se=()=>{he(!1),window.removeEventListener("mousemove",te),window.removeEventListener("mouseup",se)};window.addEventListener("mousemove",te),window.addEventListener("mouseup",se)},M=n=>W.get(n)||{tableId:n,tableNumber:0,status:"empty"},X=n=>{E(n),Q(!0)},$=(n,d)=>{const u={...M(n),status:d};I(R=>new Map(R).set(n,u))},L=n=>{if(!n)return"";const d=Math.floor((Date.now()-n)/1e3/60);return d<1?"Just now":d<60?`${d}m`:`${Math.floor(d/60)}h ${d%60}m`},oe=n=>n==null?"":`â‚ª${n.toFixed(0)}`;return Y?e.jsx("div",{className:"live-view-loading",children:c("floor.loading","Loading floor layouts...")}):s?e.jsxs("div",{className:"restaurant-live-view",children:[e.jsxs("div",{className:"live-view-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"ðŸ”´ Live Floor View"}),w.length>1&&e.jsx("div",{className:"layout-selector",children:e.jsx("select",{value:s.id,onChange:n=>v(n.target.value),children:w.map(n=>e.jsxs("option",{value:n.id,children:[n.name," ",n.isActive?"(Active)":""]},n.id))})})]}),e.jsxs("div",{className:"control-panel",children:[e.jsxs("label",{className:"auto-refresh-label",children:[e.jsx("input",{type:"checkbox",checked:_,onChange:n=>D(n.target.checked)}),c("live.auto_refresh","Auto-refresh")]}),e.jsxs("select",{value:U,onChange:n=>z(Number(n.target.value)),disabled:!_,className:"refresh-interval-select",children:[e.jsx("option",{value:3e3,children:"3s"}),e.jsx("option",{value:5e3,children:"5s"}),e.jsx("option",{value:1e4,children:"10s"}),e.jsx("option",{value:15e3,children:"15s"})]}),e.jsxs("button",{className:"refresh-btn",onClick:()=>s&&v(s.id),children:["ðŸ”„ ",c("common.btn_refresh","Refresh")]})]})]}),e.jsxs("div",{className:`live-view-container ${fe?"is-panning":""}`,ref:ne,onWheel:q,onMouseDown:x,children:[e.jsxs("div",{className:"fe-canvas-controls live",children:[e.jsx("button",{className:"btn-icon-small",onClick:()=>{var n,d;return ae(ie(V*1.1),(((n=ne.current)==null?void 0:n.getBoundingClientRect().left)||0)+40,(((d=ne.current)==null?void 0:d.getBoundingClientRect().top)||0)+40)},title:"Zoom in",children:"ï¼‹"}),e.jsx("button",{className:"btn-icon-small",onClick:()=>{var n,d;return ae(ie(V*.9),(((n=ne.current)==null?void 0:n.getBoundingClientRect().left)||0)+40,(((d=ne.current)==null?void 0:d.getBoundingClientRect().top)||0)+40)},title:"Zoom out",children:"ï¼"}),e.jsx("button",{className:"btn-icon-small",onClick:()=>le(),title:"Fit to screen",children:"â¤¢"}),e.jsxs("div",{className:"fe-zoom-readout",children:[Math.round(V*100),"%"]}),e.jsx("div",{className:"fe-hint",children:ge?"Pan: drag":"Tip: hold Space to pan, Ctrl+wheel to zoom"})]}),e.jsxs("div",{className:"floor-grid",style:{gridTemplateColumns:`repeat(${s.gridCols}, ${re}px)`,gridTemplateRows:`repeat(${s.gridRows}, ${re}px)`,transform:`translate(${de.x}px, ${de.y}px) scale(${V})`,transformOrigin:"0 0"},"data-floor-theme":String(s.floorColor||""),children:[(s.objects??[]).map(n=>e.jsxs("div",{className:`floor-object-live type-${n.type}`,style:{gridColumn:`${n.gridX+1} / span ${n.spanX}`,gridRow:`${n.gridY+1} / span ${n.spanY}`,transform:`rotate(${Ze(n.rotationDeg??n.rotation??0)}deg)`},title:n.label||n.type,children:[n.assetFile?e.jsx("img",{className:"live-asset",src:`${Je}${n.assetFile}`,alt:"",style:{transform:`scale(${Ge(n.scale,1)})`,width:"100%",height:"100%",objectFit:"contain",display:"block"}}):e.jsx("span",{className:"obj-icon",children:n.type==="wall"?"ðŸ§±":n.type==="door"?"ðŸšª":n.type==="bar"?"ðŸ¸":n.type==="plant"?"ðŸª´":"âž–"}),n.label?e.jsx("span",{className:"obj-label",children:n.label}):null]},n.id)),s.tables.map(n=>{const d=M(n.id),u=L(d.occupiedSince);return e.jsxs("div",{className:`table-card table-${n.shape} status-${d.status}`,style:{gridColumn:`${n.gridX+1} / span ${n.spanX}`,gridRow:`${n.gridY+1} / span ${n.spanY}`,borderColor:$e[d.status]},onClick:()=>X(d),children:[e.jsx("div",{className:"table-number",children:n.tableNumber||d.tableNumber}),n.assetFile?e.jsx("img",{className:"live-asset",src:`${Je}${n.assetFile}`,alt:"",style:{width:"100%",height:"100%",objectFit:"contain",display:"block",transform:`rotate(${Ze(n.rotationDeg??0)}deg) scale(${Ge(n.scale,1)})`}}):null,d.status==="occupied"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"table-info",children:[e.jsxs("span",{className:"guests",children:["ðŸ‘¥ ",d.guestCount||"-"]}),e.jsx("span",{className:"seated",children:u})]}),e.jsxs("div",{className:"order-summary",children:[d.itemsPending?e.jsxs("span",{className:"pending",children:["â³ ",d.itemsPending]}):null,d.itemsReady?e.jsxs("span",{className:"ready",children:["âœ… ",d.itemsReady]}):null,d.orderTotal?e.jsx("span",{className:"total",children:oe(d.orderTotal)}):null]})]}),d.status==="reserved"&&e.jsx("div",{className:"table-info",children:e.jsx("span",{children:c("floor.status.reserved","Reserved")})}),d.status==="dirty"&&e.jsx("div",{className:"table-info",children:e.jsxs("span",{children:["ðŸ§¹ ",c("floor.status_text.dirty","Needs cleaning")]})}),d.status==="empty"&&e.jsx("div",{className:"table-info",children:e.jsx("span",{children:c("floor.status_text.available","Available")})})]},n.id)})]})]}),e.jsxs("div",{className:"live-view-footer",children:[e.jsxs("div",{className:"status-legend",children:[e.jsx("h3",{children:c("live.status_legend","Status Legend")}),e.jsx("div",{className:"legend-items",children:Object.entries($e).map(([n,d])=>e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-color",style:{backgroundColor:d,opacity:n==="empty"?.6:1}}),e.jsx("span",{children:Ft[n]})]},n))})]}),e.jsxs("div",{className:"stats-panel",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:c("live.stats.total_tables","Total Tables:")}),e.jsx("span",{className:"value",children:s.tables.length})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:c("live.stats.occupied","Occupied:")}),e.jsx("span",{className:"value",style:{color:$e.occupied},children:Array.from(W.values()).filter(n=>n.status==="occupied").length})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:c("live.stats.empty","Empty:")}),e.jsx("span",{className:"value",style:{color:$e.empty},children:Array.from(W.values()).filter(n=>n.status==="empty").length})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:c("live.stats.occupancy","Occupancy:")}),e.jsxs("span",{className:"value",children:[s.tables.length>0?Math.round(Array.from(W.values()).filter(n=>n.status==="occupied").length/s.tables.length*100):0,"%"]})]})]})]}),A&&e.jsx($t,{table:A,restaurantId:h,isOpen:g,onClose:()=>Q(!1),onStatusChange:$})]}):e.jsx("div",{className:"live-view-error",children:e.jsx("p",{children:c("floor.empty_state","No floor layouts found. Please create a floor layout first.")})})}function Et(){const[h,w]=m.useState("edit"),j=window.__APP_CONFIG__||{},s=new URLSearchParams(window.location.search),k=j.restaurantId||s.get("restaurantId")||"";return(j.page||s.get("page")||"floor")==="shifts"?e.jsx("div",{className:"app shifts-app",children:e.jsx(Dt,{restaurantId:k})}):e.jsxs("div",{className:"app",children:[e.jsxs("header",{className:"app-header",children:[e.jsx("h1",{children:"Floor Plan Manager"}),e.jsxs("nav",{className:"mode-switch","aria-label":"View mode",children:[e.jsx("button",{className:h==="edit"?"active":"",onClick:()=>w("edit"),"aria-pressed":h==="edit","aria-label":"Switch to edit layout mode",children:"Edit Layout"}),e.jsx("button",{className:h==="live"?"active":"",onClick:()=>w("live"),"aria-pressed":h==="live","aria-label":"Switch to live view mode",children:"Live View"})]})]}),e.jsx("main",{className:"app-main",children:h==="edit"?e.jsx(wt,{restaurantId:k}):e.jsx(Yt,{restaurantId:k})})]})}class Xt extends m.Component{constructor(j){super(j);Ue(this,"handleRetry",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(j){return{hasError:!0,error:j}}componentDidCatch(j,s){console.error("[ErrorBoundary] caught:",j,s.componentStack)}render(){var j;return this.state.hasError?this.props.fallback?this.props.fallback:e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#e6e8ef",background:"#1a1d2e",borderRadius:"12px",margin:"2rem"},children:[e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{style:{color:"#9aa3b2",marginBottom:"1rem"},children:((j=this.state.error)==null?void 0:j.message)||"An unexpected error occurred"}),e.jsx("button",{onClick:this.handleRetry,style:{padding:"0.5rem 1.5rem",background:"#6c5ce7",color:"#fff",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"0.95rem"},children:"Try Again"})]}):this.props.children}}function Lt(){var w;if((w=window.__APP_CONFIG__)!=null&&w.lang)return window.__APP_CONFIG__.lang;const h=document.cookie.match(/(?:^|; )lang=([^;]*)/);return h?h[1]:"en"}xt(Lt()).then(()=>{jt.createRoot(document.getElementById("root")).render(e.jsx(yt.StrictMode,{children:e.jsx(Xt,{children:e.jsx(St,{children:e.jsx(Et,{})})})}))});

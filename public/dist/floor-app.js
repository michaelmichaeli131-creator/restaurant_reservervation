import{r as v,j as e,c as gt,R as vt}from"./floor-index.js";let Qe="he",Ae={};async function bt(h="he"){Qe=h;try{const j=await fetch(`/api/i18n/${h}`);j.ok&&(Ae=await j.json())}catch(j){console.warn("Failed to load translations:",j),Ae=jt()}}function d(h,j){const E=h.split(".");let s=Ae;for(const C of E)if(s&&typeof s=="object")s=s[C];else return j||`(${h})`;return typeof s=="string"?s:j||`(${h})`}function xt(){return Qe}function jt(){return{common:{btn_save:"◊©◊û◊ï◊®",btn_cancel:"◊ë◊ô◊ò◊ï◊ú",btn_delete:"◊û◊ó◊ß"},floor:{loading:"◊ò◊ï◊¢◊ü ◊™◊õ◊†◊ô◊ï◊™ ◊®◊¶◊§◊î...",empty_state:"◊ú◊ê ◊†◊û◊¶◊ê◊ï ◊™◊õ◊†◊ô◊ï◊™ ◊®◊¶◊§◊î",btn_save_layout:"◊©◊û◊ï◊® ◊™◊õ◊†◊ô◊™",error:{enter_name:"◊ê◊†◊ê ◊î◊ñ◊ü ◊©◊ù ◊™◊õ◊†◊ô◊™",create:"◊©◊í◊ô◊ê◊î ◊ë◊ô◊¶◊ô◊®◊™ ◊™◊õ◊†◊ô◊™",delete:"◊û◊ó◊ô◊ß◊î ◊†◊õ◊©◊ú◊î"},status:{empty:"◊§◊†◊ï◊ô",occupied:"◊™◊§◊ï◊°",reserved:"◊©◊û◊ï◊®",dirty:"◊û◊ú◊ï◊õ◊ú◊ö"}}}}function yt({restaurantId:h}){const[j,E]=v.useState([]),[s,C]=v.useState(null),[T,ie]=v.useState([]),[_,se]=v.useState(null),[z,F]=v.useState(null),[V,q]=v.useState(null),O=v.useMemo(()=>!s||!z?null:s.tables.find(t=>t.id===z)??null,[s,z]),Y=v.useMemo(()=>!s||!V?null:(s.objects??[]).find(t=>t.id===V)??null,[s,V]),[m,ue]=v.useState(null),[P,ce]=v.useState(1),[ae,ne]=v.useState(!1),[fe,he]=v.useState(""),[ge,xe]=v.useState(!1),[H,Q]=v.useState(null),[g,oe]=v.useState(null),[ee,te]=v.useState(null),[p,D]=v.useState(60),R=xt(),k=v.useMemo(()=>({parquet_blue:{label:d("floor.themes.parquet_blue","Blue parquet"),bg:"url(/floor_assets/floor_parquet_blue.svg)",size:"240px 240px",repeat:"repeat",pos:"center"},parquet_brown:{label:d("floor.themes.parquet_brown","Brown parquet"),bg:"url(/floor_assets/floor_parquet_brown.svg)",size:"240px 240px",repeat:"repeat",pos:"center"},slate_dark:{label:d("floor.themes.slate_dark","Dark slate"),bg:"url(/floor_assets/floor_slate_dark.svg)",size:"240px 240px",repeat:"repeat",pos:"center"},navy_carpet:{label:d("floor.themes.navy_carpet","Deep navy"),bg:"url(/floor_assets/floor_navy_carpet.svg)",size:"240px 240px",repeat:"repeat",pos:"center"},teal_terrazzo:{label:d("floor.themes.teal_terrazzo","Muted teal"),bg:"url(/floor_assets/floor_teal_terrazzo.svg)",size:"240px 240px",repeat:"repeat",pos:"center"}}),[R]),L=t=>!t||t.startsWith("#")?"parquet_blue":t in k?t:"parquet_blue",[J,G]=v.useState("parquet_blue");v.useEffect(()=>{const t=pe.current;!t||!s||requestAnimationFrame(()=>{const a=s.gridCols*p+48,r=s.gridRows*p+48,l=Math.max(0,(a-t.clientWidth)/2),i=Math.max(0,(r-t.clientHeight)/2);t.scrollLeft=l,t.scrollTop=i})},[s==null?void 0:s.id,s==null?void 0:s.gridCols,s==null?void 0:s.gridRows,p]);const[n,o]=v.useState(!1);v.useEffect(()=>{s&&G(L(s.floorColor))},[s==null?void 0:s.id]);const[S,A]=v.useState(!1),[X,Z]=v.useState(1),[K,re]=v.useState({x:0,y:0}),[we,Me]=v.useState(!1),[Oe,Pe]=v.useState(!1),pe=v.useRef(null),Ie=v.useRef(null),ze=v.useRef(null),B="/floor_assets/",_e=t=>Math.max(1,Number(t)||1)*p,qe=(t,a)=>{const r=String(t||"square").toLowerCase(),l=Number(a||0);return r==="booth"?l>=6?{spanX:6,spanY:2}:{spanX:2,spanY:2}:r==="round"?l>=9?{spanX:3,spanY:3}:{spanX:2,spanY:2}:l<=2?{spanX:2,spanY:1}:l<=4?{spanX:2,spanY:2}:{spanX:2,spanY:2}},et=(t,a,r)=>{const l=String(r||"").toLowerCase();return l==="large_booth.svg"||l==="round_table_10.svg"?.88:l==="round_table4.svg"||l==="square_table2.svg"?1.06:1},Be=(t,a=1)=>{const r=Number(t);return Number.isFinite(r)?Math.max(.5,Math.min(1.6,r)):a},ve=t=>{const a=Number(t);return Number.isFinite(a)?(Math.round(a/45)*45%360+360)%360:0},tt=t=>String(t||"").toLowerCase()==="bar"?1.8:1,le=(t,a)=>{const r=String(t||"rect").toLowerCase(),l=Number(a||0);if(r==="round")return l>=9?`${B}round_table_10.svg`:`${B}round_table4.svg`;if(r==="booth")return l>=6?`${B}large_booth.svg`:`${B}booth4.svg`;const c=[2,4,6,8,10].reduce((b,u)=>Math.abs(u-l)<Math.abs(b-l)?u:b,4);return`${B}square_table${c}.svg`},me=(t,a,r,l)=>{const i=String(l||"").toLowerCase(),c={bar:"bar.svg",chair:"chair.svg",plant:"plant.svg",door:"door.svg",floor_brown:"floor_brown.svg",corner_partitaion:"corner_partitaion.svg",cyclic:"cyclic_partition.svg",cyclic_partition:"cyclic_partition.svg",horizintal_partitaion:"horizintal_partitaion.svg",vertical_partition:"vertical_partition.svg"};return c[i]?`${B}${c[i]}`:t==="door"?`${B}door.svg`:t==="bar"?`${B}bar.svg`:t==="plant"?`${B}plant.svg`:(a||1)===1&&(r||1)===1?`${B}corner_partitaion.svg`:(a||1)>(r||1)?`${B}horizintal_partitaion.svg`:`${B}vertical_partition.svg`},Te=t=>{const a=Number(t.gridRows||0),r=Number(t.gridCols||0),l=Math.max(0,a*r),i=Array.isArray(t.gridMask)?t.gridMask.slice(0,l):[];for(;i.length<l;)i.push(1);return{...t,gridMask:i,floorColor:t.floorColor||"parquet_blue"}},Se=(t,a,r,l)=>{if(!(s!=null&&s.gridMask))return!0;const i=s.gridCols;for(let c=a;c<a+l;c++)for(let b=t;b<t+r;b++){if(b<0||c<0||b>=i||c>=s.gridRows)return!1;const u=c*i+b;if(s.gridMask[u]!==1)return!1}return!0};v.useEffect(()=>{h&&(fetch(`/api/floor-layouts/${h}`).then(t=>t.ok?t.json():[]).then(t=>{E(t);const a=t.find(i=>i.isActive);C(a?Te(a):t[0]?Te(t[0]):null);const r=t.flatMap(i=>i.tables),l=Math.max(...r.map(i=>i.tableNumber),0);ce(l+1)}).catch(t=>console.error("Failed to load layouts:",t)),fetch(`/api/floor-sections/${h}`).then(t=>t.ok?t.json():[]).then(t=>{ie(t),t.length>0&&se(t[0])}).catch(t=>console.error("Failed to load sections:",t)))},[h]),v.useEffect(()=>{const t=r=>{r.code==="Space"&&Pe(!0)},a=r=>{r.code==="Space"&&(Pe(!1),Me(!1))};return window.addEventListener("keydown",t),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",a)}},[]);const ke=async()=>{if(!fe.trim()){alert(d("floor.error.enter_name","Please enter a layout name"));return}try{const t=await fetch(`/api/floor-layouts/${h}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:fe,gridRows:8,gridCols:12,gridMask:Array.from({length:96},()=>1),tables:[],objects:[],isActive:j.length===0})});if(t.ok){const a=await t.json();E([...j,a]),C(a),he(""),ne(!1);try{const r=await fetch(`/api/floor-layouts/${h}/${a.id}/activate`,{method:"POST",credentials:"include"});if(r.ok)E(l=>l.map(i=>({...i,isActive:i.id===a.id})));else{const l=await r.text().catch(()=>"");console.error("[FloorEditor] auto-activate after create failed",{status:r.status,statusText:r.statusText,body:l})}}catch(r){console.error("[FloorEditor] auto-activate after create threw",r)}}else{const a=await t.json().catch(()=>null),r=(a==null?void 0:a.error)||d("floor.error.server","Server error: {status} {statusText}").replace("{status}",String(t.status)).replace("{statusText}",t.statusText);alert(d("floor.error.create","Error creating layout: {error}").replace("{error}",r))}}catch(t){console.error("Create layout failed:",t),alert(d("floor.error.create","Error creating layout: {error}").replace("{error}",t instanceof Error?t.message:String(t)))}},st=async t=>{if(confirm(d("floor.confirm.delete_layout","Are you sure you want to delete this layout?")))try{const a=await fetch(`/api/floor-layouts/${h}/${t}`,{method:"DELETE",credentials:"include"});if(a.ok){const r=j.filter(l=>l.id!==t);E(r),(s==null?void 0:s.id)===t&&C(r[0]||null)}else{const r=await a.json();alert(r.error||d("floor.error.delete","Delete failed"))}}catch(a){console.error("Delete failed:",a),alert(d("floor.error.delete_general","Error deleting layout"))}},at=async t=>{const a=prompt(d("floor.prompt.duplicate_name","Enter name for duplicated layout:"));if(a)try{const r=await fetch(`/api/floor-layouts/${h}/${t}/duplicate`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:a})});if(r.ok){const l=await r.json();E([...j,l]),C(l)}else alert(d("floor.error.duplicate","Error duplicating layout"))}catch(r){console.error("Duplicate failed:",r),alert(d("floor.error.duplicate","Error duplicating layout"))}},nt=async t=>{try{(await fetch(`/api/floor-layouts/${h}/${t}/activate`,{method:"POST",credentials:"include"})).ok&&E(j.map(r=>({...r,isActive:r.id===t})))}catch(a){console.error("Set active failed:",a)}},Ke=(t,a,r)=>Math.max(a,Math.min(r,t)),Fe=(t,a,r,l)=>s?{x:Ke(t,0,Math.max(0,s.gridCols-r)),y:Ke(a,0,Math.max(0,s.gridRows-l))}:{x:t,y:a},ot=(t,a,r,l)=>{if(!s)return{x:t,y:a};const c=(s.objects??[]).filter(y=>y.type==="wall"||y.type==="divider");if(!c.length)return{x:t,y:a};const b={x:t,y:a},u=[],x=(y,N)=>{const f=Fe(y,N,r,l),$=Math.abs(f.x-b.x)+Math.abs(f.y-b.y);u.push({...f,score:$})};return c.forEach(y=>{const N=y.gridX,f=y.gridY,$=y.gridX+(y.spanX||1),I=y.gridY+(y.spanY||1);t+r>N&&t<$&&(x(t,f-l),x(t,I)),a+l>f&&a<I&&(x(N-r,a),x($,a))}),u.length?(u.sort((y,N)=>y.score-N.score),u[0].score<=1?{x:u[0].x,y:u[0].y}:{x:t,y:a}):{x:t,y:a}},De=t=>Math.max(.35,Math.min(2.5,t)),rt=()=>{if(!pe.current||!s)return;const t=pe.current.getBoundingClientRect(),a=p,r=s.gridCols*a+20,l=s.gridRows*a+20,i=De(Math.min((t.width-40)/r,(t.height-40)/l,1.2));Z(i);const c=Math.round((t.width-r*i)/2),b=Math.round(20);re({x:c,y:b})},Ye=(t,a,r)=>{if(!pe.current)return;const l=pe.current.getBoundingClientRect(),i=a-l.left,c=r-l.top;re(b=>{const x=t/X,y=Math.round(i-(i-b.x)*x),N=Math.round(c-(c-b.y)*x);return{x:y,y:N}}),Z(t)},lt=t=>{if(!(t.ctrlKey||t.metaKey))return;t.preventDefault();const a=t.deltaY,r=De(X*(a>0?.9:1.1));Ye(r,t.clientX,t.clientY)},it=t=>{const a=t.button===1,r=Oe&&t.button===0;if(!a&&!r)return;t.preventDefault(),Me(!0);const l={x:t.clientX,y:t.clientY},i={...K},c=u=>{const x=u.clientX-l.x,y=u.clientY-l.y;re({x:i.x+x,y:i.y+y})},b=()=>{Me(!1),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",b)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",b)},ct=(t,a,r,l,i)=>{if(!s)return{x:t,y:a,guides:{v:[],h:[]}};const c=[];for(const w of s.tables)(i==null?void 0:i.kind)==="table"&&(i!=null&&i.id)&&w.id===i.id||c.push({left:w.gridX,top:w.gridY,right:w.gridX+(w.spanX||1),bottom:w.gridY+(w.spanY||1),cx2:w.gridX*2+(w.spanX||1),cy2:w.gridY*2+(w.spanY||1)});for(const w of s.objects??[])(i==null?void 0:i.kind)==="object"&&(i!=null&&i.id)&&w.id===i.id||c.push({left:w.gridX,top:w.gridY,right:w.gridX+(w.spanX||1),bottom:w.gridY+(w.spanY||1),cx2:w.gridX*2+(w.spanX||1),cy2:w.gridY*2+(w.spanY||1)});const b=t,u=a,x=t+r,y=a+l,N=t*2+r,f=a*2+l,$=1;let I=null,M=null;const W={v:[],h:[]},Le=(w,Ne)=>{Math.abs(w)>$||(I===null||Math.abs(w)<Math.abs(I))&&(I=w,W.v=[Ne])},Ee=(w,Ne)=>{Math.abs(w)>$||(M===null||Math.abs(w)<Math.abs(M))&&(M=w,W.h=[Ne])};for(const w of c){Le(w.left-b,w.left),Le(w.right-x,w.right);const Ne=w.cx2-N;Ne%2===0&&Le(Ne/2,w.cx2/2),Ee(w.top-u,w.top),Ee(w.bottom-y,w.bottom);const Ue=w.cy2-f;Ue%2===0&&Ee(Ue/2,w.cy2/2)}return{x:I!==null?t+I:t,y:M!==null?a+M:a,guides:W}},dt=(t,a,r,l,i,c,b,u)=>{const x=Fe(t,a,r,l);if(b)return{x:x.x,y:x.y,guides:{v:[],h:[]}};const N=i==="table"&&String(c).toLowerCase()==="booth"||i==="object"&&(c==="bar"||c==="door")?ot(x.x,x.y,r,l):x,f=ct(N.x,N.y,r,l,u),$=Fe(f.x,f.y,r,l);return{x:$.x,y:$.y,guides:f.guides}},je=(t,a,r,l,i,c,b,u)=>dt(t,a,r,l,i,c,b,u),Xe=(t,a)=>{if(!s)return null;const r=Ie.current;if(!r)return null;const l=r.getBoundingClientRect(),i=s.gridCols*p,c=s.gridRows*p,b=l.width/Math.max(1,i),u=l.height/Math.max(1,c),y=getComputedStyle(r).direction==="rtl"?(l.right-t)/b:(t-l.left)/b,N=(a-l.top)/u,f=Math.floor(y/p),$=Math.floor(N/p);return Number.isNaN(f)||Number.isNaN($)||f<0||$<0||f>=s.gridCols||$>=s.gridRows?null:{x:f,y:$}},U=(t,a,r,l,i)=>{s&&(t.preventDefault(),t.stopPropagation(),F(null),q(null),F(null),q(null),F(null),oe({kind:a,mode:"new",spanX:r,spanY:l,payload:i}),te(null))},We=(t,a,r,l,i)=>{s&&(t.preventDefault(),t.stopPropagation(),oe({kind:a,mode:"existing",spanX:l,spanY:i,tableId:a==="table"?r:void 0,objectId:a==="object"?r:void 0}),te(null))};v.useEffect(()=>{if(!g||!s)return;const t=l=>{var N,f;const i=Xe(l.clientX,l.clientY);if(!i){te(null);return}const c=i.x-Math.floor(g.spanX/2),b=i.y-Math.floor(g.spanY/2),u=l.shiftKey,x=g.mode==="existing"?{kind:g.kind,id:g.kind==="table"?g.tableId:g.objectId}:void 0,y=je(c,b,g.spanX,g.spanY,g.kind,((N=g.payload)==null?void 0:N.shape)??((f=g.payload)==null?void 0:f.objectType),u,x);if(!Se(y.x,y.y,g.spanX,g.spanY)){te(null);return}te({x:y.x,y:y.y}),Q({x:y.x,y:y.y})},a=()=>{var c,b,u,x,y,N,f;if(!ee){oe(null),te(null),Q(null);return}const l=ee.x,i=ee.y;if(g.mode==="existing")g.kind==="table"&&g.tableId?ye(g.tableId,{gridX:l,gridY:i}):g.kind==="object"&&g.objectId&&be(g.objectId,{gridX:l,gridY:i});else if(g.kind==="table"){const $=Number(((c=g.payload)==null?void 0:c.seats)??2),I=((b=g.payload)==null?void 0:b.shape)??"square",M={id:`T${Date.now()}`,name:`T${P}`,tableNumber:P,gridX:l,gridY:i,spanX:g.spanX,spanY:g.spanY,seats:$,shape:I,scale:1,rotationDeg:0,assetFile:(u=g.payload)==null?void 0:u.assetFile,kind:"table",sectionId:_==null?void 0:_.id};ce(W=>W+1),C({...s,tables:[...s.tables,M]})}else{const $={id:`O${Date.now()}`,type:((x=g.payload)==null?void 0:x.objectType)??"visual",gridX:l,gridY:i,spanX:g.spanX,spanY:g.spanY,label:(y=g.payload)==null?void 0:y.objectLabel,assetFile:(N=g.payload)==null?void 0:N.assetFile,kind:((f=g.payload)==null?void 0:f.objectKind)??"object",scale:1,rotationDeg:0};C({...s,objects:[...s.objects??[],$]})}oe(null),te(null),Q(null)},r=l=>{l.key==="Escape"&&(oe(null),te(null),Q(null))};return window.addEventListener("mousemove",t),window.addEventListener("mouseup",a,{once:!0}),window.addEventListener("keydown",r),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("keydown",r)}},[g,s,p,ee,P,_==null?void 0:_.id]);const ut=t=>{if(t.preventDefault(),!m||!s)return;const a=Xe(t.clientX,t.clientY);if(!a)return;const r=a.x,l=a.y,i=!!t.shiftKey;if(m.kind==="table"&&m.mode==="new"&&m.shape){const c=Number(m.seats??(m.shape==="booth"?4:2)),b=m.spanX&&m.spanY?{spanX:m.spanX,spanY:m.spanY}:qe(m.shape,c),u=je(r,l,b.spanX,b.spanY,"table",m.shape,i);if(!Se(u.x,u.y,b.spanX,b.spanY)){alert(d("floor.error.placement_outside","Cannot place item outside the restaurant shape"));return}const x={id:`T${Date.now()}`,name:`Table ${P}`,tableNumber:P,gridX:u.x,gridY:u.y,spanX:b.spanX,spanY:b.spanY,seats:c,shape:m.shape,assetFile:m.assetFile,kind:"table",sectionId:_==null?void 0:_.id,scale:1,rotationDeg:0};C({...s,tables:[...s.tables,x]}),ce(P+1),q(null),F(null),F(x.id),q(null),F(null)}else if(m.kind==="table"&&m.mode==="existing"&&m.tableId){const c=s.tables.find(u=>u.id===m.tableId);if(!c)return;const b=je(r,l,c.spanX||1,c.spanY||1,"table",c.shape,i,{kind:"table",id:c.id});if(!Se(b.x,b.y,c.spanX||1,c.spanY||1)){alert(d("floor.error.move_outside","Cannot move item outside the restaurant shape"));return}C({...s,tables:s.tables.map(u=>u.id===m.tableId?{...u,gridX:b.x,gridY:b.y}:u)})}else if(m.kind==="object"&&m.mode==="new"&&m.objectType){const c=s.objects??[],u={wall:{spanX:4,spanY:1,rotation:0,label:"wall_h"},divider:{spanX:2,spanY:1,rotation:0,label:"partition"},door:{spanX:1,spanY:1,rotation:0,label:"Door"},bar:{spanX:5,spanY:1,rotation:0,label:"Bar"},plant:{spanX:1,spanY:1,rotation:0,label:""}}[String(m.objectType)]??{spanX:1,spanY:1},x={spanX:Math.max(1,Number(m.spanX??u.spanX)||1),spanY:Math.max(1,Number(m.spanY??u.spanY)||1)},y=je(r,l,x.spanX,x.spanY,"object",m.objectType,i);if(!Se(y.x,y.y,x.spanX,x.spanY)){alert(d("floor.error.placement_outside","Cannot place item outside the restaurant shape"));return}const N={id:`O${Date.now()}`,type:m.objectType,gridX:y.x,gridY:y.y,spanX:x.spanX,spanY:x.spanY,rotation:m.rotation??u.rotation,label:m.objectLabel??u.label,assetFile:m.assetFile,kind:m.objectKind??"object",scale:1,rotationDeg:0};C({...s,objects:[...c,N]}),F(null),q(null),F(null),q(N.id),F(null)}else if(m.kind==="object"&&m.mode==="existing"&&m.objectId){const c=s.objects??[],b=c.find(x=>x.id===m.objectId);if(!b)return;const u=je(r,l,b.spanX||1,b.spanY||1,"object",b.type,i,{kind:"object",id:b.id});if(!Se(u.x,u.y,b.spanX||1,b.spanY||1)){alert(d("floor.error.move_outside","Cannot move item outside the restaurant shape"));return}C({...s,objects:c.map(x=>x.id===m.objectId?{...x,gridX:u.x,gridY:u.y}:x)})}ue(null),Q(null)},pt=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move";const a=Xe(t.clientX,t.clientY);a&&Q(a)},ht=t=>{s&&(C({...s,tables:s.tables.filter(a=>a.id!==t)}),F(null),q(null),F(null))},mt=t=>{if(!s)return;const a=s.objects??[];C({...s,objects:a.filter(r=>r.id!==t)}),q(null),F(null)},be=(t,a)=>{if(!s)return;const l=(s.objects??[]).map(i=>i.id===t?{...i,...a}:i);C({...s,objects:l})},ye=(t,a)=>{if(!s)return;const r=s.tables.map(l=>l.id===t?{...l,...a}:l);C({...s,tables:r})},ft=async()=>{if(s)try{const t=await fetch(`/api/floor-layouts/${h}/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(t.ok){let a=!1,r=null;try{const i=await fetch(`/api/floor-layouts/${h}/${s.id}/activate`,{method:"POST",credentials:"include"});if(a=i.ok,!i.ok){const c=await i.text().catch(()=>"");r=c||`${i.status} ${i.statusText}`,console.error("[FloorEditor] activate failed",{status:i.status,statusText:i.statusText,body:c})}}catch(i){r=i instanceof Error?i.message:String(i),console.error("[FloorEditor] activate threw",i)}E(j.map(i=>({...i,isActive:i.id===s.id})));const l=a?d("floor.success.save_and_activate","Layout saved and activated ‚úÖ"):d("floor.success.save_but_activate_failed","Layout saved ‚úÖ but activation failed: {error}").replace("{error}",r||"unknown");alert("‚úÖ "+l)}else{const a=await t.json();alert("‚ùå "+d("floor.error.save","Error saving: {error}").replace("{error}",a.error||"Unknown error"))}}catch(t){console.error("Save failed:",t),alert("‚ùå "+d("floor.error.save","Error saving: {error}").replace("{error}",t instanceof Error?t.message:String(t)))}};return s?e.jsxs("div",{className:"floor-editor",children:[e.jsxs("div",{className:"layout-tabs-bar",children:[e.jsx("div",{className:"layout-tabs",children:j.map(t=>e.jsxs("button",{className:`layout-tab ${s.id===t.id?"active":""} ${t.isActive?"is-active":""}`,onClick:()=>C(Te(t)),title:t.isActive?d("floor.toolbar.active_hint","Active layout (shown in live view)"):"",children:[t.name,t.isActive&&e.jsx("span",{className:"active-badge",children:"‚òÖ"})]},t.id))}),e.jsxs("div",{className:"layout-actions",children:[e.jsx("button",{className:"btn-icon-small",onClick:()=>ne(!0),title:d("floor.btn_new_layout","New Layout"),children:"‚ûï"}),e.jsx("button",{className:"btn-icon-small",onClick:()=>at(s.id),title:d("floor.btn_duplicate","Duplicate"),children:"üìã"}),!s.isActive&&e.jsx("button",{className:"btn-icon-small",onClick:()=>nt(s.id),title:d("floor.btn_set_active","Set as Active"),children:"‚≠ê"}),j.length>1&&e.jsx("button",{className:"btn-icon-small btn-danger",onClick:()=>st(s.id),title:d("floor.btn_delete","Delete"),children:"üóëÔ∏è"})]})]}),e.jsxs("div",{className:"editor-content",children:[e.jsxs("div",{className:"editor-sidebar",children:[T.length>0&&e.jsxs("div",{className:"sections-tabs",children:[e.jsx("h3",{children:d("floor.sections.title","Sections")}),e.jsx("div",{className:"tabs",children:T.map(t=>e.jsx("button",{className:`tab ${(_==null?void 0:_.id)===t.id?"active":""}`,onClick:()=>se(t),children:t.name},t.id))}),e.jsxs("label",{className:"fe-toggle",children:[e.jsx("input",{type:"checkbox",checked:ge,onChange:t=>xe(t.target.checked)}),e.jsx("span",{children:d("floor.sections.show_only_active","Show only active section")})]})]}),e.jsxs("h2",{children:["üß© ",d("floor.assets.title","Assets")]}),e.jsx("h3",{className:"fe-subtitle",children:d("floor.assets.seating","Seating")}),e.jsxs("div",{className:"palette",children:[e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",5,2,{shape:"rect",seats:5,assetFile:"bar.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:`${B}bar.svg`,alt:""})}),e.jsx("span",{children:"bar.svg ‚Ä¢ 5 (5√ó2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",2,2,{shape:"booth",seats:4,assetFile:"booth4.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("booth",4),alt:""})}),e.jsx("span",{children:"booth4.svg ‚Ä¢ 4 (2√ó2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",6,2,{shape:"booth",seats:6,assetFile:"large_booth.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("booth",6),alt:""})}),e.jsx("span",{children:"large_booth.svg ‚Ä¢ 6 (6√ó2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"object",1,1,{objectType:"chair",objectLabel:"chair",assetFile:"chair.svg",objectKind:"object"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:`${B}chair.svg`,alt:""})}),e.jsx("span",{children:"chair.svg ‚Ä¢ 1 (1√ó1)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"object",1,1,{objectType:"plant",objectLabel:"plant",assetFile:"plant.svg",objectKind:"object"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:`${B}plant.svg`,alt:""})}),e.jsx("span",{children:"plant.svg ‚Ä¢ 1 (1√ó1)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",2,2,{shape:"round",seats:4,assetFile:"round_table4.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("round",4),alt:""})}),e.jsx("span",{children:"round_table4.svg ‚Ä¢ 4 (2√ó2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",3,3,{shape:"round",seats:10,assetFile:"round_table_10.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("round",10),alt:""})}),e.jsx("span",{children:"round_table_10.svg ‚Ä¢ 10 (3√ó3)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",2,1,{shape:"square",seats:2,assetFile:"square_table2.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("square",2),alt:""})}),e.jsx("span",{children:"square_table2.svg ‚Ä¢ 2 (2√ó1)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",2,2,{shape:"square",seats:4,assetFile:"square_table4.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("square",4),alt:""})}),e.jsx("span",{children:"square_table4.svg ‚Ä¢ 4 (2√ó2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",2,2,{shape:"square",seats:6,assetFile:"square_table6.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("square",6),alt:""})}),e.jsx("span",{children:"square_table6.svg ‚Ä¢ 6 (2√ó2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",2,2,{shape:"square",seats:8,assetFile:"square_table8.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("square",8),alt:""})}),e.jsx("span",{children:"square_table8.svg ‚Ä¢ 8 (2√ó2)"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"table",2,2,{shape:"square",seats:10,assetFile:"square_table10.svg"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:le("square",10),alt:""})}),e.jsx("span",{children:"square_table10.svg ‚Ä¢ 10 (2√ó2)"})]})]}),e.jsx("h3",{className:"fe-subtitle",style:{marginTop:14},children:d("floor.assets.visual_only","Visual only")}),e.jsxs("div",{className:"palette",children:[e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"object",1,1,{objectType:"visual",objectLabel:"corner_partitaion",assetFile:"corner_partitaion.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",1,1,"corner_partitaion"),alt:""})}),e.jsx("span",{children:"corner_partitaion.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"object",2,2,{objectType:"visual",objectLabel:"cyclic_partition",assetFile:"cyclic_partition.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",2,2,"cyclic_partition"),alt:""})}),e.jsx("span",{children:"cyclic_partition.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"object",1,1,{objectType:"door",objectLabel:"door",assetFile:"door.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("door",1,1,"door"),alt:""})}),e.jsx("span",{children:"door.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"object",1,1,{objectType:"visual",objectLabel:"floor_brown",assetFile:"floor_brown.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",1,1,"floor_brown"),alt:""})}),e.jsx("span",{children:"floor_brown.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"object",4,1,{objectType:"visual",objectLabel:"horizintal_partitaion",assetFile:"horizintal_partitaion.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",4,1,"horizintal_partitaion"),alt:""})}),e.jsx("span",{children:"horizintal_partitaion.svg"})]}),e.jsxs("div",{className:"palette-item",onMouseDown:t=>U(t,"object",1,4,{objectType:"visual",objectLabel:"vertical_partition",assetFile:"vertical_partition.svg",objectKind:"visualOnly"}),children:[e.jsx("div",{className:"preview",children:e.jsx("img",{className:"preview-img",src:me("divider",1,4,"vertical_partition"),alt:""})}),e.jsx("span",{children:"vertical_partition.svg"})]})]}),e.jsxs("div",{className:"properties-panel",children:[e.jsx("h3",{children:d("floor.map.title","Map")}),e.jsxs("label",{children:[d("floor.map.cell_size","Cell size: {size}px").replace("{size}",String(p)),e.jsx("input",{type:"range",min:"40",max:"110",value:p,onChange:t=>D(Number(t.target.value))})]}),e.jsxs("label",{children:[d("floor.map.floor_label","Floor:"),e.jsx("select",{value:J,onChange:t=>{const a=L(String(t.target.value||"parquet_blue"));G(a),s&&C({...s,floorColor:a})},children:Object.keys(k).map(t=>e.jsx("option",{value:t,children:k[t].label},t))})]}),e.jsxs("div",{className:"row",style:{display:"flex",gap:8},children:[e.jsx("button",{className:"btn-icon-small",onClick:()=>{o(t=>!t),F(null),q(null),F(null),q(null),F(null)},children:n?`‚úÖ ${d("floor.shape.done","Done shape")}`:`‚úèÔ∏è ${d("floor.shape.edit","Edit shape")}`}),e.jsxs("button",{className:"btn-icon-small",onClick:()=>{if(!s)return;const t=s.gridRows*s.gridCols;C({...s,gridMask:Array.from({length:t},()=>1)})},title:d("floor.shape.reset_title","Reset shape"),children:["‚Ü∫ ",d("floor.shape.reset","Reset")]}),e.jsxs("button",{className:"btn-icon-small",onClick:()=>{s!=null&&s.gridMask&&C({...s,gridMask:s.gridMask.map(t=>t===1?0:1)})},title:d("floor.shape.invert_title","Invert shape"),children:["‚áÑ ",d("floor.shape.invert","Invert")]})]}),n&&e.jsx("div",{className:"fe-hint",style:{marginTop:8},children:d("floor.shape.paint_hint","Paint the restaurant shape: click/drag cells to enable/disable.")})]}),O&&e.jsxs("div",{className:"properties-panel",children:[e.jsx("h3",{children:d("floor.properties.selected_table","Selected: {name}").replace("{name}",O.name)}),e.jsxs("label",{children:[d("floor.properties.name","Name:"),e.jsx("input",{type:"text",value:O.name,onChange:t=>ye(O.id,{name:t.target.value})})]}),e.jsxs("label",{children:[d("floor.properties.seats","Seats:"),e.jsx("input",{type:"number",min:"1",max:"12",value:O.seats,onChange:t=>{const a=Math.max(1,Number(t.target.value)||1);ye(O.id,{seats:a})}})]}),e.jsxs("label",{children:[d("floor.properties.size","Size:"),e.jsx("input",{type:"range",min:"0.6",max:"1.4",step:"0.05",className:"range-ltr",value:O.scale??1,onChange:t=>ye(O.id,{scale:Number(t.target.value)})}),e.jsxs("span",{style:{marginInlineStart:8},children:[Math.round((O.scale??1)*100),"%"]})]}),e.jsxs("div",{className:"row",style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{opacity:.85},children:d("floor.properties.rotate","Rotate:")}),e.jsx("button",{className:"btn-icon-small",onClick:()=>ye(O.id,{rotationDeg:ve((O.rotationDeg??0)-45)}),title:"Rotate -45¬∞",children:"‚Ü∫"}),e.jsxs("span",{style:{minWidth:54,textAlign:"center",opacity:.9},children:[ve(O.rotationDeg??0),"¬∞"]}),e.jsx("button",{className:"btn-icon-small",onClick:()=>ye(O.id,{rotationDeg:ve((O.rotationDeg??0)+45)}),title:"Rotate +45¬∞",children:"‚Üª"})]}),e.jsxs("button",{className:"btn-danger",onClick:()=>ht(O.id),children:["üóëÔ∏è ",d("common.btn_delete","Delete")]})]}),Y&&e.jsxs("div",{className:"properties-panel",children:[e.jsx("h3",{children:d("floor.properties.selected_object","Selected: {type}").replace("{type}",Y.type)}),e.jsxs("label",{children:[d("floor.properties.name","Name:"),e.jsx("input",{type:"text",value:Y.label??"",onChange:t=>be(Y.id,{label:t.target.value})})]}),e.jsxs("div",{className:"row",style:{display:"flex",gap:8},children:[e.jsxs("label",{style:{flex:1},children:["W:",e.jsx("input",{type:"number",min:"1",max:"12",value:Y.spanX,onChange:t=>be(Y.id,{spanX:Math.max(1,Number(t.target.value)||1)})})]}),e.jsxs("label",{style:{flex:1},children:["H:",e.jsx("input",{type:"number",min:"1",max:"12",value:Y.spanY,onChange:t=>be(Y.id,{spanY:Math.max(1,Number(t.target.value)||1)})})]})]}),e.jsxs("label",{children:[d("floor.properties.size","Size:"),e.jsx("input",{type:"range",min:"0.6",max:"1.4",step:"0.05",className:"range-ltr",value:Y.scale??1,onChange:t=>be(Y.id,{scale:Number(t.target.value)})}),e.jsxs("span",{style:{marginInlineStart:8},children:[Math.round((Y.scale??1)*100),"%"]})]}),e.jsxs("div",{className:"row",style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx("span",{style:{opacity:.85},children:d("floor.properties.rotate","Rotate:")}),e.jsx("button",{className:"btn-icon-small",onClick:()=>be(Y.id,{rotationDeg:ve((Y.rotationDeg??Y.rotation??0)-45)}),title:"Rotate -45¬∞",children:"‚Ü∫"}),e.jsxs("span",{style:{minWidth:54,textAlign:"center",opacity:.9},children:[ve(Y.rotationDeg??Y.rotation??0),"¬∞"]}),e.jsx("button",{className:"btn-icon-small",onClick:()=>be(Y.id,{rotationDeg:ve((Y.rotationDeg??Y.rotation??0)+45)}),title:"Rotate +45¬∞",children:"‚Üª"})]}),e.jsxs("button",{className:"btn-danger",onClick:()=>mt(Y.id),children:["üóëÔ∏è ",d("common.btn_delete","Delete")]})]}),e.jsxs("button",{className:"btn-save",onClick:ft,children:["üíæ ",d("floor.btn_save_layout","Save Layout")]})]}),e.jsxs("div",{className:`editor-canvas ${we?"is-panning":""}`,ref:pe,onWheel:lt,onMouseDown:it,children:[e.jsxs("div",{className:"fe-canvas-controls",children:[e.jsx("button",{className:"btn-icon-small",onClick:()=>{var t,a;return Ye(De(X*1.1),(((t=pe.current)==null?void 0:t.getBoundingClientRect().left)||0)+40,(((a=pe.current)==null?void 0:a.getBoundingClientRect().top)||0)+40)},title:d("floor.toolbar.zoom_in","Zoom in"),children:"Ôºã"}),e.jsx("button",{className:"btn-icon-small",onClick:()=>{var t,a;return Ye(De(X*.9),(((t=pe.current)==null?void 0:t.getBoundingClientRect().left)||0)+40,(((a=pe.current)==null?void 0:a.getBoundingClientRect().top)||0)+40)},title:d("floor.toolbar.zoom_out","Zoom out"),children:"Ôºç"}),e.jsx("button",{className:"btn-icon-small",onClick:rt,title:d("floor.toolbar.fit_screen","Fit to screen"),children:"‚§¢"}),e.jsxs("div",{className:"fe-zoom-readout",children:[Math.round(X*100),"%"]}),e.jsx("div",{className:"fe-hint",children:Oe?d("floor.hints.pan_drag","Pan: drag"):d("floor.hints.controls","Tip: hold Space to pan, Ctrl+wheel to zoom")})]}),(()=>{const t=k[J];return e.jsxs("div",{className:"fe-grid",ref:Ie,style:{direction:"ltr",gridTemplateColumns:`repeat(${s.gridCols}, ${p}px)`,gridTemplateRows:`repeat(${s.gridRows}, ${p}px)`,transform:`translate(${K.x}px, ${K.y}px) scale(${X})`,transformOrigin:"0 0","--cell":`${p}px`,"--floor-bg":t.bg,"--floor-bg-size":t.size,"--floor-bg-repeat":t.repeat,"--floor-bg-position":t.pos},onDragOver:n?void 0:pt,onDrop:n?void 0:ut,onDragLeave:()=>Q(null),children:[(()=>{if(!H||!m||!s)return null;const a=p,r=10,l=()=>{if(m.kind==="table"){if(m.mode==="new"){const f=String(m.shape||"square"),$=Number(m.seats??(f==="booth"?4:2)),I=m.spanX&&m.spanY?{spanX:m.spanX,spanY:m.spanY}:qe(f,$);return{spanX:I.spanX,spanY:I.spanY,subtype:f}}const N=s.tables.find(f=>f.id===m.tableId);if(N)return{spanX:N.spanX||1,spanY:N.spanY||1,subtype:N.shape}}if(m.kind==="object"){if(m.mode==="new"){const f={spanX:Math.max(1,Number(m.spanX??1)||1),spanY:Math.max(1,Number(m.spanY??1)||1)};return{spanX:f.spanX,spanY:f.spanY,subtype:m.objectType}}const N=(s.objects??[]).find(f=>f.id===m.objectId);if(N)return{spanX:N.spanX||1,spanY:N.spanY||1,subtype:N.type}}return{spanX:1,spanY:1,subtype:""}},{spanX:i,spanY:c,subtype:b}=l(),u=je(H.x,H.y,i,c,m.kind,String(b),!1,m.mode==="existing"?{kind:m.kind,id:m.kind==="table"?m.tableId:m.objectId}:void 0),x=r+u.x*a,y=r+u.y*a;return e.jsxs(e.Fragment,{children:[u.guides.v.map((N,f)=>e.jsx("div",{className:"fe-guide-line v",style:{left:r+N*a}},`pv-v-${f}`)),u.guides.h.map((N,f)=>e.jsx("div",{className:"fe-guide-line h",style:{top:r+N*a}},`pv-h-${f}`)),e.jsx("div",{className:"fe-drop-preview",style:{left:x,top:y,width:i*a,height:c*a}})]})})(),g&&ee&&(()=>{var b,u,x,y,N,f,$,I;const a=p,r=10,l=r+ee.x*a,i=r+ee.y*a;let c="";if(g.mode==="existing"){if(g.kind==="table"&&g.tableId){const M=s.tables.find(W=>W.id===g.tableId);M&&(c=M.assetFile?`${B}${M.assetFile}`:le(M.shape,M.seats))}if(g.kind==="object"&&g.objectId){const M=(s.objects??[]).find(W=>W.id===g.objectId);M&&(c=M.assetFile?`${B}${M.assetFile}`:me(M.type,M.spanX,M.spanY,M.label))}}else if(g.kind==="table"){const M=String(((b=g.payload)==null?void 0:b.shape)??"square"),W=Number(((u=g.payload)==null?void 0:u.seats)??2);c=(x=g.payload)!=null&&x.assetFile?`${B}${(y=g.payload)==null?void 0:y.assetFile}`:le(M,W)}else{const M=((N=g.payload)==null?void 0:N.objectType)??"visual";c=(f=g.payload)!=null&&f.assetFile?`${B}${($=g.payload)==null?void 0:$.assetFile}`:me(M,g.spanX,g.spanY,(I=g.payload)==null?void 0:I.objectLabel)}return e.jsx("div",{className:"fe-drop-preview",style:{left:l,top:i,width:g.spanX*a,height:g.spanY*a,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:c&&e.jsx("img",{src:c,alt:"",style:{width:"100%",height:"100%",objectFit:"contain",display:"block",opacity:.75}})})})(),Array.from({length:s.gridRows*s.gridCols}).map((a,r)=>{var N;const l=Math.floor(r/s.gridCols),i=r%s.gridCols,c=s.tables.find(f=>ge&&_&&String(f.sectionId||"")!==String(_.id)?!1:i>=f.gridX&&i<f.gridX+f.spanX&&l>=f.gridY&&l<f.gridY+f.spanY),u=(s.objects??[]).find(f=>i>=f.gridX&&i<f.gridX+f.spanX&&l>=f.gridY&&l<f.gridY+f.spanY),x=c&&c.gridX===i&&c.gridY===l,y=u&&u.gridX===i&&u.gridY===l;return e.jsxs("div",{className:`fe-grid-cell ${(()=>{var I;const f=l*s.gridCols+i;return(((I=s.gridMask)==null?void 0:I[f])??1)===1?"active":"inactive"})()}`,onMouseDown:f=>{if(!n||!s)return;f.preventDefault(),A(!0);const $=l*s.gridCols+i,I=s.gridRows*s.gridCols,M=(s.gridMask??Array.from({length:I},()=>1)).slice(),W=M[$]===1?0:1;ze.current=W,M[$]=W,C({...s,gridMask:M})},onMouseEnter:f=>{if(!n||!S||!s)return;f.preventDefault();const $=ze.current;if($==null)return;const I=l*s.gridCols+i,M=s.gridRows*s.gridCols,W=(s.gridMask??Array.from({length:M},()=>1)).slice();W[I]!==$&&(W[I]=$,C({...s,gridMask:W}))},children:[y&&u&&e.jsxs("div",{className:`floor-object type-${u.type} ${(Y==null?void 0:Y.id)===u.id?"selected":""}`,onMouseDown:f=>We(f,"object",u.id,u.spanX||1,u.spanY||1),onClick:()=>{F(null),q(null),F(null),q(u.id),F(null)},style:{width:`${_e(u.spanX)}px`,height:`${_e(u.spanY)}px`,transform:`rotate(${ve(u.rotationDeg??u.rotation??0)}deg)`},children:[e.jsx("img",{className:`fe-asset fe-asset--${(u.assetFile||"").replace(/[^a-z0-9]+/gi,"_").toLowerCase()}`,style:{transform:`scale(${Be(u.scale,tt(u.type))})`},src:u.assetFile?`${B}${u.assetFile}`:me(u.type,u.spanX,u.spanY,u.label),alt:""}),u.label&&e.jsx("div",{className:"obj-label",children:u.label})]}),x&&e.jsxs("div",{className:`table ${c.shape} ${(O==null?void 0:O.id)===c.id?"selected":""} ${!ge&&_&&String(c.sectionId||"")&&String(c.sectionId||"")!==String(_.id)?"dimmed":""}`,onMouseDown:f=>We(f,"table",c.id,c.spanX||1,c.spanY||1),onClick:()=>{q(null),F(null),F(c.id),q(null),F(null)},style:{width:`${_e(c.spanX)}px`,height:`${_e(c.spanY)}px`},children:[e.jsx("div",{className:"fe-table-visual","data-asset":c.assetFile||"",children:e.jsx("img",{className:`fe-asset fe-asset--${(c.assetFile||"").replace(/[^a-z0-9]+/gi,"_").toLowerCase()}`,style:{transform:`rotate(${ve(c.rotationDeg??0)}deg) scale(${Be(c.scale,et(c.shape,c.seats,c.assetFile))})`},src:c.assetFile?`${B}${c.assetFile}`:le(c.shape,c.seats),alt:""})}),e.jsxs("div",{className:"fe-table-overlay",children:[e.jsx("div",{className:"table-label",children:c.name}),e.jsxs("div",{className:"table-seats",children:[c.seats," ",d("floor.properties.seats_unit","seats")]}),c.sectionId&&T.length>0&&e.jsx("div",{className:"table-section",children:((N=T.find(f=>String(f.id)===String(c.sectionId)))==null?void 0:N.name)||d("floor.properties.section","Section")})]})]})]},r)})]})})()]})]}),ae&&e.jsx("div",{className:"modal-overlay",onClick:()=>ne(!1),children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{children:d("floor.modal.create_title","Create New Layout")}),e.jsx("input",{type:"text",placeholder:d("floor.modal.placeholder_name","Layout name (e.g., Main Floor, Patio)"),value:fe,onChange:t=>he(t.target.value),onKeyDown:t=>t.key==="Enter"&&ke(),autoFocus:!0}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:ke,className:"btn-primary",children:d("floor.btn_create","Create")}),e.jsx("button",{onClick:()=>ne(!1),className:"btn-secondary",children:d("common.btn_cancel","Cancel")})]})]})})]}):e.jsxs("div",{className:"floor-editor-empty",children:[e.jsx("h2",{children:d("floor.empty_state","No floor layouts found. Please create a floor layout first.")}),e.jsx("p",{children:d("floor.empty_hint","Create your first floor layout to get started.")}),e.jsxs("button",{className:"btn-primary",onClick:()=>ne(!0),children:["‚ûï ",d("floor.btn_create_new","Create New Layout")]}),ae&&e.jsx("div",{className:"modal-overlay",onClick:()=>ne(!1),children:e.jsxs("div",{className:"modal-content",onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{children:d("floor.modal.create_title","Create New Layout")}),e.jsx("input",{type:"text",placeholder:d("floor.modal.placeholder_name","Layout name (e.g., Main Floor, Patio)"),value:fe,onChange:t=>he(t.target.value),onKeyDown:t=>t.key==="Enter"&&ke(),autoFocus:!0}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:ke,className:"btn-primary",children:d("common.btn_add","Create")}),e.jsx("button",{onClick:()=>ne(!1),className:"btn-secondary",children:d("common.btn_cancel","Cancel")})]})]})})]})}const Ce={waiter:"#FF6B6B",chef:"#4ECDC4",manager:"#FFE66D",busser:"#95E1D3",host:"#C7B3E5",bartender:"#F38181"},Nt={scheduled:"#E8F5E9",checked_in:"#C8E6C9",checked_out:"#BDBDBD",called_out:"#FFE0B2",cancelled:"#FFCDD2"},wt=h=>{const j=new Date(h),E=j.getDay(),s=j.getDate()-E+(E===0?-6:1);return new Date(j.setDate(s))},Re=h=>{const j=wt(h),E=[];for(let s=0;s<7;s++){const C=new Date(j);C.setDate(C.getDate()+s),E.push(C)}return E},de=h=>h.toISOString().split("T")[0],Ve=h=>h.toLocaleDateString("en-US",{month:"short",day:"numeric"}),He=h=>h.toLocaleDateString("en-US",{month:"long",year:"numeric"});function St({restaurantId:h}){const[j,E]=v.useState([]),[s,C]=v.useState([]),[T,ie]=v.useState(new Date().toISOString().split("T")[0]),[_,se]=v.useState("day"),[z,F]=v.useState(!1),[V,q]=v.useState(!1),[O,Y]=v.useState(!1),[m,ue]=v.useState({firstName:"",lastName:"",email:"",role:"waiter",userId:""}),[P,ce]=v.useState({staffId:"",startTime:"09:00",endTime:"17:00"});v.useEffect(()=>{ae()},[T,_,h]);const ae=async()=>{F(!0);try{const p=await fetch(`/api/restaurants/${h}/staff`);p.ok&&E(await p.json());let D=T,R=T;if(_==="week"){const L=Re(new Date(T));D=de(L[0]),R=de(L[6])}else if(_==="month"){const L=new Date(T);D=de(new Date(L.getFullYear(),L.getMonth(),1)),R=de(new Date(L.getFullYear(),L.getMonth()+1,0))}const k=await fetch(`/api/restaurants/${h}/shifts?startDate=${D}&endDate=${R}`);k.ok&&C(await k.json())}catch(p){console.error("Failed to load data:",p)}finally{F(!1)}},ne=async()=>{if(!m.firstName||!m.lastName||!m.email){alert("Please fill in required fields");return}try{(await fetch(`/api/restaurants/${h}/staff`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).ok&&(ue({firstName:"",lastName:"",email:"",role:"waiter",userId:""}),q(!1),ae())}catch(p){console.error("Failed to add staff:",p)}},fe=async()=>{if(!P.staffId){alert("Please select a staff member");return}try{(await fetch(`/api/restaurants/${h}/shifts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({staffId:P.staffId,date:T,startTime:P.startTime,endTime:P.endTime})})).ok&&(ce({staffId:"",startTime:"09:00",endTime:"17:00"}),Y(!1),ae())}catch(p){console.error("Failed to add shift:",p)}},he=async p=>{try{await fetch(`/api/restaurants/${h}/shifts/${p}/check-in`,{method:"POST"}),ae()}catch(D){console.error("Failed to check in:",D)}},ge=async p=>{try{await fetch(`/api/restaurants/${h}/shifts/${p}/check-out`,{method:"POST"}),ae()}catch(D){console.error("Failed to check out:",D)}},xe=async p=>{try{await fetch(`/api/restaurants/${h}/shifts/${p}`,{method:"DELETE"}),ae()}catch(D){console.error("Failed to cancel shift:",D)}},H=p=>{const D=new Date(T);_==="week"?D.setDate(D.getDate()+p*7):_==="month"?D.setMonth(D.getMonth()+p):D.setDate(D.getDate()+p),ie(de(D))},Q=()=>{const p=new Date(T),D=s.filter(n=>n.date===T),R=new Map;D.forEach(n=>{R.has(n.staffId)||R.set(n.staffId,[]),R.get(n.staffId).push(n)});const k=n=>{const[o,S]=n.split(":").map(Number);return o*60+S},L=9*60,G=23*60-L;return e.jsxs("div",{className:"shift-board day-view",children:[e.jsx("div",{className:"day-view-header",children:e.jsx("h2",{children:p.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})})}),e.jsxs("div",{className:"day-timeline",children:[e.jsx("div",{className:"time-slots",children:Array.from({length:15},(n,o)=>e.jsxs("div",{className:"time-slot",children:[9+o,":00"]},o))}),e.jsx("div",{className:"staff-rows",children:j.map(n=>e.jsxs("div",{className:"staff-row",children:[e.jsxs("div",{className:"staff-name",style:{borderLeftColor:Ce[n.role]||"#999"},children:[e.jsxs("span",{children:[n.firstName," ",n.lastName]}),e.jsx("small",{children:n.role})]}),e.jsx("div",{className:"timeline-row",children:(R.get(n.id)||[]).map(o=>{const S=k(o.startTime),A=k(o.endTime),X=(S-L)/G*100,Z=(A-S)/G*100;return e.jsxs("div",{className:"shift-bar",style:{left:`${X}%`,width:`${Z}%`,backgroundColor:Ce[o.staffRole]||"#999",opacity:Nt[o.status]?1:.6},title:`${o.startTime}-${o.endTime} (${o.status})`,children:[e.jsxs("span",{className:"shift-time",children:[o.startTime,"-",o.endTime]}),e.jsxs("div",{className:"shift-actions",children:[o.status==="scheduled"&&e.jsx("button",{onClick:()=>he(o.id),className:"btn-checkin",children:"Check In"}),o.status==="checked_in"&&e.jsx("button",{onClick:()=>ge(o.id),className:"btn-checkout",children:"Check Out"}),e.jsx("button",{onClick:()=>xe(o.id),className:"btn-cancel",children:"Cancel"})]})]},o.id)})})]},n.id))})]})]})},g=()=>{const p=Re(new Date(T)),D=s.filter(k=>{const L=new Date(k.date);return L>=p[0]&&L<=p[6]}),R=new Map;return j.forEach(k=>{R.set(k.id,new Map),p.forEach(L=>{const J=de(L);R.get(k.id).set(J,[])})}),D.forEach(k=>{const L=R.get(k.staffId);if(L){const J=L.get(k.date)||[];J.push(k),L.set(k.date,J)}}),e.jsxs("div",{className:"shift-board week-view",children:[e.jsx("div",{className:"week-header",children:e.jsxs("h2",{children:[de(p[0])," to ",de(p[6])]})}),e.jsxs("div",{className:"week-table",children:[e.jsxs("div",{className:"week-row header-row",children:[e.jsx("div",{className:"staff-cell",children:"Staff"}),p.map(k=>e.jsxs("div",{className:"day-cell",children:[e.jsx("div",{children:k.toLocaleDateString("en-US",{weekday:"short"})}),e.jsx("div",{className:"date-num",children:Ve(k)})]},de(k)))]}),j.map(k=>e.jsxs("div",{className:"week-row",children:[e.jsx("div",{className:"staff-cell",children:e.jsxs("div",{className:"staff-info",style:{borderLeftColor:Ce[k.role]||"#999"},children:[e.jsxs("span",{className:"staff-name",children:[k.firstName," ",k.lastName]}),e.jsx("span",{className:"staff-role",children:k.role})]})}),p.map(L=>{var n;const J=de(L),G=((n=R.get(k.id))==null?void 0:n.get(J))||[];return e.jsx("div",{className:"day-cell",children:G.map(o=>e.jsx("div",{className:"week-shift",style:{backgroundColor:Ce[o.staffRole]||"#999"},title:`${o.startTime}-${o.endTime}`,children:e.jsxs("small",{children:[o.startTime,"-",o.endTime]})},o.id))},J)})]},k.id))]})]})},oe=()=>{const p=new Date(T),D=p.getFullYear(),R=p.getMonth(),k=new Date(D,R,1),L=new Date(D,R+1,0),J=new Date(D,R,0).getDate(),G=[];for(let o=k.getDay()-1;o>=0;o--)G.push(new Date(D,R-1,J-o));for(let o=1;o<=L.getDate();o++)G.push(new Date(D,R,o));const n=42-G.length;for(let o=1;o<=n;o++)G.push(new Date(D,R+1,o));return e.jsxs("div",{className:"shift-board month-view",children:[e.jsx("div",{className:"month-header",children:e.jsx("h2",{children:He(p)})}),e.jsxs("div",{className:"month-calendar",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(o=>e.jsx("div",{className:"day-header",children:o},o)),G.map((o,S)=>{const A=o?de(o):"",X=o?s.filter(K=>K.date===A):[],Z=o&&o.getMonth()===R;return e.jsxs("div",{className:`month-day ${Z?"current":"other"}`,children:[e.jsx("div",{className:"day-number",children:o==null?void 0:o.getDate()}),e.jsx("div",{className:"shift-count",children:X.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"count-badge",children:[X.length," shifts"]}),e.jsx("div",{className:"shift-dots",children:j.map(K=>X.some(we=>we.staffId===K.id)?e.jsx("span",{className:"dot",style:{backgroundColor:Ce[K.role]||"#999"},title:K.firstName},K.id):null)})]})})]},S)})]})]})},ee=new Date(T),te=_==="week"?`Week of ${Ve(Re(ee)[0])}`:_==="month"?He(ee):ee.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return e.jsxs("div",{className:"shift-board-container",children:[e.jsxs("div",{className:"board-header",children:[e.jsxs("div",{className:"view-controls",children:[e.jsx("button",{className:`view-btn ${_==="day"?"active":""}`,onClick:()=>se("day"),children:"Day"}),e.jsx("button",{className:`view-btn ${_==="week"?"active":""}`,onClick:()=>se("week"),children:"Week"}),e.jsx("button",{className:`view-btn ${_==="month"?"active":""}`,onClick:()=>se("month"),children:"Month"})]}),e.jsxs("div",{className:"date-controls",children:[e.jsx("button",{onClick:()=>H(-1),children:"‚Üê Prev"}),e.jsx("div",{className:"current-date",children:te}),e.jsx("button",{onClick:()=>H(1),children:"Next ‚Üí"}),e.jsx("input",{type:"date",value:T,onChange:p=>ie(p.target.value)})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"btn-primary",onClick:()=>q(!V),children:"+ Add Staff"}),e.jsx("button",{className:"btn-primary",onClick:()=>Y(!O),children:"+ Add Shift"})]})]}),V&&e.jsxs("div",{className:"form-panel",children:[e.jsx("h3",{children:"Add Staff Member"}),e.jsx("input",{type:"text",placeholder:"First Name",value:m.firstName,onChange:p=>ue({...m,firstName:p.target.value})}),e.jsx("input",{type:"text",placeholder:"Last Name",value:m.lastName,onChange:p=>ue({...m,lastName:p.target.value})}),e.jsx("input",{type:"email",placeholder:"Email",value:m.email,onChange:p=>ue({...m,email:p.target.value})}),e.jsxs("select",{value:m.role,onChange:p=>ue({...m,role:p.target.value}),children:[e.jsx("option",{value:"waiter",children:"Waiter"}),e.jsx("option",{value:"chef",children:"Chef"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"busser",children:"Busser"}),e.jsx("option",{value:"host",children:"Host"}),e.jsx("option",{value:"bartender",children:"Bartender"})]}),e.jsx("button",{onClick:ne,className:"btn-primary",children:"Save Staff"}),e.jsx("button",{onClick:()=>q(!1),className:"btn-secondary",children:"Cancel"})]}),O&&e.jsxs("div",{className:"form-panel",children:[e.jsx("h3",{children:"Create Shift"}),e.jsxs("select",{value:P.staffId,onChange:p=>ce({...P,staffId:p.target.value}),children:[e.jsx("option",{value:"",children:"Select Staff Member"}),j.map(p=>e.jsxs("option",{value:p.id,children:[p.firstName," ",p.lastName]},p.id))]}),e.jsx("input",{type:"time",value:P.startTime,onChange:p=>ce({...P,startTime:p.target.value})}),e.jsx("input",{type:"time",value:P.endTime,onChange:p=>ce({...P,endTime:p.target.value})}),e.jsx("button",{onClick:fe,className:"btn-primary",children:"Create Shift"}),e.jsx("button",{onClick:()=>Y(!1),className:"btn-secondary",children:"Cancel"})]}),z?e.jsx("p",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[_==="day"&&e.jsx(Q,{}),_==="week"&&e.jsx(g,{}),_==="month"&&e.jsx(oe,{})]})]})}const Ct={empty:"Empty",occupied:"Occupied",reserved:"Reserved",dirty:"Dirty"};function _t({table:h,restaurantId:j,isOpen:E,onClose:s,onStatusChange:C}){const[T,ie]=v.useState(!1);if(!E)return null;const _=async se=>{ie(!0);try{const z=await fetch(`/api/tables/${j}/${h.tableId}/status`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:se})});if(z.ok)C(h.tableId,se),s();else{const F=await z.text();console.error("Status update failed:",z.status,z.statusText,F);let V=`Status ${z.status}`;try{V=JSON.parse(F).error||V}catch{V=z.statusText||V}alert(`‚ùå Failed to update table status: ${V}`)}}catch(z){console.error("Failed to update table status:",z),alert(`‚ùå Error updating table status: ${z instanceof Error?z.message:String(z)}`)}finally{ie(!1)}};return e.jsx("div",{className:"modal-overlay",onClick:s,children:e.jsxs("div",{className:"modal-content",onClick:se=>se.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Table ",h.tableNumber]}),e.jsx("button",{className:"modal-close",onClick:s,children:"‚úï"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"table-info-section",children:[e.jsx("h3",{children:"Current Status"}),e.jsx("div",{className:"status-badge",style:{color:kt(h.status)},children:Ct[h.status]})]}),h.status==="occupied"&&e.jsxs("div",{className:"order-info-section",children:[e.jsx("h3",{children:"Order Details"}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Guests:"}),e.jsx("span",{className:"value",children:h.guestCount||"‚Äî"})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Items Pending:"}),e.jsx("span",{className:"value",children:h.itemsPending||0})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Items Ready:"}),e.jsx("span",{className:"value",children:h.itemsReady||0})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"Total:"}),e.jsxs("span",{className:"value",children:["‚Ç™",(h.orderTotal||0).toFixed(0)]})]})]}),e.jsxs("div",{className:"actions-section",children:[e.jsx("h3",{children:"Actions"}),e.jsxs("div",{className:"actions",children:[h.status!=="dirty"&&e.jsx("button",{className:"action-btn btn-mark-dirty",onClick:()=>_("dirty"),disabled:T,children:"üßπ Mark Dirty"}),h.status!=="reserved"&&e.jsx("button",{className:"action-btn btn-reserve",onClick:()=>_("reserved"),disabled:T,children:"üìÖ Reserve"}),h.status!=="empty"&&e.jsx("button",{className:"action-btn btn-empty",onClick:()=>_("empty"),disabled:T,children:"‚úî Clear Table"}),h.status==="occupied"&&e.jsx("button",{className:"action-btn btn-view-order",onClick:()=>{window.location.href=`/waiter/${j}/${h.tableNumber}`},disabled:T,children:"üìã View Order"})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn-close",onClick:s,children:"Close"})})]})})}function kt(h){switch(h){case"empty":return"#4CAF50";case"occupied":return"#FF6B6B";case"reserved":return"#FFC107";case"dirty":return"#9C27B0";default:return"#333"}}const $e={empty:"#4CAF50",occupied:"#FF6B6B",reserved:"#FFC107",dirty:"#9C27B0"},Dt={empty:d("floor.status.empty","Empty"),occupied:d("floor.status.occupied","Occupied"),reserved:d("floor.status.reserved","Reserved"),dirty:d("floor.status.dirty","Dirty")},Je="/floor_assets/",Ge=(h,j=1)=>{const E=Number(h);return Number.isFinite(E)?Math.max(.5,Math.min(1.6,E)):j},Ze=h=>{const j=Number(h);return Number.isFinite(j)?Math.round(j/45)*45:0};function $t({restaurantId:h}){const[j,E]=v.useState([]),[s,C]=v.useState(null),[T,ie]=v.useState(new Map),[_,se]=v.useState(!0),[z,F]=v.useState(!0),[V,q]=v.useState(5e3),[O,Y]=v.useState(null),[m,ue]=v.useState(!1),[P,ce]=v.useState(1),[ae,ne]=v.useState({x:0,y:0}),[fe,he]=v.useState(!1),[ge,xe]=v.useState(!1),H=v.useRef(null),Q=72;v.useEffect(()=>{const n=S=>{S.code==="Space"&&xe(!0)},o=S=>{S.code==="Space"&&(xe(!1),he(!1))};return window.addEventListener("keydown",n),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",o)}},[]),v.useEffect(()=>{(async()=>{try{const o=await fetch(`/api/floor-layouts/${h}`);if(o.ok){const S=await o.json();E(S);const A=S.find(X=>X.isActive)||S[0];A&&await g(A.id)}}catch(o){console.error("Failed to load layouts:",o)}finally{se(!1)}})()},[h]);const g=async n=>{try{const o=await fetch(`/api/floor-layouts/${h}/${n}`);if(o.ok){const S=await o.json();if(C(S),S.tableStatuses){const A=new Map;S.tableStatuses.forEach(X=>A.set(X.tableId,X)),ie(A)}requestAnimationFrame(()=>ee(S))}}catch(o){console.error("Failed to load layout:",o)}};v.useEffect(()=>{if(!z||!s)return;const n=setInterval(async()=>{try{const o=await fetch(`/api/floor-layouts/${h}/${s.id}`);if(o.ok){const S=await o.json();if(S.tableStatuses){const A=new Map;S.tableStatuses.forEach(X=>A.set(X.tableId,X)),ie(A)}}}catch(o){console.error("Failed to refresh table statuses:",o)}},V);return()=>clearInterval(n)},[h,z,V,s]);const oe=n=>Math.max(.4,Math.min(2.5,n)),ee=n=>{const o=n??s;if(!H.current||!o)return;const S=H.current.getBoundingClientRect(),A=o.gridCols*Q,X=o.gridRows*Q,Z=24,K=oe(Math.min((S.width-Z*2)/A,(S.height-Z*2)/X,1.2));ce(K);const re=Math.round((S.width-A*K)/2),we=Math.round((S.height-X*K)/2);ne({x:re,y:we})},te=(n,o,S)=>{if(!H.current)return;const A=H.current.getBoundingClientRect(),X=o-A.left,Z=S-A.top;ne(K=>{const re=n/P;return{x:Math.round(X-(X-K.x)*re),y:Math.round(Z-(Z-K.y)*re)}}),ce(n)},p=n=>{if(!(n.ctrlKey||n.metaKey))return;n.preventDefault();const o=oe(P*(n.deltaY>0?.9:1.1));te(o,n.clientX,n.clientY)},D=n=>{const o=n.button===1,S=ge&&n.button===0;if(!o&&!S)return;n.preventDefault(),he(!0);const A={x:n.clientX,y:n.clientY},X={...ae},Z=re=>{ne({x:X.x+(re.clientX-A.x),y:X.y+(re.clientY-A.y)})},K=()=>{he(!1),window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",K)};window.addEventListener("mousemove",Z),window.addEventListener("mouseup",K)},R=n=>T.get(n)||{tableId:n,tableNumber:0,status:"empty"},k=n=>{Y(n),ue(!0)},L=(n,o)=>{const S={...R(n),status:o};ie(A=>new Map(A).set(n,S))},J=n=>{if(!n)return"";const o=Math.floor((Date.now()-n)/1e3/60);return o<1?"Just now":o<60?`${o}m`:`${Math.floor(o/60)}h ${o%60}m`},G=n=>n==null?"":`‚Ç™${n.toFixed(0)}`;return _?e.jsx("div",{className:"live-view-loading",children:d("floor.loading","Loading floor layouts...")}):s?e.jsxs("div",{className:"restaurant-live-view",children:[e.jsxs("div",{className:"live-view-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:"üî¥ Live Floor View"}),j.length>1&&e.jsx("div",{className:"layout-selector",children:e.jsx("select",{value:s.id,onChange:n=>g(n.target.value),children:j.map(n=>e.jsxs("option",{value:n.id,children:[n.name," ",n.isActive?"(Active)":""]},n.id))})})]}),e.jsxs("div",{className:"control-panel",children:[e.jsxs("label",{className:"auto-refresh-label",children:[e.jsx("input",{type:"checkbox",checked:z,onChange:n=>F(n.target.checked)}),d("live.auto_refresh","Auto-refresh")]}),e.jsxs("select",{value:V,onChange:n=>q(Number(n.target.value)),disabled:!z,className:"refresh-interval-select",children:[e.jsx("option",{value:3e3,children:"3s"}),e.jsx("option",{value:5e3,children:"5s"}),e.jsx("option",{value:1e4,children:"10s"}),e.jsx("option",{value:15e3,children:"15s"})]}),e.jsxs("button",{className:"refresh-btn",onClick:()=>s&&g(s.id),children:["üîÑ ",d("common.btn_refresh","Refresh")]})]})]}),e.jsxs("div",{className:`live-view-container ${fe?"is-panning":""}`,ref:H,onWheel:p,onMouseDown:D,children:[e.jsxs("div",{className:"fe-canvas-controls live",children:[e.jsx("button",{className:"btn-icon-small",onClick:()=>{var n,o;return te(oe(P*1.1),(((n=H.current)==null?void 0:n.getBoundingClientRect().left)||0)+40,(((o=H.current)==null?void 0:o.getBoundingClientRect().top)||0)+40)},title:"Zoom in",children:"Ôºã"}),e.jsx("button",{className:"btn-icon-small",onClick:()=>{var n,o;return te(oe(P*.9),(((n=H.current)==null?void 0:n.getBoundingClientRect().left)||0)+40,(((o=H.current)==null?void 0:o.getBoundingClientRect().top)||0)+40)},title:"Zoom out",children:"Ôºç"}),e.jsx("button",{className:"btn-icon-small",onClick:()=>ee(),title:"Fit to screen",children:"‚§¢"}),e.jsxs("div",{className:"fe-zoom-readout",children:[Math.round(P*100),"%"]}),e.jsx("div",{className:"fe-hint",children:ge?"Pan: drag":"Tip: hold Space to pan, Ctrl+wheel to zoom"})]}),e.jsxs("div",{className:"floor-grid",style:{gridTemplateColumns:`repeat(${s.gridCols}, ${Q}px)`,gridTemplateRows:`repeat(${s.gridRows}, ${Q}px)`,transform:`translate(${ae.x}px, ${ae.y}px) scale(${P})`,transformOrigin:"0 0"},"data-floor-theme":String(s.floorColor||""),children:[(s.objects??[]).map(n=>e.jsxs("div",{className:`floor-object-live type-${n.type}`,style:{gridColumn:`${n.gridX+1} / span ${n.spanX}`,gridRow:`${n.gridY+1} / span ${n.spanY}`,transform:`rotate(${Ze(n.rotationDeg??n.rotation??0)}deg)`},title:n.label||n.type,children:[n.assetFile?e.jsx("img",{className:"live-asset",src:`${Je}${n.assetFile}`,alt:"",style:{transform:`scale(${Ge(n.scale,1)})`,width:"100%",height:"100%",objectFit:"contain",display:"block"}}):e.jsx("span",{className:"obj-icon",children:n.type==="wall"?"üß±":n.type==="door"?"üö™":n.type==="bar"?"üç∏":n.type==="plant"?"ü™¥":"‚ûñ"}),n.label?e.jsx("span",{className:"obj-label",children:n.label}):null]},n.id)),s.tables.map(n=>{const o=R(n.id),S=J(o.occupiedSince);return e.jsxs("div",{className:`table-card table-${n.shape} status-${o.status}`,style:{gridColumn:`${n.gridX+1} / span ${n.spanX}`,gridRow:`${n.gridY+1} / span ${n.spanY}`,borderColor:$e[o.status]},onClick:()=>k(o),children:[e.jsx("div",{className:"table-number",children:n.tableNumber||o.tableNumber}),n.assetFile?e.jsx("img",{className:"live-asset",src:`${Je}${n.assetFile}`,alt:"",style:{width:"100%",height:"100%",objectFit:"contain",display:"block",transform:`rotate(${Ze(n.rotationDeg??0)}deg) scale(${Ge(n.scale,1)})`}}):null,o.status==="occupied"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"table-info",children:[e.jsxs("span",{className:"guests",children:["üë• ",o.guestCount||"-"]}),e.jsx("span",{className:"seated",children:S})]}),e.jsxs("div",{className:"order-summary",children:[o.itemsPending?e.jsxs("span",{className:"pending",children:["‚è≥ ",o.itemsPending]}):null,o.itemsReady?e.jsxs("span",{className:"ready",children:["‚úÖ ",o.itemsReady]}):null,o.orderTotal?e.jsx("span",{className:"total",children:G(o.orderTotal)}):null]})]}),o.status==="reserved"&&e.jsx("div",{className:"table-info",children:e.jsx("span",{children:d("floor.status.reserved","Reserved")})}),o.status==="dirty"&&e.jsx("div",{className:"table-info",children:e.jsxs("span",{children:["üßπ ",d("floor.status_text.dirty","Needs cleaning")]})}),o.status==="empty"&&e.jsx("div",{className:"table-info",children:e.jsx("span",{children:d("floor.status_text.available","Available")})})]},n.id)})]})]}),e.jsxs("div",{className:"live-view-footer",children:[e.jsxs("div",{className:"status-legend",children:[e.jsx("h3",{children:d("live.status_legend","Status Legend")}),e.jsx("div",{className:"legend-items",children:Object.entries($e).map(([n,o])=>e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-color",style:{backgroundColor:o,opacity:n==="empty"?.6:1}}),e.jsx("span",{children:Dt[n]})]},n))})]}),e.jsxs("div",{className:"stats-panel",children:[e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:d("live.stats.total_tables","Total Tables:")}),e.jsx("span",{className:"value",children:s.tables.length})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:d("live.stats.occupied","Occupied:")}),e.jsx("span",{className:"value",style:{color:$e.occupied},children:Array.from(T.values()).filter(n=>n.status==="occupied").length})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:d("live.stats.empty","Empty:")}),e.jsx("span",{className:"value",style:{color:$e.empty},children:Array.from(T.values()).filter(n=>n.status==="empty").length})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"label",children:d("live.stats.occupancy","Occupancy:")}),e.jsxs("span",{className:"value",children:[s.tables.length>0?Math.round(Array.from(T.values()).filter(n=>n.status==="occupied").length/s.tables.length*100):0,"%"]})]})]})]}),O&&e.jsx(_t,{table:O,restaurantId:h,isOpen:m,onClose:()=>ue(!1),onStatusChange:L})]}):e.jsx("div",{className:"live-view-error",children:e.jsx("p",{children:d("floor.empty_state","No floor layouts found. Please create a floor layout first.")})})}function Mt(){const[h,j]=v.useState("edit"),E=window.__APP_CONFIG__||{},s=new URLSearchParams(window.location.search),C=E.restaurantId||s.get("restaurantId")||"";return(E.page||s.get("page")||"floor")==="shifts"?e.jsx("div",{className:"app shifts-app",children:e.jsx(St,{restaurantId:C})}):e.jsxs("div",{className:"app",children:[e.jsxs("header",{className:"app-header",children:[e.jsx("h1",{children:"üçΩÔ∏è Floor Plan Manager"}),e.jsxs("div",{className:"mode-switch",children:[e.jsx("button",{className:h==="edit"?"active":"",onClick:()=>j("edit"),children:"‚úèÔ∏è Edit Layout"}),e.jsx("button",{className:h==="live"?"active":"",onClick:()=>j("live"),children:"üëÅÔ∏è Live View"})]})]}),e.jsx("main",{className:"app-main",children:h==="edit"?e.jsx(yt,{restaurantId:C}):e.jsx($t,{restaurantId:C})})]})}function Tt(){var j;if((j=window.__APP_CONFIG__)!=null&&j.lang)return window.__APP_CONFIG__.lang;const h=document.cookie.match(/(?:^|; )lang=([^;]*)/);return h?h[1]:"he"}bt(Tt()).then(()=>{gt.createRoot(document.getElementById("root")).render(e.jsx(vt.StrictMode,{children:e.jsx(Mt,{})}))});
